import"../chunks/DsnmJJEf.js";import{i as Be}from"../chunks/DHSt_MGh.js";import{a as Yt,l as Kt,c as Je,o as ht,b as yt,e as V,r as Xt,s as ge,d as Zt}from"../chunks/C-E3VCpZ.js";import{A as it,w as ve,aa as qt,C as Nt,x as Ot,v as Jt,g as e,R as Wt,y as Qt,H as ea,z as bt,B as st,K as Ge,ai as ta,an as aa,D as vt,G as na,aC as We,aD as Qe,F as He,aE as xt,aq as kt,ag as Mt,a5 as M,aF as wt,aG as Lt,I as $t,J as ia,aH as ot,N as sa,aI as Rt,aJ as oa,aK as la,ak as ra,aL as ca,ab as da,aM as ua,X as va,aN as fa,aO as ha,aP as pa,aQ as ga,aR as ma,aS as _a,b as k,M as ya,O as ba,af as wa,p as ze,aT as qe,V as c,aU as Re,e as ae,aV as et,l as z,k as j,m as Ue,n as b,q as I,o as g,t as ue,j as Xe,aW as Ze,i as La,aX as Ia,a8 as Aa,aY as Ta,aZ as Sa,a_ as Ea}from"../chunks/Cn3WckQn.js";import{p as le,_ as Ca,b as tt,i as we}from"../chunks/Du4bB3SR.js";function Ye(i,t){return t}function Da(i,t,a){for(var n=i.items,s=[],l=t.length,r=0;r<l;r++)ca(t[r].e,s,!0);var d=l>0&&s.length===0&&a!==null;if(d){var y=a.parentNode;da(y),y.append(a),n.clear(),Se(i,t[0].prev,t[l-1].next)}ua(s,()=>{for(var w=0;w<l;w++){var m=t[w];d||(n.delete(m.k),Se(i,m.prev,m.next)),Rt(m.e,!d)}})}function Ke(i,t,a,n,s,l=null){var r=i,d={flags:t,items:new Map,first:null},y=(t&xt)!==0;if(y){var w=i;r=ve?it(qt(w)):w.appendChild(Nt())}ve&&Ot();var m=null,S=!1,C=new Map,O=Wt(()=>{var $=a();return Mt($)?$:$==null?[]:kt($)}),v,T;function D(){Na(T,v,d,C,r,s,t,n,a),l!==null&&(v.length===0?m?$t(m):m=vt(()=>l(r)):m!==null&&ia(m,()=>{m=null}))}Jt(()=>{T??=va,v=e(O);var $=v.length;if(S&&$===0)return;S=$===0;let H=!1;if(ve){var o=Qt(r)===ea;o!==($===0)&&(r=bt(),it(r),st(!1),H=!0)}if(ve){for(var f=null,E,p=0;p<$;p++){if(Ge.nodeType===ta&&Ge.data===aa){r=Ge,H=!0,st(!1);break}var A=v[p],R=n(A,p);E=ft(Ge,d,f,null,A,R,p,s,t,a),d.items.set(R,E),f=E}$>0&&it(bt())}if(ve)$===0&&l&&(m=vt(()=>l(r)));else if(na()){var Z=new Set,q=He;for(p=0;p<$;p+=1){A=v[p],R=n(A,p);var X=d.items.get(R)??C.get(R);X?(t&(We|Qe))!==0&&Pt(X,A,p,t):(E=ft(null,d,null,null,A,R,p,s,t,a,!0),C.set(R,E)),Z.add(R)}for(const[U,Q]of d.items)Z.has(U)||q.skipped_effects.add(Q.e);q.add_callback(D)}else D();H&&st(!0),e(O)}),ve&&(r=Ge)}function Na(i,t,a,n,s,l,r,d,y){var w=(r&la)!==0,m=(r&(We|Qe))!==0,S=t.length,C=a.items,O=a.first,v=O,T,D=null,$,H=[],o=[],f,E,p,A;if(w)for(A=0;A<S;A+=1)f=t[A],E=d(f,A),p=C.get(E),p!==void 0&&(p.a?.measure(),($??=new Set).add(p));for(A=0;A<S;A+=1){if(f=t[A],E=d(f,A),p=C.get(E),p===void 0){var R=n.get(E);if(R!==void 0){n.delete(E),C.set(E,R);var Z=D?D.next:v;Se(a,D,R),Se(a,R,Z),lt(R,Z,s),D=R}else{var q=v?v.e.nodes_start:s;D=ft(q,a,D,D===null?a.first:D.next,f,E,A,l,r,y)}C.set(E,D),H=[],o=[],v=D.next;continue}if(m&&Pt(p,f,A,r),(p.e.f&ot)!==0&&($t(p.e),w&&(p.a?.unfix(),($??=new Set).delete(p))),p!==v){if(T!==void 0&&T.has(p)){if(H.length<o.length){var X=o[0],U;D=X.prev;var Q=H[0],fe=H[H.length-1];for(U=0;U<H.length;U+=1)lt(H[U],X,s);for(U=0;U<o.length;U+=1)T.delete(o[U]);Se(a,Q.prev,fe.next),Se(a,D,Q),Se(a,fe,X),v=X,D=fe,A-=1,H=[],o=[]}else T.delete(p),lt(p,v,s),Se(a,p.prev,p.next),Se(a,p,D===null?a.first:D.next),Se(a,D,p),D=p;continue}for(H=[],o=[];v!==null&&v.k!==E;)(v.e.f&ot)===0&&(T??=new Set).add(v),o.push(v),v=v.next;if(v===null)continue;p=v}H.push(p),D=p,v=p.next}if(v!==null||T!==void 0){for(var he=T===void 0?[]:kt(T);v!==null;)(v.e.f&ot)===0&&he.push(v),v=v.next;var N=he.length;if(N>0){var F=(r&xt)!==0&&S===0?s:null;if(w){for(A=0;A<N;A+=1)he[A].a?.measure();for(A=0;A<N;A+=1)he[A].a?.fix()}Da(a,he,F)}}w&&sa(()=>{if($!==void 0)for(p of $)p.a?.apply()}),i.first=a.first&&a.first.e,i.last=D&&D.e;for(var J of n.values())Rt(J.e);n.clear()}function Pt(i,t,a,n){(n&We)!==0&&Lt(i.v,t),(n&Qe)!==0?Lt(i.i,a):i.i=a}function ft(i,t,a,n,s,l,r,d,y,w,m){var S=(y&We)!==0,C=(y&oa)===0,O=S?C?M(s,!1,!1):wt(s):s,v=(y&Qe)===0?r:wt(r),T={i:v,v:O,k:l,a:null,e:null,prev:a,next:n};try{if(i===null){var D=document.createDocumentFragment();D.append(i=Nt())}return T.e=vt(()=>d(i,O,v,w),ve),T.e.prev=a&&a.e,T.e.next=n&&n.e,a===null?m||(t.first=T):(a.next=T,a.e.next=T.e),n!==null&&(n.prev=T,n.e.prev=T.e),T}finally{}}function lt(i,t,a){for(var n=i.next?i.next.e.nodes_start:a,s=t?t.e.nodes_start:a,l=i.e.nodes_start;l!==null&&l!==n;){var r=ra(l);s.before(l),l=r}}function Se(i,t,a){t===null?i.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function Oa(i,t,a,n,s){ve&&Ot();var l=t.$$slots?.[a],r=!1;l===!0&&(l=t[a],r=!0),l===void 0||l(i,r?()=>n:n)}const It=[...` 	
\r\f¬†\v\uFEFF`];function xa(i,t,a){var n=i==null?"":""+i;if(t&&(n=n?n+" "+t:t),a){for(var s in a)if(a[s])n=n?n+" "+s:s;else if(n.length)for(var l=s.length,r=0;(r=n.indexOf(s,r))>=0;){var d=r+l;(r===0||It.includes(n[r-1]))&&(d===n.length||It.includes(n[d]))?n=(r===0?"":n.substring(0,r))+n.substring(d+1):r=d}}return n===""?null:n}function Oe(i,t,a,n,s,l){var r=i.__className;if(ve||r!==a||r===void 0){var d=xa(a,n,l);(!ve||d!==i.getAttribute("class"))&&(d==null?i.removeAttribute("class"):i.className=d),i.__className=a}else if(l&&s!==l)for(var y in l){var w=!!l[y];(s==null||w!==!!s[y])&&i.classList.toggle(y,w)}return l}const ka=Symbol("is custom element"),Ma=Symbol("is html");function Ee(i){if(ve){var t=!1,a=()=>{if(!t){if(t=!0,i.hasAttribute("value")){var n=i.value;Ve(i,"value",null),i.value=n}if(i.hasAttribute("checked")){var s=i.checked;Ve(i,"checked",null),i.checked=s}}};i.__on_r=a,fa(a),Yt()}}function rt(i,t){var a=Ht(i);a.checked!==(a.checked=t??void 0)&&(i.checked=t)}function Ve(i,t,a,n){var s=Ht(i);ve&&(s[t]=i.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&i.nodeName==="LINK")||s[t]!==(s[t]=a)&&(t==="loading"&&(i[ga]=a),a==null?i.removeAttribute(t):typeof a!="string"&&$a(i).includes(t)?i[t]=a:i.setAttribute(t,a))}function Ht(i){return i.__attributes??={[ka]:i.nodeName.includes("-"),[Ma]:i.namespaceURI===ha}}var At=new Map;function $a(i){var t=At.get(i.nodeName);if(t)return t;At.set(i.nodeName,t=[]);for(var a,n=i,s=Element.prototype;s!==n;){a=ma(n);for(var l in a)a[l].set&&t.push(l);n=pa(n)}return t}function xe(i,t,a=t){var n=_a(),s=new WeakSet;Kt(i,"input",l=>{var r=l?i.defaultValue:i.value;if(r=ct(i)?dt(r):r,a(r),He!==null&&s.add(He),n&&r!==(r=t())){var d=i.selectionStart,y=i.selectionEnd;i.value=r??"",y!==null&&(i.selectionStart=d,i.selectionEnd=Math.min(y,i.value.length))}}),(ve&&i.defaultValue!==i.value||k(t)==null&&i.value)&&(a(ct(i)?dt(i.value):i.value),He!==null&&s.add(He)),ya(()=>{var l=t();i===document.activeElement&&s.has(He)||ct(i)&&l===dt(i.value)||i.type==="date"&&!l&&!i.value||l!==i.value&&(i.value=l??"")})}function ct(i){var t=i.type;return t==="number"||t==="range"}function dt(i){return i===""?null:+i}function Fe(i,t,a){var n=ba(i,t);n&&n.set&&(i[t]=a,wa(()=>{i[t]=null}))}function Ra(i,t){var a=i.$$events?.[t.type],n=Mt(a)?a.slice():a==null?[]:[a];for(var s of n)s.call(this,t)}var Pa=z('<div class="map-container svelte-50y1od"></div>');function Ha(i,t){ze(t,!1);let a=le(t,"initialCenter",24,()=>[53.4076,-2.9921]),n=le(t,"initialZoom",8,13),s=le(t,"locations",24,()=>[]);const l=Je();let r=M(),d=M(),y=M(),w=[],m=!1;ht(async()=>{if(!e(r)||(e(r)&&qe(r,e(r).innerHTML=""),await new Promise(f=>setTimeout(f,10)),!e(r)||!e(r).parentNode))return;c(y,await Ca(()=>import("../chunks/r9KgTLRM.js").then(f=>f.l),[],import.meta.url));const o=document.createElement("link");o.rel="stylesheet",o.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(o);try{if(!e(r)||!e(r).parentNode)return;c(d,e(y).map(e(r),{center:a(),zoom:n(),zoomControl:!1,attributionControl:!1})),e(y).tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:""}).addTo(e(d)),e(d).on("click",f=>{l("mapClick",{latlng:f.latlng})}),e(d).on("popupopen",()=>{m=!0,l("popupOpen",{open:!0})}),e(d).on("popupclose",()=>{m=!1,l("popupOpen",{open:!1})}),e(y).control.attribution({position:"bottomleft",prefix:!1}).addAttribution("¬© OpenStreetMap contributors").addTo(e(d)),l("mapReady",{map:e(d)}),v()}catch(f){console.error("Failed to initialize map:",f)}}),yt(()=>{e(d)&&e(d).remove()});function S(){console.log("Updating markers, locations:",s()),w.forEach(o=>e(d).removeLayer(o)),w=[],s().forEach(o=>{const f=e(y).divIcon({className:"custom-location-pin",html:`
					<div class="location-pin-container">
						<div class="location-pin-body"></div>
						<div class="location-pin-point"></div>
						${o.instances.length>0?`<div class="instance-count">${o.instances.length}</div>`:""}
					</div>
				`,iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-40]}),E=[...o.instances].sort((A,R)=>new Date(R.createdAt).getTime()-new Date(A.createdAt).getTime()),p=e(y).marker([o.lat,o.lng],{icon:f}).addTo(e(d)).bindPopup(C(o,E),{maxWidth:350,className:"location-popup"});p.locationId=o.id,w.push(p)})}function C(o,f){return`
			<div class="popup-content" data-location-id="${o.id}">
				<div class="popup-header">
					<h3 class="popup-title">${o.name}</h3>
				</div>
				${o.address?`<p class="popup-address">${o.address}</p>`:""}
				
				${f.length===0?`
					<div class="popup-instances">
						<p class="no-instances">No events yet</p>
						<button class="add-event-btn" onclick="window.addEventToLocation('${o.id}')">
							<svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add First Event
						</button>
					</div>
				`:`
					<div class="popup-instances">
						<div class="instance-header">
							<span class="instance-counter">
								<span class="current-instance">1</span> / ${f.length}
							</span>
							<div class="instance-controls">
								${f.length>1?`
									<button class="nav-btn" onclick="window.navigateInstance('${o.id}', -1)" title="Previous event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
										</svg>
									</button>
									<button class="nav-btn" onclick="window.navigateInstance('${o.id}', 1)" title="Next event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
										</svg>
									</button>
								`:""}
								<button class="add-event-btn small" onclick="window.addEventToLocation('${o.id}')" title="Add event">
									<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
										<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
									</svg>
								</button>
							</div>
						</div>
						<div class="current-instance-display" data-current-index="0">
							${O(f[0])}
						</div>
					</div>
				`}
				
				<div class="popup-footer">
					<div class="popup-date">Location created: ${o.createdAt.toLocaleDateString()}</div>
					<p class="popup-coords">
						${o.lat.toFixed(6)}, ${o.lng.toFixed(6)}
					</p>
				</div>
			</div>
		`}function O(o){return`
			<div class="instance-item current">
				<div class="instance-title">${o.title}</div>
				${o.description?`<div class="instance-description">${o.description}</div>`:""}
				<div class="instance-types">${o.types.join(", ")}</div>
				<div class="instance-date">${o.createdAt.toLocaleDateString()} at ${o.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
			</div>
		`}function v(){window.addEventToLocation=o=>{const f=s().find(E=>E.id===o);f&&(e(d).closePopup(),setTimeout(()=>{l("locationClick",{location:f})},10))},window.navigateInstance=(o,f)=>{const E=s().find(Q=>Q.id===o);if(!E||E.instances.length<=1)return;const p=document.querySelector(`[data-location-id="${o}"]`);if(!p)return;const A=p.querySelector(".current-instance-display"),R=A?.getAttribute("data-current-index")||"0";let Z=parseInt(R,10);const q=E.instances.length;Z=(Z+f+q)%q;const X=[...E.instances].sort((Q,fe)=>new Date(fe.createdAt).getTime()-new Date(Q.createdAt).getTime());A.setAttribute("data-current-index",Z.toString()),A.innerHTML=O(X[Z]);const U=p.querySelector(".current-instance");U&&(U.textContent=(Z+1).toString())}}function T(o,f,E){if(e(d)){const p=E||e(d).getZoom();e(d).setView([o,f],p);const R=e(d).getSize().y*.25;e(d).panBy([0,R],{animate:!0,duration:.3})}}function D(){typeof navigator<"u"&&"geolocation"in navigator?navigator.geolocation.getCurrentPosition(o=>{const f=o.coords.latitude,E=o.coords.longitude;T(f,E,16),l("mapClick",{latlng:e(y).latLng(f,E)})},o=>{console.error("Geolocation error:",o),alert("Could not get your location. Please make sure location access is enabled.")}):alert("Geolocation is not supported by this browser.")}function $(o){return w.find(f=>f.locationId===o.id)||null}yt(()=>{if(window.addEventToLocation&&delete window.addEventToLocation,window.navigateInstance&&delete window.navigateInstance,e(d)&&e(d).getContainer())try{const o=e(d).getContainer();o&&o.parentNode&&(e(d).off(),e(d).remove())}catch(o){console.debug("Map cleanup handled (view switch):",o.message)}finally{c(d,null)}if(w=[],e(r)&&e(r).parentNode)try{qe(r,e(r).innerHTML="")}catch(o){console.debug("Container cleanup handled:",o.message)}}),Re(()=>(e(d),e(y),ae(s())),()=>{e(d)&&e(y)&&s()&&S()}),et(),Be();var H=Pa();return Ve(H,"id",`map-${k(()=>Math.random().toString(36).substr(2,9))??""}`),tt(H,o=>c(r,o),()=>e(r)),j(i,H),Fe(t,"panTo",T),Fe(t,"getCurrentLocation",D),Fe(t,"getMarkerForLocation",$),Ue({panTo:T,getCurrentLocation:D,getMarkerForLocation:$})}const Ce={MAP:{DEFAULT_CENTER:[53.4084,-2.9916],DEFAULT_ZOOM:13,MAX_ZOOM:19},STORAGE:{PIN_STORAGE_KEY:"map-pins",STORAGE_VERSION:1},UI:{PANEL_HEIGHTS:{COLLAPSED:60,PARTIAL:200,EXPANDED_OFFSET:.2},ANIMATION_DURATION:300,SEARCH_DEBOUNCE:300},PINS:{MAX_TITLE_LENGTH:100,MAX_DESCRIPTION_LENGTH:500,ID_LENGTH:16},DATE_FORMAT:{TIME:{hour:"2-digit",minute:"2-digit"},SHORT_DATE:{month:"short",day:"numeric"},FULL_DATE:{weekday:"long",month:"long",day:"numeric",year:"numeric"}}},Tt={STORAGE_SAVE_FAILED:"Failed to save pins",STORAGE_LOAD_FAILED:"Failed to load pins"};class Fa{level=1;constructor(){if(typeof window<"u"){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";this.level=t?0:2}}shouldLog(t){return t>=this.level}formatMessage(t,a,n){const l=`[${new Date().toISOString()}] [${t}]`;return n?`${l} ${a}`:`${l} ${a}`}debug(t,a){this.shouldLog(0)&&console.debug(this.formatMessage("DEBUG",t),a||"")}info(t,a){this.shouldLog(1)&&console.info(this.formatMessage("INFO",t),a||"")}warn(t,a){this.shouldLog(2)&&console.warn(this.formatMessage("WARN",t),a||"")}error(t,a){this.shouldLog(3)&&console.error(this.formatMessage("ERROR",t),a||"")}}const G=new Fa;class oe extends Error{constructor(t,a,n){super(t),this.code=a,this.context=n,this.name="AppError"}}function St(i,t,a){try{return i()}catch(n){throw G.error(`${t}: ${n.message}`,n),new oe(t,a,n)}}var te=(i=>(i.Shit="shit",i.Cum="cum",i.Piss="piss",i))(te||{});const{PIN_STORAGE_KEY:En}=Ce.STORAGE,{MAX_TITLE_LENGTH:Cn,MAX_DESCRIPTION_LENGTH:Dn,ID_LENGTH:Nn}=Ce.PINS;var ja=z('<div class="location-header svelte-1y96ay7"><h2 class="location-title svelte-1y96ay7"> </h2> <button class="close-button svelte-1y96ay7" aria-label="Close panel">√ó</button></div> <div class="pin-form svelte-1y96ay7"><div class="form-group svelte-1y96ay7"><span class="form-label svelte-1y96ay7">Instance Types * (select one or more)</span> <div class="checkbox-group svelte-1y96ay7"><label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">üí© Shit</span></label> <label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">üçÜ Cum</span></label> <label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">üí¶ Piss</span></label></div></div> <div class="form-group svelte-1y96ay7"><label for="instance-title" class="form-label svelte-1y96ay7">Instance Title *</label> <input id="instance-title" type="text" placeholder="Enter a title for this instance..." class="form-input svelte-1y96ay7" maxlength="100"/></div> <div class="form-group svelte-1y96ay7"><label for="instance-description" class="form-label svelte-1y96ay7">Description (optional)</label> <textarea id="instance-description" placeholder="Add a description or notes..." class="form-textarea svelte-1y96ay7" rows="3" maxlength="500"></textarea></div> <div class="form-actions svelte-1y96ay7"><button class="action-button secondary svelte-1y96ay7">Cancel</button> <button class="action-button primary svelte-1y96ay7">Save Instance</button></div></div>',1),Ga=z('<div class="coordinates svelte-1y96ay7"> </div>'),Va=z(`<div class="location-header svelte-1y96ay7"><h2 class="location-title svelte-1y96ay7">Create New Location</h2> <button class="close-button svelte-1y96ay7" aria-label="Close panel">√ó</button></div> <div class="pin-form svelte-1y96ay7"><div class="form-group svelte-1y96ay7"><label class="form-label svelte-1y96ay7" for="location-name">Location Name *</label> <input id="location-name" type="text" placeholder="e.g., McDonald's Downtown" class="form-input svelte-1y96ay7" maxlength="100"/></div> <div class="form-group svelte-1y96ay7"><label class="form-label svelte-1y96ay7" for="location-address">Address (optional)</label> <input id="location-address" type="text" placeholder="Enter address or description" class="form-input svelte-1y96ay7" maxlength="200"/></div> <!> <div class="form-buttons svelte-1y96ay7"><button class="cancel-btn svelte-1y96ay7">Cancel</button> <button class="create-btn svelte-1y96ay7">Create Location</button></div></div>`,1),Ba=z('<div class="empty-state svelte-1y96ay7"><h3 class="svelte-1y96ay7">Tap on the map</h3> <p class="svelte-1y96ay7">Click anywhere on the map to create a new location, or click an existing location to add an instance</p></div>'),za=z('<div><div class="panel-handle svelte-1y96ay7" role="button" tabindex="0" aria-label="Drag to resize panel"><div class="handle-bar svelte-1y96ay7"></div></div> <div class="panel-content svelte-1y96ay7"><!></div></div>');function Ua(i,t){ze(t,!1);let a=le(t,"panelState",12,"collapsed"),n=le(t,"selectedLocation",8,null),s=le(t,"selectedLocationForInstance",8,null),l=le(t,"isCreatingLocation",8,!1),r=le(t,"isCreatingInstance",8,!1);const d=Je();let y=M(),w=!1,m=0,S=0,C=M(""),O=M(""),v=M(new Set([te.Shit])),T=M(""),D=M("");function $(N){a(N),d("panelStateChange",{state:N})}function H(N){w=!0,m="touches"in N?N.touches[0].clientY:N.clientY;const F=e(y).getBoundingClientRect();S=window.innerHeight-F.top,document.addEventListener("mousemove",o,{passive:!1}),document.addEventListener("mouseup",f),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",f)}function o(N){if(!w)return;N.preventDefault();const F="touches"in N?N.touches[0].clientY:N.clientY,J=m-F,re=Math.max(60,Math.min(window.innerHeight*.8,S+J));qe(y,e(y).style.transform=`translateY(${window.innerHeight-re}px)`)}function f(){if(!w)return;w=!1;const N=e(y).getBoundingClientRect(),F=window.innerHeight-N.top;F<120?$("collapsed"):F<window.innerHeight*.4?$("partial"):$("expanded"),qe(y,e(y).style.transform=""),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",f),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",f)}function E(){!s()||!e(C).trim()||e(v).size===0||(d("createInstance",{title:e(C).trim(),description:e(O).trim()||void 0,types:Array.from(e(v))}),c(C,""),c(O,""),c(v,new Set([te.Shit])))}function p(){c(C,""),c(O,""),c(v,new Set([te.Shit])),d("cancelInstance")}function A(N){const F=N;e(v).has(F)?e(v).delete(F):e(v).add(F),c(v,new Set(e(v)))}function R(){!n()||!e(T).trim()||(d("createLocation",{name:e(T).trim(),address:e(D).trim()||void 0}),c(T,""),c(D,""))}function Z(){c(T,""),c(D,""),d("cancelLocation")}Be();var q=za(),X=b(q),U=I(X,2),Q=b(U);{var fe=N=>{var F=ja(),J=Xe(F),re=b(J),Le=b(re);g(re);var W=I(re,2);g(J);var ne=I(J,2),pe=b(ne),De=I(b(pe),2),me=b(De),ie=b(me);Ee(ie),Ze(2),g(me);var _e=I(me,2),ce=b(_e);Ee(ce),Ze(2),g(_e);var Ie=I(_e,2),Ae=b(Ie);Ee(Ae),Ze(2),g(Ie),g(De),g(pe);var h=I(pe,2),u=I(b(h),2);Ee(u),g(h);var _=I(h,2),x=I(b(_),2);Xt(x),g(_);var L=I(_,2),P=b(L),K=I(P,2);g(L),g(ne),ue((Y,se,ee,ye)=>{ge(Le,`Add Instance to ${ae(s()),k(()=>s().name)??""}`),rt(ie,Y),rt(ce,se),rt(Ae,ee),K.disabled=ye},[()=>(e(v),ae(te),k(()=>e(v).has(te.Shit))),()=>(e(v),ae(te),k(()=>e(v).has(te.Cum))),()=>(e(v),ae(te),k(()=>e(v).has(te.Piss))),()=>(e(C),e(v),k(()=>!e(C).trim()||e(v).size===0))]),V("click",W,()=>$("collapsed")),V("change",ie,()=>A(te.Shit)),V("change",ce,()=>A(te.Cum)),V("change",Ae,()=>A(te.Piss)),xe(u,()=>e(C),Y=>c(C,Y)),xe(x,()=>e(O),Y=>c(O,Y)),V("click",P,p),V("click",K,E),j(N,F)},he=N=>{var F=La(),J=Xe(F);{var re=W=>{var ne=Va(),pe=Xe(ne),De=I(b(pe),2);g(pe);var me=I(pe,2),ie=b(me),_e=I(b(ie),2);Ee(_e),g(ie);var ce=I(ie,2),Ie=I(b(ce),2);Ee(Ie),g(ce);var Ae=I(ce,2);{var h=L=>{var P=Ga(),K=b(P);g(P),ue((Y,se)=>ge(K,`üìç ${Y??""}, ${se??""}`),[()=>(ae(n()),k(()=>n().lat.toFixed(4))),()=>(ae(n()),k(()=>n().lng.toFixed(4)))]),j(L,P)};we(Ae,L=>{n()&&L(h)})}var u=I(Ae,2),_=b(u),x=I(_,2);g(u),g(me),ue(L=>x.disabled=L,[()=>(e(T),k(()=>!e(T).trim()))]),V("click",De,()=>$("collapsed")),xe(_e,()=>e(T),L=>c(T,L)),xe(Ie,()=>e(D),L=>c(D,L)),V("click",_,Z),V("click",x,R),j(W,ne)},Le=W=>{var ne=Ba();j(W,ne)};we(J,W=>{l()?W(re):W(Le,!1)},!0)}j(N,F)};we(Q,N=>{r()&&s()?N(fe):N(he,!1)})}g(U),g(q),tt(q,N=>c(y,N),()=>e(y)),ue(()=>Oe(q,1,`bottom-panel ${a()??""}`,"svelte-1y96ay7")),V("mousedown",X,H),V("touchstart",X,H),j(i,q),Ue()}const{PIN_STORAGE_KEY:On}=Ce.STORAGE,ut="map-locations",{MAX_TITLE_LENGTH:Et,MAX_DESCRIPTION_LENGTH:Ya,ID_LENGTH:Ka}=Ce.PINS;class $e{static saveLocations(t){return St(()=>{const a=t.map(n=>({...n,createdAt:n.createdAt.toISOString(),instances:n.instances.map(s=>({...s,createdAt:s.createdAt.toISOString()}))}));localStorage.setItem(ut,JSON.stringify(a)),G.debug(`Saved ${t.length} locations with ${t.reduce((n,s)=>n+s.instances.length,0)} total instances`)},Tt.STORAGE_SAVE_FAILED,"LOCATIONS_SAVE_ERROR")||void 0}static loadLocations(){return St(()=>{const t=localStorage.getItem(ut);if(!t)return G.debug("No locations found in localStorage"),[];const n=JSON.parse(t).map(s=>({...s,createdAt:new Date(s.createdAt),instances:s.instances.map(l=>({...l,createdAt:new Date(l.createdAt)}))}));return G.debug(`Loaded ${n.length} locations with ${n.reduce((s,l)=>s+l.instances.length,0)} total instances`),n},Tt.STORAGE_LOAD_FAILED,"LOCATIONS_LOAD_ERROR")||[]}static addLocation(t){if(!t.name.trim()||t.name.length>Et)throw new oe("Invalid location name","INVALID_LOCATION_NAME");const a={...t,id:this.generateId(),createdAt:new Date,name:t.name.trim(),address:t.address?.trim()||void 0,instances:[]},n=this.loadLocations();return n.push(a),this.saveLocations(n),G.info(`Created new location: ${a.name}`,{id:a.id}),a}static updateLocation(t){const a=this.loadLocations(),n=a.findIndex(s=>s.id===t.id);if(n===-1)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t.id});if(!t.name.trim()||t.name.length>Et)throw new oe("Invalid location name","INVALID_LOCATION_NAME");a[n]={...t,name:t.name.trim(),address:t.address?.trim()||void 0},this.saveLocations(a),G.info(`Updated location: ${t.name}`,{id:t.id})}static deleteLocation(t){if(!t)throw new oe("Invalid location ID","INVALID_LOCATION_ID");const a=this.loadLocations(),n=a.length,s=a.filter(l=>l.id!==t);if(s.length===n){G.warn(`Attempted to delete non-existent location: ${t}`);return}this.saveLocations(s),G.info(`Deleted location: ${t}`)}static addInstance(t){if(!t.types.length)throw new oe("At least one type must be selected","INVALID_INSTANCE_TYPES");if(t.description&&t.description.length>Ya)throw new oe("Instance description too long","INVALID_INSTANCE_DESCRIPTION");const a={...t,id:this.generateId(),createdAt:new Date,description:t.description?.trim()||void 0},n=this.loadLocations(),s=n.findIndex(l=>l.id===t.locationId);if(s===-1)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});return n[s].instances.push(a),this.saveLocations(n),G.info(`Created new instance at location: ${n[s].name}`,{instanceId:a.id,locationId:t.locationId,types:t.types}),a}static updateInstance(t){const a=this.loadLocations(),n=a.find(l=>l.id===t.locationId);if(!n)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});const s=n.instances.findIndex(l=>l.id===t.id);if(s===-1)throw new oe("Instance not found","INSTANCE_NOT_FOUND",{instanceId:t.id});if(!t.types.length)throw new oe("At least one type must be selected","INVALID_INSTANCE_TYPES");n.instances[s]={...t,description:t.description?.trim()||void 0},this.saveLocations(a),G.info(`Updated instance: ${t.id}`,{locationId:t.locationId})}static deleteInstance(t,a){if(!t||!a)throw new oe("Invalid location or instance ID","INVALID_IDS");const n=this.loadLocations(),s=n.find(r=>r.id===t);if(!s)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t});const l=s.instances.length;if(s.instances=s.instances.filter(r=>r.id!==a),s.instances.length===l){G.warn(`Attempted to delete non-existent instance: ${a}`);return}this.saveLocations(n),G.info(`Deleted instance: ${a} from location: ${t}`)}static clearAllData(){const t=this.loadLocations(),a=t.reduce((n,s)=>n+s.instances.length,0);localStorage.removeItem(ut),G.info(`Cleared all data (${t.length} locations, ${a} instances deleted)`)}static exportData(){const t=this.loadLocations();return JSON.stringify(t,null,2)}static importData(t){try{const n=JSON.parse(t).map(s=>({...s,createdAt:new Date(s.createdAt),instances:s.instances.map(l=>({...l,createdAt:new Date(l.createdAt)}))}));return this.saveLocations(n),n}catch(a){throw G.error("Failed to import locations:",a),new oe("Invalid location data format","INVALID_IMPORT_DATA")}}static getAllInstances(){return this.loadLocations().flatMap(a=>a.instances)}static getInstancesByDate(t=!1){return this.getAllInstances().sort((n,s)=>{const l=n.createdAt.getTime(),r=s.createdAt.getTime();return t?l-r:r-l})}static getLocationById(t){return this.loadLocations().find(n=>n.id===t)||null}static getInstanceById(t){const a=this.loadLocations();for(const n of a){const s=n.instances.find(l=>l.id===t);if(s)return{location:n,instance:s}}return null}static generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,Ka-13)}}var Xa=z('<div class="loading-spinner svelte-16xke3l"></div>'),Za=Ia('<svg class="search-icon svelte-16xke3l" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8" class="svelte-16xke3l"></circle><path d="m21 21-4.35-4.35" class="svelte-16xke3l"></path></svg>'),qa=z('<div class="map-wrapper svelte-16xke3l"><!> <div><div class="search-box svelte-16xke3l"><input type="text" placeholder="Search for a place..." class="search-input svelte-16xke3l"/> <button class="search-button svelte-16xke3l" aria-label="Search location"><!></button></div></div> <div><!> <button class="location-button svelte-16xke3l" aria-label="Get my location" title="Get my location"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-16xke3l"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" class="svelte-16xke3l"></path></svg></button></div> <!></div>');function Ja(i,t){ze(t,!1);const a=M(),n=Je();let s=le(t,"initialCenter",24,()=>[53.4076,-2.9921]),l=le(t,"initialZoom",8,13),r=M(),d=M([]),y=M(""),w=M(!1),m=M("collapsed"),S=M(null),C=M(!1),O=M(null),v=M(!1),T=M(!1);ht(()=>{c(d,$e.loadLocations()),console.log("Loaded locations:",e(d))});function D(h){e(C)||e(v)||f(h.detail.latlng)}function $(h){h.detail.map}function H(h){c(T,h.detail.open)}function o(h){c(O,h.detail.location),c(S,{lat:h.detail.location.lat,lng:h.detail.location.lng}),c(v,!0),c(C,!1),c(m,"expanded"),e(r)&&e(r).panTo(h.detail.location.lat,h.detail.location.lng,16)}async function f(h){console.log("Creating pending location at:",h),c(S,{lat:h.lat,lng:h.lng}),c(C,!0),c(v,!1),c(m,"expanded"),console.log("Location creation setup:",{isCreatingLocation:e(C),isCreatingInstance:e(v),panelState:e(m)})}function E(h){c(m,h.detail.state),e(m)==="collapsed"&&(c(S,null),c(O,null),c(C,!1),c(v,!1))}function p(h){if(!e(S))return;const u=$e.addLocation({lat:e(S).lat,lng:e(S).lng,name:h.detail.name,address:h.detail.address});c(d,[...e(d),u]),n("locationCreated",{location:u}),c(C,!1),c(S,null),c(m,"collapsed")}function A(){c(C,!1),c(S,null),c(m,"collapsed")}function R(h){if(!e(O))return;const u=$e.addInstance({locationId:e(O).id,title:h.detail.title,types:h.detail.types,description:h.detail.description});c(d,$e.loadLocations()),n("instanceCreated",{instance:u}),c(v,!1),c(O,null),c(S,null),c(m,"collapsed")}function Z(){c(v,!1),c(O,null),c(S,null),c(m,"collapsed")}async function q(){if(!(!e(y).trim()||e(w))){c(w,!0);try{const u=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e(y))}&limit=1`)).json();if(u.length>0){const _=u[0],x=parseFloat(_.lat),L=parseFloat(_.lon);e(r)&&e(r).panTo(x,L,15),c(y,"")}else alert("Location not found. Please try a different search term.")}catch(h){console.error("Search error:",h),alert("Search failed. Please try again.")}finally{c(w,!1)}}}function X(h){h.key==="Enter"&&q()}function U(){e(r)&&e(r).getCurrentLocation()}function Q(h,u){const _=e(d).find(x=>x.id===h);_&&e(r)&&(e(r).panTo(_.lat,_.lng,16),u&&console.log(`Navigated to location ${h}, highlighting instance ${u}`))}function fe(h=!1){return $e.loadLocations().sort((_,x)=>{const L=new Date(_.createdAt),P=new Date(x.createdAt);return h?L.getTime()-P.getTime():P.getTime()-L.getTime()})}function he(){const h=$e.loadLocations(),u={};return h.forEach(_=>{_.instances.forEach(x=>{const L=new Date(x.createdAt).toDateString();u[L]||(u[L]=[]),u[L].push({...x,location:_})})}),u}Re(()=>(e(T),e(m)),()=>{c(a,e(T)||e(m)!=="collapsed")}),Re(()=>e(a),()=>{n("controlVisibilityChange",{shouldHide:e(a)})}),et(),Be();var N=qa(),F=b(N);tt(Ha(F,{get initialCenter(){return s()},get initialZoom(){return l()},get locations(){return e(d)},$$events:{mapClick:D,mapReady:$,locationClick:o,popupOpen:H},$$legacy:!0}),h=>c(r,h),()=>e(r));var J=I(F,2);let re;var Le=b(J),W=b(Le);Ee(W);var ne=I(W,2),pe=b(ne);{var De=h=>{var u=Xa();j(h,u)},me=h=>{var u=Za();j(h,u)};we(pe,h=>{e(w)?h(De):h(me,!1)})}g(ne),g(Le),g(J);var ie=I(J,2);let _e;var ce=b(ie);Oa(ce,t,"fab",{});var Ie=I(ce,2);g(ie);var Ae=I(ie,2);return Ua(Ae,{get panelState(){return e(m)},get selectedLocation(){return e(S)},get selectedLocationForInstance(){return e(O)},get isCreatingLocation(){return e(C)},get isCreatingInstance(){return e(v)},$$events:{panelStateChange:E,createLocation:p,cancelLocation:A,createInstance:R,cancelInstance:Z}}),g(N),ue((h,u,_)=>{re=Oe(J,1,"map-controls svelte-16xke3l",null,re,h),W.disabled=e(w),ne.disabled=u,_e=Oe(ie,1,"fab-column svelte-16xke3l",null,_e,_)},[()=>({hidden:e(a)}),()=>(e(w),e(y),k(()=>e(w)||!e(y).trim())),()=>({hidden:e(a)})]),xe(W,()=>e(y),h=>c(y,h)),V("keydown",W,X),V("click",ne,q),V("click",Ie,U),j(i,N),Fe(t,"navigateToLocation",Q),Fe(t,"getLocationsByDate",fe),Fe(t,"getInstancesByDateGrouped",he),Ue({navigateToLocation:Q,getLocationsByDate:fe,getInstancesByDateGrouped:he})}function Pe(i){switch(i){case te.Shit:return"Shit";case te.Cum:return"Cum";case te.Piss:return"Piss";default:return"Unknown"}}function Wa(){return Object.values(te)}const{TIME:Qa,SHORT_DATE:en,FULL_DATE:tn}=Ce.DATE_FORMAT;function Ct(i){return i.toLocaleTimeString([],Qa)}function Dt(i){const t=new Date;if(i.toDateString()===t.toDateString())return`Today @ ${Ct(i)}`;{const n=i.toLocaleDateString([],en),s=Ct(i);return`${n} @ ${s}`}}function an(i){const t=new Date(i+"T00:00:00"),a=new Date,n=new Date(a);return n.setDate(n.getDate()-1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===n.toDateString()?"Yesterday":t.toLocaleDateString([],tn)}function nn(i){return i.toLocaleDateString()}var sn=z('<button class="clear-search svelte-hjuuna" aria-label="Clear search"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-hjuuna"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button>'),on=z("<button> </button>"),ln=z('<button class="clear-filters svelte-hjuuna">Clear Filters</button>'),rn=z('<span class="source-indicator svelte-hjuuna"> </span>'),cn=z('<div class="pin-description svelte-hjuuna"> </div>'),dn=z("<span> </span>"),un=z('<button class="pin-item svelte-hjuuna"><div class="pin-info svelte-hjuuna"><div class="pin-title svelte-hjuuna"> <!></div> <div class="pin-time svelte-hjuuna"> </div> <!> <div class="pin-coordinates svelte-hjuuna"> </div></div> <div class="pin-types svelte-hjuuna"></div></button>'),vn=z('<div class="date-group svelte-hjuuna"><h3 class="date-header svelte-hjuuna"> <span class="pin-count svelte-hjuuna"> </span></h3> <div class="pins-grid svelte-hjuuna"></div></div>'),fn=z('<div class="empty-icon svelte-hjuuna">üìç</div> <h3 class="svelte-hjuuna">No items yet</h3> <p class="svelte-hjuuna">Switch to Map View to create your first location or pin!</p>',1),hn=z('<div class="empty-icon svelte-hjuuna">üîç</div> <h3 class="svelte-hjuuna">No matching items</h3> <p class="svelte-hjuuna">Try adjusting your search or filters</p> <button class="clear-filters svelte-hjuuna">Clear All Filters</button>',1),pn=z('<div class="empty-state svelte-hjuuna"><!></div>'),gn=z('<div class="date-view svelte-hjuuna"><div class="back-header svelte-hjuuna"><button class="back-btn svelte-hjuuna" title="Back to Map" aria-label="Back to Map"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"></path></svg></button> <h1 class="page-title svelte-hjuuna">Timeline</h1> <div class="item-count svelte-hjuuna"> </div></div> <div class="controls svelte-hjuuna"><div class="search-bar svelte-hjuuna"><svg viewBox="0 0 24 24" fill="currentColor" class="search-icon svelte-hjuuna"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg> <input type="text" placeholder="Search pins..." class="search-input svelte-hjuuna"/> <!></div> <div class="filters svelte-hjuuna"><div class="sort-control svelte-hjuuna"><button title="Newest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-hjuuna"><path d="M7 14l5-5 5 5z"></path></svg> Newest</button> <button title="Oldest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-hjuuna"><path d="M7 10l5 5 5-5z"></path></svg> Oldest</button></div> <div class="type-filters svelte-hjuuna"></div> <div class="date-filters svelte-hjuuna"><div class="date-filter-group svelte-hjuuna"><label for="date-after" class="date-label svelte-hjuuna">After:</label> <input id="date-after" type="date" class="date-input svelte-hjuuna" title="Show pins created after this date"/></div> <div class="date-filter-group svelte-hjuuna"><label for="date-before" class="date-label svelte-hjuuna">Before:</label> <input id="date-before" type="date" class="date-input svelte-hjuuna" title="Show pins created before this date"/></div></div> <!></div></div> <div class="pin-groups svelte-hjuuna"><!> <!></div></div>');function mn(i,t){ze(t,!1);const a=M(),n=M(),s=M(),l=Je();let r=le(t,"pins",24,()=>[]),d=le(t,"locations",24,()=>[]),y=le(t,"totalItems",8,0),w=M("desc"),m=M(""),S=M([]),C=M(""),O=M("");const v=Wa();function T(u,_){const x=[];return u.forEach(L=>{x.push({id:L.id,title:L.title,description:L.description,types:L.types||[L.type],createdAt:L.createdAt,lat:L.lat,lng:L.lng,source:"pin"})}),_.forEach(L=>{L.instances.forEach(P=>{x.push({id:P.id,title:L.name,description:P.description,types:P.types,createdAt:P.createdAt,lat:L.lat,lng:L.lng,source:"instance",locationId:L.id,locationName:L.name})})}),x}function D(u,_,x,L,P,K){console.log("Filtering items:",{items:u.length,searchTerm:_,selectedTypes:x,sortOrder:L,dateAfter:P,dateBefore:K});let Y=u.filter(ee=>{const ye=!_||ee.title.toLowerCase().includes(_.toLowerCase())||ee.description&&ee.description.toLowerCase().includes(_.toLowerCase()),ke=x.length===0||x.some(je=>ee.types.includes(je)),Ne=new Date(ee.createdAt.getFullYear(),ee.createdAt.getMonth(),ee.createdAt.getDate()),B=!P||Ne>=new Date(P),Me=!K||Ne<=new Date(K);return ye&&ke&&B&&Me});console.log("After filtering:",Y.length),Y.sort((ee,ye)=>{const ke=ee.createdAt.getTime(),Ne=ye.createdAt.getTime();return L==="desc"?Ne-ke:ke-Ne});const se={};return Y.forEach(ee=>{const ye=nn(ee.createdAt);se[ye]||(se[ye]=[]),se[ye].push(ee)}),G.debug(`Grouped items into ${Object.keys(se).length} date groups`),se}function $(u){G.debug(`Item clicked in date view: ${u.id} (source: ${u.source})`),u.source==="pin"?l("navigateToPin",{pinId:u.id}):u.source==="instance"&&l("navigateToLocation",{locationId:u.locationId,instanceId:u.id})}function H(u){return an(u)}function o(u){e(S).includes(u)?c(S,e(S).filter(_=>_!==u)):c(S,[...e(S),u]),G.debug(`Type filter toggled: ${u}, active filters:`,e(S))}function f(){c(m,""),c(S,[]),c(C,""),c(O,""),G.debug("All filters cleared")}function E(){l("switchView",{view:"map"})}Re(()=>(ae(r()),ae(d())),()=>{c(a,T(r(),d()))}),Re(()=>(e(a),e(m),e(S),e(w),e(C),e(O)),()=>{c(n,D(e(a),e(m),e(S),e(w),e(C),e(O)))}),Re(()=>e(n),()=>{c(s,Object.values(e(n)).flat().length)}),et(),Be();var p=gn(),A=b(p),R=b(A),Z=I(R,4),q=b(Z);g(Z),g(A);var X=I(A,2),U=b(X),Q=I(b(U),2);Ee(Q);var fe=I(Q,2);{var he=u=>{var _=sn();V("click",_,()=>c(m,"")),j(u,_)};we(fe,u=>{e(m)&&u(he)})}g(U);var N=I(U,2),F=b(N),J=b(F),re=I(J,2);g(F);var Le=I(F,2);Ke(Le,5,()=>v,Ye,(u,_)=>{var x=on(),L=b(x,!0);g(x),ue((P,K,Y)=>{Oe(x,1,`type-filter ${P??""} type-${e(_)??""}`,"svelte-hjuuna"),Ve(x,"title",`Filter by ${K??""}`),ge(L,Y)},[()=>(e(S),e(_),k(()=>e(S).includes(e(_))?"active":"")),()=>(ae(Pe),e(_),k(()=>Pe(e(_)))),()=>(ae(Pe),e(_),k(()=>Pe(e(_))))]),V("click",x,()=>o(e(_))),j(u,x)}),g(Le);var W=I(Le,2),ne=b(W),pe=I(b(ne),2);Ee(pe),g(ne);var De=I(ne,2),me=I(b(De),2);Ee(me),g(De),g(W);var ie=I(W,2);{var _e=u=>{var _=ln();V("click",_,f),j(u,_)};we(ie,u=>{e(m),e(S),e(C),e(O),k(()=>e(m)||e(S).length>0||e(C)||e(O))&&u(_e)})}g(N),g(X);var ce=I(X,2),Ie=b(ce);Ke(Ie,1,()=>(e(n),k(()=>Object.entries(e(n)))),Ye,(u,_)=>{var x=Aa(()=>Ta(e(_),2));let L=()=>e(x)[0],P=()=>e(x)[1];var K=vn(),Y=b(K),se=b(Y),ee=I(se),ye=b(ee);g(ee),g(Y);var ke=I(Y,2);Ke(ke,5,P,Ye,(Ne,B)=>{var Me=un(),je=b(Me),at=b(je),pt=b(at),Ft=I(pt);{var jt=be=>{var de=rn(),Te=b(de);g(de),ue(()=>ge(Te,`@${e(B),k(()=>e(B).locationName)??""}`)),j(be,de)};we(Ft,be=>{e(B),k(()=>e(B).source==="instance")&&be(jt)})}g(at);var nt=I(at,2),Gt=b(nt,!0);g(nt);var gt=I(nt,2);{var Vt=be=>{var de=cn(),Te=b(de,!0);g(de),ue(()=>ge(Te,(e(B),k(()=>e(B).description)))),j(be,de)};we(gt,be=>{e(B),k(()=>e(B).description)&&be(Vt)})}var mt=I(gt,2),Bt=b(mt);g(mt),g(je);var _t=I(je,2);Ke(_t,5,()=>(e(B),k(()=>e(B).types)),Ye,(be,de)=>{var Te=dn(),zt=b(Te,!0);g(Te),ue(Ut=>{Oe(Te,1,`type-badge type-${e(de)??""}`,"svelte-hjuuna"),ge(zt,Ut)},[()=>(ae(Pe),e(de),k(()=>Pe(e(de))))]),j(be,Te)}),g(_t),g(Me),ue((be,de,Te)=>{Ve(Me,"title",`Click to navigate to ${e(B),k(()=>e(B).source==="pin"?"pin":"location")??""} on map`),ge(pt,`${e(B),k(()=>e(B).title)??""} `),ge(Gt,be),ge(Bt,`${de??""}, ${Te??""}`)},[()=>(ae(Dt),e(B),k(()=>Dt(e(B).createdAt))),()=>(e(B),k(()=>e(B).lat.toFixed(4))),()=>(e(B),k(()=>e(B).lng.toFixed(4)))]),V("click",Me,()=>$(e(B))),j(Ne,Me)}),g(ke),g(K),ue(Ne=>{ge(se,`${Ne??""} `),ge(ye,`${P(),k(()=>P().length)??""} item${P(),k(()=>P().length===1?"":"s")??""}`)},[()=>(L(),k(()=>H(L())))]),j(u,K)});var Ae=I(Ie,2);{var h=u=>{var _=pn(),x=b(_);{var L=K=>{var Y=fn();Ze(4),j(K,Y)},P=K=>{var Y=hn(),se=I(Xe(Y),6);V("click",se,f),j(K,Y)};we(x,K=>{ae(r()),ae(d()),k(()=>r().length===0&&d().length===0)?K(L):K(P,!1)})}g(_),j(u,_)};we(Ae,u=>{e(n),k(()=>Object.keys(e(n)).length===0)&&u(h)})}g(ce),g(p),ue(()=>{ge(q,`${y()??""} item${y()===1?"":"s"}`),Oe(J,1,`sort-btn ${e(w)==="desc"?"active":""}`,"svelte-hjuuna"),Oe(re,1,`sort-btn ${e(w)==="asc"?"active":""}`,"svelte-hjuuna")}),V("click",R,E),xe(Q,()=>e(m),u=>c(m,u)),V("click",J,()=>c(w,"desc")),V("click",re,()=>c(w,"asc")),xe(pe,()=>e(C),u=>c(C,u)),xe(me,()=>e(O),u=>c(O,u)),j(i,p),Ue()}var _n=z('<button title="Switch to Date View" aria-label="Switch to Date View"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1uyghn1"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></svg></button>');function yn(i,t){let a=le(t,"hidden",8,!1);var n=_n();let s;ue(l=>s=Oe(n,1,"date-fab svelte-1uyghn1",null,s,l),[()=>({hidden:a()})]),V("click",n,function(l){Ra.call(this,t,l)}),j(i,n)}var bn=z('<meta name="description" content="Interactive map to track bodily functions and see date-based views"/>'),wn=z('<div class="app-container svelte-1wqlqhg"><!></div>');function xn(i,t){ze(t,!1);const a=M();let n=M(),s=M([]),l=M("map");ht(()=>{r(),d(),v()});function r(){try{c(s,$e.loadLocations()),G.debug(`Loaded ${e(s).length} locations in main page`)}catch(o){G.error("Failed to load data in main page",o),c(s,[])}}function d(){const o=()=>{G.debug("Storage changed, reloading data"),r()};return window.addEventListener("storage",o),()=>{window.removeEventListener("storage",o)}}function y(o){G.debug(`Navigating to location: ${o.detail.locationId}, instance: ${o.detail.instanceId}`),c(l,"map"),setTimeout(()=>{e(n)?.navigateToLocation(o.detail.locationId,o.detail.instanceId)},Ce.UI.ANIMATION_DURATION/3)}function w(){r()}function m(o){console.log("switchView called with:",o,"current:",e(l)),e(l)!==o&&(G.debug(`Switching view from ${e(l)} to ${o}`),c(l,o),o==="date"&&w())}function S(){m("date")}function C(o){o.detail.shouldHide}function O(o){const{altKey:f,key:E}=o;if(f&&E==="d"){o.preventDefault(),m("date");return}if(f&&E==="m"){o.preventDefault(),m("map");return}if(E==="Escape"&&e(l)==="date"){o.preventDefault(),m("map");return}}function v(){G.debug("Setting up keyboard shortcuts")}Re(()=>e(s),()=>{c(a,e(s).reduce((o,f)=>o+f.instances.length,0))}),et(),Be();var T=wn();Zt(o=>{var f=bn();Sa.title="Shumpiss",j(o,f)}),V("keydown",Ea,O);var D=b(T);{var $=o=>{tt(Ja(o,{get initialCenter(){return ae(Ce),k(()=>Ce.MAP.DEFAULT_CENTER)},get initialZoom(){return ae(Ce),k(()=>Ce.MAP.DEFAULT_ZOOM)},$$events:{locationCreated:w,instanceCreated:w,locationDeleted:w,instanceDeleted:w,controlVisibilityChange:C},$$slots:{fab:(f,E)=>{yn(f,{slot:"fab",$$events:{click:S}})}},$$legacy:!0}),f=>c(n,f),()=>e(n))},H=o=>{mn(o,{get locations(){return e(s)},get totalItems(){return e(a)},$$events:{navigateToLocation:y,switchView:f=>m(f.detail.view)}})};we(D,o=>{e(l)==="map"?o($):o(H,!1)})}g(T),j(i,T),Ue()}export{xn as component};
