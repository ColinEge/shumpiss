import"../chunks/DsnmJJEf.js";import{i as Be}from"../chunks/DHSt_MGh.js";import{a as Yt,l as Kt,c as Je,o as ht,b as bt,e as V,r as Xt,s as ge,d as Zt}from"../chunks/C-E3VCpZ.js";import{A as it,w as ve,aa as qt,C as Nt,x as Ot,v as Jt,g as e,R as Wt,y as Qt,H as ea,z as yt,B as ot,K as Ge,ai as ta,an as aa,D as vt,G as na,aC as We,aD as Qe,F as He,aE as xt,aq as Mt,ag as kt,a5 as k,aF as wt,aG as Lt,I as $t,J as ia,aH as st,N as oa,aI as Rt,aJ as sa,aK as la,ak as ra,aL as ca,ab as da,aM as ua,X as va,aN as fa,aO as ha,aP as pa,aQ as ga,aR as ma,aS as _a,b as M,M as ba,O as ya,af as wa,p as ze,aT as qe,V as c,aU as Re,e as ne,aV as et,l as B,k as F,m as Ue,n as b,q as A,o as g,t as ue,j as Xe,aW as Ze,i as La,aX as Ia,a8 as Aa,aY as Ta,aZ as Sa,a_ as Ea}from"../chunks/Cn3WckQn.js";import{p as se,_ as Ca,b as tt,i as we}from"../chunks/Du4bB3SR.js";function Ye(i,t){return t}function Da(i,t,a){for(var n=i.items,o=[],l=t.length,r=0;r<l;r++)ca(t[r].e,o,!0);var d=l>0&&o.length===0&&a!==null;if(d){var y=a.parentNode;da(y),y.append(a),n.clear(),Se(i,t[0].prev,t[l-1].next)}ua(o,()=>{for(var w=0;w<l;w++){var m=t[w];d||(n.delete(m.k),Se(i,m.prev,m.next)),Rt(m.e,!d)}})}function Ke(i,t,a,n,o,l=null){var r=i,d={flags:t,items:new Map,first:null},y=(t&xt)!==0;if(y){var w=i;r=ve?it(qt(w)):w.appendChild(Nt())}ve&&Ot();var m=null,S=!1,C=new Map,O=Wt(()=>{var $=a();return kt($)?$:$==null?[]:Mt($)}),v,T;function D(){Na(T,v,d,C,r,o,t,n,a),l!==null&&(v.length===0?m?$t(m):m=vt(()=>l(r)):m!==null&&ia(m,()=>{m=null}))}Jt(()=>{T??=va,v=e(O);var $=v.length;if(S&&$===0)return;S=$===0;let H=!1;if(ve){var s=Qt(r)===ea;s!==($===0)&&(r=yt(),it(r),ot(!1),H=!0)}if(ve){for(var h=null,E,f=0;f<$;f++){if(Ge.nodeType===ta&&Ge.data===aa){r=Ge,H=!0,ot(!1);break}var L=v[f],R=n(L,f);E=ft(Ge,d,h,null,L,R,f,o,t,a),d.items.set(R,E),h=E}$>0&&it(yt())}if(ve)$===0&&l&&(m=vt(()=>l(r)));else if(na()){var Z=new Set,q=He;for(f=0;f<$;f+=1){L=v[f],R=n(L,f);var X=d.items.get(R)??C.get(R);X?(t&(We|Qe))!==0&&Pt(X,L,f,t):(E=ft(null,d,null,null,L,R,f,o,t,a,!0),C.set(R,E)),Z.add(R)}for(const[U,Q]of d.items)Z.has(U)||q.skipped_effects.add(Q.e);q.add_callback(D)}else D();H&&ot(!0),e(O)}),ve&&(r=Ge)}function Na(i,t,a,n,o,l,r,d,y){var w=(r&la)!==0,m=(r&(We|Qe))!==0,S=t.length,C=a.items,O=a.first,v=O,T,D=null,$,H=[],s=[],h,E,f,L;if(w)for(L=0;L<S;L+=1)h=t[L],E=d(h,L),f=C.get(E),f!==void 0&&(f.a?.measure(),($??=new Set).add(f));for(L=0;L<S;L+=1){if(h=t[L],E=d(h,L),f=C.get(E),f===void 0){var R=n.get(E);if(R!==void 0){n.delete(E),C.set(E,R);var Z=D?D.next:v;Se(a,D,R),Se(a,R,Z),lt(R,Z,o),D=R}else{var q=v?v.e.nodes_start:o;D=ft(q,a,D,D===null?a.first:D.next,h,E,L,l,r,y)}C.set(E,D),H=[],s=[],v=D.next;continue}if(m&&Pt(f,h,L,r),(f.e.f&st)!==0&&($t(f.e),w&&(f.a?.unfix(),($??=new Set).delete(f))),f!==v){if(T!==void 0&&T.has(f)){if(H.length<s.length){var X=s[0],U;D=X.prev;var Q=H[0],fe=H[H.length-1];for(U=0;U<H.length;U+=1)lt(H[U],X,o);for(U=0;U<s.length;U+=1)T.delete(s[U]);Se(a,Q.prev,fe.next),Se(a,D,Q),Se(a,fe,X),v=X,D=fe,L-=1,H=[],s=[]}else T.delete(f),lt(f,v,o),Se(a,f.prev,f.next),Se(a,f,D===null?a.first:D.next),Se(a,D,f),D=f;continue}for(H=[],s=[];v!==null&&v.k!==E;)(v.e.f&st)===0&&(T??=new Set).add(v),s.push(v),v=v.next;if(v===null)continue;f=v}H.push(f),D=f,v=f.next}if(v!==null||T!==void 0){for(var he=T===void 0?[]:Mt(T);v!==null;)(v.e.f&st)===0&&he.push(v),v=v.next;var N=he.length;if(N>0){var j=(r&xt)!==0&&S===0?o:null;if(w){for(L=0;L<N;L+=1)he[L].a?.measure();for(L=0;L<N;L+=1)he[L].a?.fix()}Da(a,he,j)}}w&&oa(()=>{if($!==void 0)for(f of $)f.a?.apply()}),i.first=a.first&&a.first.e,i.last=D&&D.e;for(var J of n.values())Rt(J.e);n.clear()}function Pt(i,t,a,n){(n&We)!==0&&Lt(i.v,t),(n&Qe)!==0?Lt(i.i,a):i.i=a}function ft(i,t,a,n,o,l,r,d,y,w,m){var S=(y&We)!==0,C=(y&sa)===0,O=S?C?k(o,!1,!1):wt(o):o,v=(y&Qe)===0?r:wt(r),T={i:v,v:O,k:l,a:null,e:null,prev:a,next:n};try{if(i===null){var D=document.createDocumentFragment();D.append(i=Nt())}return T.e=vt(()=>d(i,O,v,w),ve),T.e.prev=a&&a.e,T.e.next=n&&n.e,a===null?m||(t.first=T):(a.next=T,a.e.next=T.e),n!==null&&(n.prev=T,n.e.prev=T.e),T}finally{}}function lt(i,t,a){for(var n=i.next?i.next.e.nodes_start:a,o=t?t.e.nodes_start:a,l=i.e.nodes_start;l!==null&&l!==n;){var r=ra(l);o.before(l),l=r}}function Se(i,t,a){t===null?i.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function Oa(i,t,a,n,o){ve&&Ot();var l=t.$$slots?.[a],r=!1;l===!0&&(l=t[a],r=!0),l===void 0||l(i,r?()=>n:n)}const It=[...` 	
\r\f¬†\v\uFEFF`];function xa(i,t,a){var n=i==null?"":""+i;if(t&&(n=n?n+" "+t:t),a){for(var o in a)if(a[o])n=n?n+" "+o:o;else if(n.length)for(var l=o.length,r=0;(r=n.indexOf(o,r))>=0;){var d=r+l;(r===0||It.includes(n[r-1]))&&(d===n.length||It.includes(n[d]))?n=(r===0?"":n.substring(0,r))+n.substring(d+1):r=d}}return n===""?null:n}function Oe(i,t,a,n,o,l){var r=i.__className;if(ve||r!==a||r===void 0){var d=xa(a,n,l);(!ve||d!==i.getAttribute("class"))&&(d==null?i.removeAttribute("class"):i.className=d),i.__className=a}else if(l&&o!==l)for(var y in l){var w=!!l[y];(o==null||w!==!!o[y])&&i.classList.toggle(y,w)}return l}const Ma=Symbol("is custom element"),ka=Symbol("is html");function Ee(i){if(ve){var t=!1,a=()=>{if(!t){if(t=!0,i.hasAttribute("value")){var n=i.value;Ve(i,"value",null),i.value=n}if(i.hasAttribute("checked")){var o=i.checked;Ve(i,"checked",null),i.checked=o}}};i.__on_r=a,fa(a),Yt()}}function rt(i,t){var a=Ht(i);a.checked!==(a.checked=t??void 0)&&(i.checked=t)}function Ve(i,t,a,n){var o=Ht(i);ve&&(o[t]=i.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&i.nodeName==="LINK")||o[t]!==(o[t]=a)&&(t==="loading"&&(i[ga]=a),a==null?i.removeAttribute(t):typeof a!="string"&&$a(i).includes(t)?i[t]=a:i.setAttribute(t,a))}function Ht(i){return i.__attributes??={[Ma]:i.nodeName.includes("-"),[ka]:i.namespaceURI===ha}}var At=new Map;function $a(i){var t=At.get(i.nodeName);if(t)return t;At.set(i.nodeName,t=[]);for(var a,n=i,o=Element.prototype;o!==n;){a=ma(n);for(var l in a)a[l].set&&t.push(l);n=pa(n)}return t}function xe(i,t,a=t){var n=_a(),o=new WeakSet;Kt(i,"input",l=>{var r=l?i.defaultValue:i.value;if(r=ct(i)?dt(r):r,a(r),He!==null&&o.add(He),n&&r!==(r=t())){var d=i.selectionStart,y=i.selectionEnd;i.value=r??"",y!==null&&(i.selectionStart=d,i.selectionEnd=Math.min(y,i.value.length))}}),(ve&&i.defaultValue!==i.value||M(t)==null&&i.value)&&(a(ct(i)?dt(i.value):i.value),He!==null&&o.add(He)),ba(()=>{var l=t();i===document.activeElement&&o.has(He)||ct(i)&&l===dt(i.value)||i.type==="date"&&!l&&!i.value||l!==i.value&&(i.value=l??"")})}function ct(i){var t=i.type;return t==="number"||t==="range"}function dt(i){return i===""?null:+i}function Fe(i,t,a){var n=ya(i,t);n&&n.set&&(i[t]=a,wa(()=>{i[t]=null}))}function Ra(i,t){var a=i.$$events?.[t.type],n=kt(a)?a.slice():a==null?[]:[a];for(var o of n)o.call(this,t)}var Pa=B('<div class="map-container svelte-50y1od"></div>');function Ha(i,t){ze(t,!1);let a=se(t,"initialCenter",24,()=>[53.4076,-2.9921]),n=se(t,"initialZoom",8,13),o=se(t,"locations",24,()=>[]);const l=Je();let r=k(),d=k(),y=k(),w=[],m=!1;ht(async()=>{if(!e(r)||(e(r)&&qe(r,e(r).innerHTML=""),await new Promise(h=>setTimeout(h,10)),!e(r)||!e(r).parentNode))return;c(y,await Ca(()=>import("../chunks/r9KgTLRM.js").then(h=>h.l),[],import.meta.url));const s=document.createElement("link");s.rel="stylesheet",s.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(s);try{if(!e(r)||!e(r).parentNode)return;c(d,e(y).map(e(r),{center:a(),zoom:n(),zoomControl:!1,attributionControl:!1})),e(y).tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:""}).addTo(e(d)),e(d).on("click",h=>{l("mapClick",{latlng:h.latlng})}),e(d).on("popupopen",()=>{m=!0,l("popupOpen",{open:!0})}),e(d).on("popupclose",()=>{m=!1,l("popupOpen",{open:!1})}),e(y).control.attribution({position:"bottomleft",prefix:!1}).addAttribution("¬© OpenStreetMap contributors").addTo(e(d)),l("mapReady",{map:e(d)}),v()}catch(h){console.error("Failed to initialize map:",h)}}),bt(()=>{e(d)&&e(d).remove()});function S(){console.log("Updating markers, locations:",o()),w.forEach(s=>e(d).removeLayer(s)),w=[],o().forEach(s=>{const h=e(y).divIcon({className:"custom-location-pin",html:`
					<div class="location-pin-container">
						<div class="location-pin-body"></div>
						<div class="location-pin-point"></div>
						${s.instances.length>0?`<div class="instance-count">${s.instances.length}</div>`:""}
					</div>
				`,iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-40]}),E=[...s.instances].sort((L,R)=>new Date(R.createdAt).getTime()-new Date(L.createdAt).getTime()),f=e(y).marker([s.lat,s.lng],{icon:h}).addTo(e(d)).bindPopup(C(s,E),{maxWidth:350,className:"location-popup"});f.locationId=s.id,w.push(f)})}function C(s,h){return`
			<div class="popup-content" data-location-id="${s.id}">
				<div class="popup-header">
					<h3 class="popup-title">${s.name}</h3>
				</div>
				${s.address?`<p class="popup-address">${s.address}</p>`:""}
				
				${h.length===0?`
					<div class="popup-instances">
						<p class="no-instances">No events yet</p>
						<button class="add-event-btn" onclick="window.addEventToLocation('${s.id}')">
							<svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add First Event
						</button>
					</div>
				`:`
					<div class="popup-instances">
						<div class="instance-header">
							<span class="instance-counter">
								<span class="current-instance">1</span> / ${h.length}
							</span>
							<div class="instance-controls">
								${h.length>1?`
									<button class="nav-btn" onclick="window.navigateInstance('${s.id}', -1)" title="Previous event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
										</svg>
									</button>
									<button class="nav-btn" onclick="window.navigateInstance('${s.id}', 1)" title="Next event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
										</svg>
									</button>
								`:""}
								<button class="add-event-btn small" onclick="window.addEventToLocation('${s.id}')" title="Add event">
									<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
										<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
									</svg>
								</button>
							</div>
						</div>
						<div class="current-instance-display" data-current-index="0">
							${O(h[0])}
						</div>
					</div>
				`}
				
				<div class="popup-footer">
					<div class="popup-date">Location created: ${s.createdAt.toLocaleDateString()}</div>
					<p class="popup-coords">
						${s.lat.toFixed(6)}, ${s.lng.toFixed(6)}
					</p>
				</div>
			</div>
		`}function O(s){return`
			<div class="instance-item current">
				<div class="instance-title">${s.title}</div>
				${s.description?`<div class="instance-description">${s.description}</div>`:""}
				<div class="instance-types">${s.types.join(", ")}</div>
				<div class="instance-date">${s.createdAt.toLocaleDateString()} at ${s.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
			</div>
		`}function v(){window.addEventToLocation=s=>{const h=o().find(E=>E.id===s);h&&(e(d).closePopup(),setTimeout(()=>{l("locationClick",{location:h})},10))},window.navigateInstance=(s,h)=>{const E=o().find(Q=>Q.id===s);if(!E||E.instances.length<=1)return;const f=document.querySelector(`[data-location-id="${s}"]`);if(!f)return;const L=f.querySelector(".current-instance-display"),R=L?.getAttribute("data-current-index")||"0";let Z=parseInt(R,10);const q=E.instances.length;Z=(Z+h+q)%q;const X=[...E.instances].sort((Q,fe)=>new Date(fe.createdAt).getTime()-new Date(Q.createdAt).getTime());L.setAttribute("data-current-index",Z.toString()),L.innerHTML=O(X[Z]);const U=f.querySelector(".current-instance");U&&(U.textContent=(Z+1).toString())}}function T(s,h,E){if(e(d)){const f=E||e(d).getZoom();e(d).setView([s,h],f);const R=e(d).getSize().y*.25;e(d).panBy([0,R],{animate:!0,duration:.3})}}function D(){typeof navigator<"u"&&"geolocation"in navigator?navigator.geolocation.getCurrentPosition(s=>{const h=s.coords.latitude,E=s.coords.longitude;T(h,E,16),l("mapClick",{latlng:e(y).latLng(h,E)})},s=>{console.error("Geolocation error:",s),alert("Could not get your location. Please make sure location access is enabled.")}):alert("Geolocation is not supported by this browser.")}function $(s){return w.find(h=>h.locationId===s.id)||null}bt(()=>{if(window.addEventToLocation&&delete window.addEventToLocation,window.navigateInstance&&delete window.navigateInstance,e(d)&&e(d).getContainer())try{const s=e(d).getContainer();s&&s.parentNode&&(e(d).off(),e(d).remove())}catch(s){console.debug("Map cleanup handled (view switch):",s.message)}finally{c(d,null)}if(w=[],e(r)&&e(r).parentNode)try{qe(r,e(r).innerHTML="")}catch(s){console.debug("Container cleanup handled:",s.message)}}),Re(()=>(e(d),e(y),ne(o())),()=>{e(d)&&e(y)&&o()&&S()}),et(),Be();var H=Pa();return Ve(H,"id",`map-${M(()=>Math.random().toString(36).substr(2,9))??""}`),tt(H,s=>c(r,s),()=>e(r)),F(i,H),Fe(t,"panTo",T),Fe(t,"getCurrentLocation",D),Fe(t,"getMarkerForLocation",$),Ue({panTo:T,getCurrentLocation:D,getMarkerForLocation:$})}const Ce={MAP:{DEFAULT_CENTER:[53.4084,-2.9916],DEFAULT_ZOOM:13,MAX_ZOOM:19},STORAGE:{PIN_STORAGE_KEY:"map-pins",STORAGE_VERSION:1},UI:{PANEL_HEIGHTS:{COLLAPSED:60,PARTIAL:200,EXPANDED_OFFSET:.2},ANIMATION_DURATION:300,SEARCH_DEBOUNCE:300},PINS:{MAX_TITLE_LENGTH:100,MAX_DESCRIPTION_LENGTH:500,ID_LENGTH:16},DATE_FORMAT:{TIME:{hour:"2-digit",minute:"2-digit"},SHORT_DATE:{month:"short",day:"numeric"},FULL_DATE:{weekday:"long",month:"long",day:"numeric",year:"numeric"}}},Tt={STORAGE_SAVE_FAILED:"Failed to save pins",STORAGE_LOAD_FAILED:"Failed to load pins"};class Fa{level=1;constructor(){if(typeof window<"u"){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";this.level=t?0:2}}shouldLog(t){return t>=this.level}formatMessage(t,a,n){const l=`[${new Date().toISOString()}] [${t}]`;return n?`${l} ${a}`:`${l} ${a}`}debug(t,a){this.shouldLog(0)&&console.debug(this.formatMessage("DEBUG",t),a||"")}info(t,a){this.shouldLog(1)&&console.info(this.formatMessage("INFO",t),a||"")}warn(t,a){this.shouldLog(2)&&console.warn(this.formatMessage("WARN",t),a||"")}error(t,a){this.shouldLog(3)&&console.error(this.formatMessage("ERROR",t),a||"")}}const G=new Fa;class oe extends Error{constructor(t,a,n){super(t),this.code=a,this.context=n,this.name="AppError"}}function St(i,t,a){try{return i()}catch(n){throw G.error(`${t}: ${n.message}`,n),new oe(t,a,n)}}var ae=(i=>(i.Shit="shit",i.Cum="cum",i.Piss="piss",i))(ae||{});const{PIN_STORAGE_KEY:Cn}=Ce.STORAGE,{MAX_TITLE_LENGTH:Dn,MAX_DESCRIPTION_LENGTH:Nn,ID_LENGTH:On}=Ce.PINS;var ja=B('<div class="location-header svelte-1y96ay7"><h2 class="location-title svelte-1y96ay7"> </h2> <button class="close-button svelte-1y96ay7" aria-label="Close panel">√ó</button></div> <div class="pin-form svelte-1y96ay7"><div class="form-group svelte-1y96ay7"><span class="form-label svelte-1y96ay7">Instance Types * (select one or more)</span> <div class="checkbox-group svelte-1y96ay7"><label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">üí© Shit</span></label> <label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">üçÜ Cum</span></label> <label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">üí¶ Piss</span></label></div></div> <div class="form-group svelte-1y96ay7"><label for="instance-title" class="form-label svelte-1y96ay7">Instance Title *</label> <input id="instance-title" type="text" placeholder="Enter a title for this instance..." class="form-input svelte-1y96ay7" maxlength="100"/></div> <div class="form-group svelte-1y96ay7"><label for="instance-description" class="form-label svelte-1y96ay7">Description (optional)</label> <textarea id="instance-description" placeholder="Add a description or notes..." class="form-textarea svelte-1y96ay7" rows="3" maxlength="500"></textarea></div> <div class="form-actions svelte-1y96ay7"><button class="action-button secondary svelte-1y96ay7">Cancel</button> <button class="action-button primary svelte-1y96ay7">Save Instance</button></div></div>',1),Ga=B('<div class="coordinates svelte-1y96ay7"> </div>'),Va=B(`<div class="location-header svelte-1y96ay7"><h2 class="location-title svelte-1y96ay7">Create New Location</h2> <button class="close-button svelte-1y96ay7" aria-label="Close panel">√ó</button></div> <div class="pin-form svelte-1y96ay7"><div class="form-group svelte-1y96ay7"><label class="form-label svelte-1y96ay7" for="location-name">Location Name *</label> <input id="location-name" type="text" placeholder="e.g., McDonald's Downtown" class="form-input svelte-1y96ay7" maxlength="100"/></div> <div class="form-group svelte-1y96ay7"><label class="form-label svelte-1y96ay7" for="location-address">Address (optional)</label> <input id="location-address" type="text" placeholder="Enter address or description" class="form-input svelte-1y96ay7" maxlength="200"/></div> <!> <div class="form-buttons svelte-1y96ay7"><button class="cancel-btn svelte-1y96ay7">Cancel</button> <button class="create-btn svelte-1y96ay7">Create Location</button></div></div>`,1),Ba=B('<div class="empty-state svelte-1y96ay7"><h3 class="svelte-1y96ay7">Tap on the map</h3> <p class="svelte-1y96ay7">Click anywhere on the map to create a new location, or click an existing location to add an instance</p></div>'),za=B('<div><div class="panel-handle svelte-1y96ay7" role="button" tabindex="0" aria-label="Drag to resize panel"><div class="handle-bar svelte-1y96ay7"></div></div> <div class="panel-content svelte-1y96ay7"><!></div></div>');function Ua(i,t){ze(t,!1);let a=se(t,"panelState",12,"collapsed"),n=se(t,"selectedLocation",8,null),o=se(t,"selectedLocationForInstance",8,null),l=se(t,"isCreatingLocation",8,!1),r=se(t,"isCreatingInstance",8,!1);const d=Je();let y=k(),w=!1,m=0,S=0,C=k(""),O=k(""),v=k(new Set([ae.Shit])),T=k(""),D=k("");function $(N){a(N),d("panelStateChange",{state:N})}function H(N){w=!0,m="touches"in N?N.touches[0].clientY:N.clientY;const j=e(y).getBoundingClientRect();S=window.innerHeight-j.top,document.addEventListener("mousemove",s,{passive:!1}),document.addEventListener("mouseup",h),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",h)}function s(N){if(!w)return;N.preventDefault();const j="touches"in N?N.touches[0].clientY:N.clientY,J=m-j,le=Math.max(60,Math.min(window.innerHeight*.8,S+J));qe(y,e(y).style.transform=`translateY(${window.innerHeight-le}px)`)}function h(){if(!w)return;w=!1;const N=e(y).getBoundingClientRect(),j=window.innerHeight-N.top;j<120?$("collapsed"):j<window.innerHeight*.4?$("partial"):$("expanded"),qe(y,e(y).style.transform=""),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",h)}function E(){!o()||!e(C).trim()||e(v).size===0||(d("createInstance",{title:e(C).trim(),description:e(O).trim()||void 0,types:Array.from(e(v))}),c(C,""),c(O,""),c(v,new Set([ae.Shit])))}function f(){c(C,""),c(O,""),c(v,new Set([ae.Shit])),d("cancelInstance")}function L(N){const j=N;e(v).has(j)?e(v).delete(j):e(v).add(j),c(v,new Set(e(v)))}function R(){!n()||!e(T).trim()||(d("createLocation",{name:e(T).trim(),address:e(D).trim()||void 0}),c(T,""),c(D,""))}function Z(){c(T,""),c(D,""),d("cancelLocation")}Be();var q=za(),X=b(q),U=A(X,2),Q=b(U);{var fe=N=>{var j=ja(),J=Xe(j),le=b(J),Le=b(le);g(le);var W=A(le,2);g(J);var ee=A(J,2),pe=b(ee),De=A(b(pe),2),me=b(De),_e=b(me);Ee(_e),Ze(2),g(me);var re=A(me,2),ce=b(re);Ee(ce),Ze(2),g(re);var Ie=A(re,2),Ae=b(Ie);Ee(Ae),Ze(2),g(Ie),g(De),g(pe);var p=A(pe,2),u=A(b(p),2);Ee(u),g(p);var _=A(p,2),x=A(b(_),2);Xt(x),g(_);var I=A(_,2),P=b(I),K=A(P,2);g(I),g(ee),ue((Y,ie,te,be)=>{ge(Le,`Add Instance to ${ne(o()),M(()=>o().name)??""}`),rt(_e,Y),rt(ce,ie),rt(Ae,te),K.disabled=be},[()=>(e(v),ne(ae),M(()=>e(v).has(ae.Shit))),()=>(e(v),ne(ae),M(()=>e(v).has(ae.Cum))),()=>(e(v),ne(ae),M(()=>e(v).has(ae.Piss))),()=>(e(C),e(v),M(()=>!e(C).trim()||e(v).size===0))]),V("click",W,()=>$("collapsed")),V("change",_e,()=>L(ae.Shit)),V("change",ce,()=>L(ae.Cum)),V("change",Ae,()=>L(ae.Piss)),xe(u,()=>e(C),Y=>c(C,Y)),xe(x,()=>e(O),Y=>c(O,Y)),V("click",P,f),V("click",K,E),F(N,j)},he=N=>{var j=La(),J=Xe(j);{var le=W=>{var ee=Va(),pe=Xe(ee),De=A(b(pe),2);g(pe);var me=A(pe,2),_e=b(me),re=A(b(_e),2);Ee(re),g(_e);var ce=A(_e,2),Ie=A(b(ce),2);Ee(Ie),g(ce);var Ae=A(ce,2);{var p=I=>{var P=Ga(),K=b(P);g(P),ue((Y,ie)=>ge(K,`üìç ${Y??""}, ${ie??""}`),[()=>(ne(n()),M(()=>n().lat.toFixed(4))),()=>(ne(n()),M(()=>n().lng.toFixed(4)))]),F(I,P)};we(Ae,I=>{n()&&I(p)})}var u=A(Ae,2),_=b(u),x=A(_,2);g(u),g(me),ue(I=>x.disabled=I,[()=>(e(T),M(()=>!e(T).trim()))]),V("click",De,()=>$("collapsed")),xe(re,()=>e(T),I=>c(T,I)),xe(Ie,()=>e(D),I=>c(D,I)),V("click",_,Z),V("click",x,R),F(W,ee)},Le=W=>{var ee=Ba();F(W,ee)};we(J,W=>{l()?W(le):W(Le,!1)},!0)}F(N,j)};we(Q,N=>{r()&&o()?N(fe):N(he,!1)})}g(U),g(q),tt(q,N=>c(y,N),()=>e(y)),ue(()=>Oe(q,1,`bottom-panel ${a()??""}`,"svelte-1y96ay7")),V("mousedown",X,H),V("touchstart",X,H),F(i,q),Ue()}const{PIN_STORAGE_KEY:xn}=Ce.STORAGE,ut="map-locations",{MAX_TITLE_LENGTH:Et,MAX_DESCRIPTION_LENGTH:Ya,ID_LENGTH:Ka}=Ce.PINS;class $e{static saveLocations(t){return St(()=>{const a=t.map(n=>({...n,createdAt:n.createdAt.toISOString(),instances:n.instances.map(o=>({...o,createdAt:o.createdAt.toISOString()}))}));localStorage.setItem(ut,JSON.stringify(a)),G.debug(`Saved ${t.length} locations with ${t.reduce((n,o)=>n+o.instances.length,0)} total instances`)},Tt.STORAGE_SAVE_FAILED,"LOCATIONS_SAVE_ERROR")||void 0}static loadLocations(){return St(()=>{const t=localStorage.getItem(ut);if(!t)return G.debug("No locations found in localStorage"),[];const n=JSON.parse(t).map(o=>({...o,createdAt:new Date(o.createdAt),instances:o.instances.map(l=>({...l,createdAt:new Date(l.createdAt)}))}));return G.debug(`Loaded ${n.length} locations with ${n.reduce((o,l)=>o+l.instances.length,0)} total instances`),n},Tt.STORAGE_LOAD_FAILED,"LOCATIONS_LOAD_ERROR")||[]}static addLocation(t){if(!t.name.trim()||t.name.length>Et)throw new oe("Invalid location name","INVALID_LOCATION_NAME");const a={...t,id:this.generateId(),createdAt:new Date,name:t.name.trim(),address:t.address?.trim()||void 0,instances:[]},n=this.loadLocations();return n.push(a),this.saveLocations(n),G.info(`Created new location: ${a.name}`,{id:a.id}),a}static updateLocation(t){const a=this.loadLocations(),n=a.findIndex(o=>o.id===t.id);if(n===-1)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t.id});if(!t.name.trim()||t.name.length>Et)throw new oe("Invalid location name","INVALID_LOCATION_NAME");a[n]={...t,name:t.name.trim(),address:t.address?.trim()||void 0},this.saveLocations(a),G.info(`Updated location: ${t.name}`,{id:t.id})}static deleteLocation(t){if(!t)throw new oe("Invalid location ID","INVALID_LOCATION_ID");const a=this.loadLocations(),n=a.length,o=a.filter(l=>l.id!==t);if(o.length===n){G.warn(`Attempted to delete non-existent location: ${t}`);return}this.saveLocations(o),G.info(`Deleted location: ${t}`)}static addInstance(t){if(!t.types.length)throw new oe("At least one type must be selected","INVALID_INSTANCE_TYPES");if(t.description&&t.description.length>Ya)throw new oe("Instance description too long","INVALID_INSTANCE_DESCRIPTION");const a={...t,id:this.generateId(),createdAt:new Date,description:t.description?.trim()||void 0},n=this.loadLocations(),o=n.findIndex(l=>l.id===t.locationId);if(o===-1)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});return n[o].instances.push(a),this.saveLocations(n),G.info(`Created new instance at location: ${n[o].name}`,{instanceId:a.id,locationId:t.locationId,types:t.types}),a}static updateInstance(t){const a=this.loadLocations(),n=a.find(l=>l.id===t.locationId);if(!n)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});const o=n.instances.findIndex(l=>l.id===t.id);if(o===-1)throw new oe("Instance not found","INSTANCE_NOT_FOUND",{instanceId:t.id});if(!t.types.length)throw new oe("At least one type must be selected","INVALID_INSTANCE_TYPES");n.instances[o]={...t,description:t.description?.trim()||void 0},this.saveLocations(a),G.info(`Updated instance: ${t.id}`,{locationId:t.locationId})}static deleteInstance(t,a){if(!t||!a)throw new oe("Invalid location or instance ID","INVALID_IDS");const n=this.loadLocations(),o=n.find(r=>r.id===t);if(!o)throw new oe("Location not found","LOCATION_NOT_FOUND",{locationId:t});const l=o.instances.length;if(o.instances=o.instances.filter(r=>r.id!==a),o.instances.length===l){G.warn(`Attempted to delete non-existent instance: ${a}`);return}this.saveLocations(n),G.info(`Deleted instance: ${a} from location: ${t}`)}static clearAllData(){const t=this.loadLocations(),a=t.reduce((n,o)=>n+o.instances.length,0);localStorage.removeItem(ut),G.info(`Cleared all data (${t.length} locations, ${a} instances deleted)`)}static exportData(){const t=this.loadLocations();return JSON.stringify(t,null,2)}static importData(t){try{const n=JSON.parse(t).map(o=>({...o,createdAt:new Date(o.createdAt),instances:o.instances.map(l=>({...l,createdAt:new Date(l.createdAt)}))}));return this.saveLocations(n),n}catch(a){throw G.error("Failed to import locations:",a),new oe("Invalid location data format","INVALID_IMPORT_DATA")}}static getAllInstances(){return this.loadLocations().flatMap(a=>a.instances)}static getInstancesByDate(t=!1){return this.getAllInstances().sort((n,o)=>{const l=n.createdAt.getTime(),r=o.createdAt.getTime();return t?l-r:r-l})}static getLocationById(t){return this.loadLocations().find(n=>n.id===t)||null}static getInstanceById(t){const a=this.loadLocations();for(const n of a){const o=n.instances.find(l=>l.id===t);if(o)return{location:n,instance:o}}return null}static generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,Ka-13)}}var Xa=B('<div class="loading-spinner svelte-7hde5b"></div>'),Za=Ia('<svg class="search-icon svelte-7hde5b" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8" class="svelte-7hde5b"></circle><path d="m21 21-4.35-4.35" class="svelte-7hde5b"></path></svg>'),qa=B('<div class="map-wrapper svelte-7hde5b"><!> <div><div class="search-box svelte-7hde5b"><input type="text" placeholder="Search for a place..." class="search-input svelte-7hde5b"/> <button class="search-button svelte-7hde5b" aria-label="Search location"><!></button> <!></div></div> <div><button class="location-button svelte-7hde5b" aria-label="Get my location" title="Get my location"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-7hde5b"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" class="svelte-7hde5b"></path></svg></button></div> <!></div>');function Ja(i,t){ze(t,!1);const a=k(),n=Je();let o=se(t,"initialCenter",24,()=>[53.4076,-2.9921]),l=se(t,"initialZoom",8,13),r=k(),d=k([]),y=k(""),w=k(!1),m=k("collapsed"),S=k(null),C=k(!1),O=k(null),v=k(!1),T=k(!1);ht(()=>{c(d,$e.loadLocations()),console.log("Loaded locations:",e(d))});function D(p){e(C)||e(v)||h(p.detail.latlng)}function $(p){p.detail.map}function H(p){c(T,p.detail.open)}function s(p){c(O,p.detail.location),c(S,{lat:p.detail.location.lat,lng:p.detail.location.lng}),c(v,!0),c(C,!1),c(m,"expanded"),e(r)&&e(r).panTo(p.detail.location.lat,p.detail.location.lng,16)}async function h(p){console.log("Creating pending location at:",p),c(S,{lat:p.lat,lng:p.lng}),c(C,!0),c(v,!1),c(m,"expanded"),console.log("Location creation setup:",{isCreatingLocation:e(C),isCreatingInstance:e(v),panelState:e(m)})}function E(p){c(m,p.detail.state),e(m)==="collapsed"&&(c(S,null),c(O,null),c(C,!1),c(v,!1))}function f(p){if(!e(S))return;const u=$e.addLocation({lat:e(S).lat,lng:e(S).lng,name:p.detail.name,address:p.detail.address});c(d,[...e(d),u]),n("locationCreated",{location:u}),c(C,!1),c(S,null),c(m,"collapsed")}function L(){c(C,!1),c(S,null),c(m,"collapsed")}function R(p){if(!e(O))return;const u=$e.addInstance({locationId:e(O).id,title:p.detail.title,types:p.detail.types,description:p.detail.description});c(d,$e.loadLocations()),n("instanceCreated",{instance:u}),c(v,!1),c(O,null),c(S,null),c(m,"collapsed")}function Z(){c(v,!1),c(O,null),c(S,null),c(m,"collapsed")}async function q(){if(!(!e(y).trim()||e(w))){c(w,!0);try{const u=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e(y))}&limit=1`)).json();if(u.length>0){const _=u[0],x=parseFloat(_.lat),I=parseFloat(_.lon);e(r)&&e(r).panTo(x,I,15),c(y,"")}else alert("Location not found. Please try a different search term.")}catch(p){console.error("Search error:",p),alert("Search failed. Please try again.")}finally{c(w,!1)}}}function X(p){p.key==="Enter"&&q()}function U(){e(r)&&e(r).getCurrentLocation()}function Q(p,u){const _=e(d).find(x=>x.id===p);_&&e(r)&&(e(r).panTo(_.lat,_.lng,16),u&&console.log(`Navigated to location ${p}, highlighting instance ${u}`))}function fe(p=!1){return $e.loadLocations().sort((_,x)=>{const I=new Date(_.createdAt),P=new Date(x.createdAt);return p?I.getTime()-P.getTime():P.getTime()-I.getTime()})}function he(){const p=$e.loadLocations(),u={};return p.forEach(_=>{_.instances.forEach(x=>{const I=new Date(x.createdAt).toDateString();u[I]||(u[I]=[]),u[I].push({...x,location:_})})}),u}Re(()=>(e(T),e(m)),()=>{c(a,e(T)||e(m)!=="collapsed")}),Re(()=>e(a),()=>{n("controlVisibilityChange",{shouldHide:e(a)})}),et(),Be();var N=qa(),j=b(N);tt(Ha(j,{get initialCenter(){return o()},get initialZoom(){return l()},get locations(){return e(d)},$$events:{mapClick:D,mapReady:$,locationClick:s,popupOpen:H},$$legacy:!0}),p=>c(r,p),()=>e(r));var J=A(j,2);let le;var Le=b(J),W=b(Le);Ee(W);var ee=A(W,2),pe=b(ee);{var De=p=>{var u=Xa();F(p,u)},me=p=>{var u=Za();F(p,u)};we(pe,p=>{e(w)?p(De):p(me,!1)})}g(ee);var _e=A(ee,2);Oa(_e,t,"view-switcher",{}),g(Le),g(J);var re=A(J,2);let ce;var Ie=b(re);g(re);var Ae=A(re,2);return Ua(Ae,{get panelState(){return e(m)},get selectedLocation(){return e(S)},get selectedLocationForInstance(){return e(O)},get isCreatingLocation(){return e(C)},get isCreatingInstance(){return e(v)},$$events:{panelStateChange:E,createLocation:f,cancelLocation:L,createInstance:R,cancelInstance:Z}}),g(N),ue((p,u,_)=>{le=Oe(J,1,"map-controls svelte-7hde5b",null,le,p),W.disabled=e(w),ee.disabled=u,ce=Oe(re,1,"location-control svelte-7hde5b",null,ce,_)},[()=>({hidden:e(a)}),()=>(e(w),e(y),M(()=>e(w)||!e(y).trim())),()=>({hidden:e(a)})]),xe(W,()=>e(y),p=>c(y,p)),V("keydown",W,X),V("click",ee,q),V("click",Ie,U),F(i,N),Fe(t,"navigateToLocation",Q),Fe(t,"getLocationsByDate",fe),Fe(t,"getInstancesByDateGrouped",he),Ue({navigateToLocation:Q,getLocationsByDate:fe,getInstancesByDateGrouped:he})}function Pe(i){switch(i){case ae.Shit:return"Shit";case ae.Cum:return"Cum";case ae.Piss:return"Piss";default:return"Unknown"}}function Wa(){return Object.values(ae)}const{TIME:Qa,SHORT_DATE:en,FULL_DATE:tn}=Ce.DATE_FORMAT;function Ct(i){return i.toLocaleTimeString([],Qa)}function Dt(i){const t=new Date;if(i.toDateString()===t.toDateString())return`Today @ ${Ct(i)}`;{const n=i.toLocaleDateString([],en),o=Ct(i);return`${n} @ ${o}`}}function an(i){const t=new Date(i+"T00:00:00"),a=new Date,n=new Date(a);return n.setDate(n.getDate()-1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===n.toDateString()?"Yesterday":t.toLocaleDateString([],tn)}function nn(i){return i.toLocaleDateString()}var on=B('<button class="clear-search svelte-hjuuna" aria-label="Clear search"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-hjuuna"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button>'),sn=B("<button> </button>"),ln=B('<button class="clear-filters svelte-hjuuna">Clear Filters</button>'),rn=B('<span class="source-indicator svelte-hjuuna"> </span>'),cn=B('<div class="pin-description svelte-hjuuna"> </div>'),dn=B("<span> </span>"),un=B('<button class="pin-item svelte-hjuuna"><div class="pin-info svelte-hjuuna"><div class="pin-title svelte-hjuuna"> <!></div> <div class="pin-time svelte-hjuuna"> </div> <!> <div class="pin-coordinates svelte-hjuuna"> </div></div> <div class="pin-types svelte-hjuuna"></div></button>'),vn=B('<div class="date-group svelte-hjuuna"><h3 class="date-header svelte-hjuuna"> <span class="pin-count svelte-hjuuna"> </span></h3> <div class="pins-grid svelte-hjuuna"></div></div>'),fn=B('<div class="empty-icon svelte-hjuuna">üìç</div> <h3 class="svelte-hjuuna">No items yet</h3> <p class="svelte-hjuuna">Switch to Map View to create your first location or pin!</p>',1),hn=B('<div class="empty-icon svelte-hjuuna">üîç</div> <h3 class="svelte-hjuuna">No matching items</h3> <p class="svelte-hjuuna">Try adjusting your search or filters</p> <button class="clear-filters svelte-hjuuna">Clear All Filters</button>',1),pn=B('<div class="empty-state svelte-hjuuna"><!></div>'),gn=B('<div class="date-view svelte-hjuuna"><div class="back-header svelte-hjuuna"><button class="back-btn svelte-hjuuna" title="Back to Map" aria-label="Back to Map"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"></path></svg></button> <h1 class="page-title svelte-hjuuna">Timeline</h1> <div class="item-count svelte-hjuuna"> </div></div> <div class="controls svelte-hjuuna"><div class="search-bar svelte-hjuuna"><svg viewBox="0 0 24 24" fill="currentColor" class="search-icon svelte-hjuuna"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg> <input type="text" placeholder="Search pins..." class="search-input svelte-hjuuna"/> <!></div> <div class="filters svelte-hjuuna"><div class="sort-control svelte-hjuuna"><button title="Newest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-hjuuna"><path d="M7 14l5-5 5 5z"></path></svg> Newest</button> <button title="Oldest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-hjuuna"><path d="M7 10l5 5 5-5z"></path></svg> Oldest</button></div> <div class="type-filters svelte-hjuuna"></div> <div class="date-filters svelte-hjuuna"><div class="date-filter-group svelte-hjuuna"><label for="date-after" class="date-label svelte-hjuuna">After:</label> <input id="date-after" type="date" class="date-input svelte-hjuuna" title="Show pins created after this date"/></div> <div class="date-filter-group svelte-hjuuna"><label for="date-before" class="date-label svelte-hjuuna">Before:</label> <input id="date-before" type="date" class="date-input svelte-hjuuna" title="Show pins created before this date"/></div></div> <!></div></div> <div class="pin-groups svelte-hjuuna"><!> <!></div></div>');function mn(i,t){ze(t,!1);const a=k(),n=k(),o=k(),l=Je();let r=se(t,"pins",24,()=>[]),d=se(t,"locations",24,()=>[]),y=se(t,"totalItems",8,0),w=k("desc"),m=k(""),S=k([]),C=k(""),O=k("");const v=Wa();function T(u,_){const x=[];return u.forEach(I=>{x.push({id:I.id,title:I.title,description:I.description,types:I.types||[I.type],createdAt:I.createdAt,lat:I.lat,lng:I.lng,source:"pin"})}),_.forEach(I=>{I.instances.forEach(P=>{x.push({id:P.id,title:I.name,description:P.description,types:P.types,createdAt:P.createdAt,lat:I.lat,lng:I.lng,source:"instance",locationId:I.id,locationName:I.name})})}),x}function D(u,_,x,I,P,K){console.log("Filtering items:",{items:u.length,searchTerm:_,selectedTypes:x,sortOrder:I,dateAfter:P,dateBefore:K});let Y=u.filter(te=>{const be=!_||te.title.toLowerCase().includes(_.toLowerCase())||te.description&&te.description.toLowerCase().includes(_.toLowerCase()),Me=x.length===0||x.some(je=>te.types.includes(je)),Ne=new Date(te.createdAt.getFullYear(),te.createdAt.getMonth(),te.createdAt.getDate()),z=!P||Ne>=new Date(P),ke=!K||Ne<=new Date(K);return be&&Me&&z&&ke});console.log("After filtering:",Y.length),Y.sort((te,be)=>{const Me=te.createdAt.getTime(),Ne=be.createdAt.getTime();return I==="desc"?Ne-Me:Me-Ne});const ie={};return Y.forEach(te=>{const be=nn(te.createdAt);ie[be]||(ie[be]=[]),ie[be].push(te)}),G.debug(`Grouped items into ${Object.keys(ie).length} date groups`),ie}function $(u){G.debug(`Item clicked in date view: ${u.id} (source: ${u.source})`),u.source==="pin"?l("navigateToPin",{pinId:u.id}):u.source==="instance"&&l("navigateToLocation",{locationId:u.locationId,instanceId:u.id})}function H(u){return an(u)}function s(u){e(S).includes(u)?c(S,e(S).filter(_=>_!==u)):c(S,[...e(S),u]),G.debug(`Type filter toggled: ${u}, active filters:`,e(S))}function h(){c(m,""),c(S,[]),c(C,""),c(O,""),G.debug("All filters cleared")}function E(){l("switchView",{view:"map"})}Re(()=>(ne(r()),ne(d())),()=>{c(a,T(r(),d()))}),Re(()=>(e(a),e(m),e(S),e(w),e(C),e(O)),()=>{c(n,D(e(a),e(m),e(S),e(w),e(C),e(O)))}),Re(()=>e(n),()=>{c(o,Object.values(e(n)).flat().length)}),et(),Be();var f=gn(),L=b(f),R=b(L),Z=A(R,4),q=b(Z);g(Z),g(L);var X=A(L,2),U=b(X),Q=A(b(U),2);Ee(Q);var fe=A(Q,2);{var he=u=>{var _=on();V("click",_,()=>c(m,"")),F(u,_)};we(fe,u=>{e(m)&&u(he)})}g(U);var N=A(U,2),j=b(N),J=b(j),le=A(J,2);g(j);var Le=A(j,2);Ke(Le,5,()=>v,Ye,(u,_)=>{var x=sn(),I=b(x,!0);g(x),ue((P,K,Y)=>{Oe(x,1,`type-filter ${P??""} type-${e(_)??""}`,"svelte-hjuuna"),Ve(x,"title",`Filter by ${K??""}`),ge(I,Y)},[()=>(e(S),e(_),M(()=>e(S).includes(e(_))?"active":"")),()=>(ne(Pe),e(_),M(()=>Pe(e(_)))),()=>(ne(Pe),e(_),M(()=>Pe(e(_))))]),V("click",x,()=>s(e(_))),F(u,x)}),g(Le);var W=A(Le,2),ee=b(W),pe=A(b(ee),2);Ee(pe),g(ee);var De=A(ee,2),me=A(b(De),2);Ee(me),g(De),g(W);var _e=A(W,2);{var re=u=>{var _=ln();V("click",_,h),F(u,_)};we(_e,u=>{e(m),e(S),e(C),e(O),M(()=>e(m)||e(S).length>0||e(C)||e(O))&&u(re)})}g(N),g(X);var ce=A(X,2),Ie=b(ce);Ke(Ie,1,()=>(e(n),M(()=>Object.entries(e(n)))),Ye,(u,_)=>{var x=Aa(()=>Ta(e(_),2));let I=()=>e(x)[0],P=()=>e(x)[1];var K=vn(),Y=b(K),ie=b(Y),te=A(ie),be=b(te);g(te),g(Y);var Me=A(Y,2);Ke(Me,5,P,Ye,(Ne,z)=>{var ke=un(),je=b(ke),at=b(je),pt=b(at),Ft=A(pt);{var jt=ye=>{var de=rn(),Te=b(de);g(de),ue(()=>ge(Te,`@${e(z),M(()=>e(z).locationName)??""}`)),F(ye,de)};we(Ft,ye=>{e(z),M(()=>e(z).source==="instance")&&ye(jt)})}g(at);var nt=A(at,2),Gt=b(nt,!0);g(nt);var gt=A(nt,2);{var Vt=ye=>{var de=cn(),Te=b(de,!0);g(de),ue(()=>ge(Te,(e(z),M(()=>e(z).description)))),F(ye,de)};we(gt,ye=>{e(z),M(()=>e(z).description)&&ye(Vt)})}var mt=A(gt,2),Bt=b(mt);g(mt),g(je);var _t=A(je,2);Ke(_t,5,()=>(e(z),M(()=>e(z).types)),Ye,(ye,de)=>{var Te=dn(),zt=b(Te,!0);g(Te),ue(Ut=>{Oe(Te,1,`type-badge type-${e(de)??""}`,"svelte-hjuuna"),ge(zt,Ut)},[()=>(ne(Pe),e(de),M(()=>Pe(e(de))))]),F(ye,Te)}),g(_t),g(ke),ue((ye,de,Te)=>{Ve(ke,"title",`Click to navigate to ${e(z),M(()=>e(z).source==="pin"?"pin":"location")??""} on map`),ge(pt,`${e(z),M(()=>e(z).title)??""} `),ge(Gt,ye),ge(Bt,`${de??""}, ${Te??""}`)},[()=>(ne(Dt),e(z),M(()=>Dt(e(z).createdAt))),()=>(e(z),M(()=>e(z).lat.toFixed(4))),()=>(e(z),M(()=>e(z).lng.toFixed(4)))]),V("click",ke,()=>$(e(z))),F(Ne,ke)}),g(Me),g(K),ue(Ne=>{ge(ie,`${Ne??""} `),ge(be,`${P(),M(()=>P().length)??""} item${P(),M(()=>P().length===1?"":"s")??""}`)},[()=>(I(),M(()=>H(I())))]),F(u,K)});var Ae=A(Ie,2);{var p=u=>{var _=pn(),x=b(_);{var I=K=>{var Y=fn();Ze(4),F(K,Y)},P=K=>{var Y=hn(),ie=A(Xe(Y),6);V("click",ie,h),F(K,Y)};we(x,K=>{ne(r()),ne(d()),M(()=>r().length===0&&d().length===0)?K(I):K(P,!1)})}g(_),F(u,_)};we(Ae,u=>{e(n),M(()=>Object.keys(e(n)).length===0)&&u(p)})}g(ce),g(f),ue(()=>{ge(q,`${y()??""} item${y()===1?"":"s"}`),Oe(J,1,`sort-btn ${e(w)==="desc"?"active":""}`,"svelte-hjuuna"),Oe(le,1,`sort-btn ${e(w)==="asc"?"active":""}`,"svelte-hjuuna")}),V("click",R,E),xe(Q,()=>e(m),u=>c(m,u)),V("click",J,()=>c(w,"desc")),V("click",le,()=>c(w,"asc")),xe(pe,()=>e(C),u=>c(C,u)),xe(me,()=>e(O),u=>c(O,u)),F(i,f),Ue()}var _n=B('<button title="Switch to Date View" aria-label="Switch to Date View"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-1eiwjh"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></svg></button>');function bn(i,t){let a=se(t,"hidden",8,!1);var n=_n();let o;ue(l=>o=Oe(n,1,"date-fab svelte-1eiwjh",null,o,l),[()=>({hidden:a()})]),V("click",n,function(l){Ra.call(this,t,l)}),F(i,n)}var yn=B('<meta name="description" content="Interactive map to track bodily functions and see date-based views"/>'),wn=B('<div slot="view-switcher"><!></div>'),Ln=B('<div class="app-container svelte-1wqlqhg"><!></div>');function Mn(i,t){ze(t,!1);const a=k();let n=k(),o=k([]),l=k("map");ht(()=>{r(),d(),v()});function r(){try{c(o,$e.loadLocations()),G.debug(`Loaded ${e(o).length} locations in main page`)}catch(s){G.error("Failed to load data in main page",s),c(o,[])}}function d(){const s=()=>{G.debug("Storage changed, reloading data"),r()};return window.addEventListener("storage",s),()=>{window.removeEventListener("storage",s)}}function y(s){G.debug(`Navigating to location: ${s.detail.locationId}, instance: ${s.detail.instanceId}`),c(l,"map"),setTimeout(()=>{e(n)?.navigateToLocation(s.detail.locationId,s.detail.instanceId)},Ce.UI.ANIMATION_DURATION/3)}function w(){r()}function m(s){console.log("switchView called with:",s,"current:",e(l)),e(l)!==s&&(G.debug(`Switching view from ${e(l)} to ${s}`),c(l,s),s==="date"&&w())}function S(){m("date")}function C(s){s.detail.shouldHide}function O(s){const{altKey:h,key:E}=s;if(h&&E==="d"){s.preventDefault(),m("date");return}if(h&&E==="m"){s.preventDefault(),m("map");return}if(E==="Escape"&&e(l)==="date"){s.preventDefault(),m("map");return}}function v(){G.debug("Setting up keyboard shortcuts")}Re(()=>e(o),()=>{c(a,e(o).reduce((s,h)=>s+h.instances.length,0))}),et(),Be();var T=Ln();Zt(s=>{var h=yn();Sa.title="Shumpiss",F(s,h)}),V("keydown",Ea,O);var D=b(T);{var $=s=>{tt(Ja(s,{get initialCenter(){return ne(Ce),M(()=>Ce.MAP.DEFAULT_CENTER)},get initialZoom(){return ne(Ce),M(()=>Ce.MAP.DEFAULT_ZOOM)},$$events:{locationCreated:w,instanceCreated:w,locationDeleted:w,instanceDeleted:w,controlVisibilityChange:C},$$slots:{"view-switcher":(h,E)=>{var f=wn(),L=b(f);bn(L,{$$events:{click:S}}),g(f),F(h,f)}},$$legacy:!0}),h=>c(n,h),()=>e(n))},H=s=>{mn(s,{get locations(){return e(o)},get totalItems(){return e(a)},$$events:{navigateToLocation:y,switchView:h=>m(h.detail.view)}})};we(D,s=>{e(l)==="map"?s($):s(H,!1)})}g(T),F(i,T),Ue()}export{Mn as component};
