import"../chunks/DsnmJJEf.js";import{i as Ge}from"../chunks/BO1dTzpG.js";import{a as Zt,l as Xt,c as We,o as ut,b as _t,e as K,r as Wt,s as de,d as Jt}from"../chunks/DUgMGJGx.js";import{w as ue,x as Dt,aC as Nt,aD as jt,aE as Qt,v as Ot,C as ft,D as Ze,F as Me,G as xt,K as Re,U as ea,J as Mt,A as nt,aa as ta,g as e,R as aa,y as na,H as ia,z as yt,B as it,ai as oa,an as sa,aF as Je,aG as je,aH as kt,aq as $t,ag as ra,a5 as $,aI as wt,aJ as bt,I as Rt,aK as ot,N as la,aL as Pt,aM as ca,aN as da,ak as va,aO as ua,ab as fa,aP as pa,X as ha,aQ as ga,aR as ma,aS as _a,aT as ya,aU as wa,b as N,M as ba,O as La,af as Ia,p as Ve,aV as Xe,V as v,aW as Pe,e as W,aX as Qe,l as Z,k as B,m as Be,n as y,q as b,o as h,t as ve,j as He,aY as Ke,i as qt,aZ as Aa,a8 as Ta,a_ as Ea,a$ as Sa,b0 as Ca}from"../chunks/C-cdoq8H.js";import{p as he,_ as Da,b as et,i as pe}from"../chunks/DR0M7r5p.js";function Na(i,t,a){ue&&Dt();var n=i,o=ea,r,s,c=null,g=Nt()?jt:Qt;function _(){r&&Mt(r),c!==null&&(c.lastChild.remove(),n.before(c),c=null),r=s}Ot(()=>{if(g(o,o=t())){var p=n,O=xt();O&&(c=document.createDocumentFragment(),c.append(p=ft())),s=Ze(()=>a(p)),O?Me.add_callback(_):_()}}),ue&&(n=Re)}function ze(i,t){return t}function Oa(i,t,a){for(var n=i.items,o=[],r=t.length,s=0;s<r;s++)ua(t[s].e,o,!0);var c=r>0&&o.length===0&&a!==null;if(c){var g=a.parentNode;fa(g),g.append(a),n.clear(),Ae(i,t[0].prev,t[r-1].next)}pa(o,()=>{for(var _=0;_<r;_++){var p=t[_];c||(n.delete(p.k),Ae(i,p.prev,p.next)),Pt(p.e,!c)}})}function Ue(i,t,a,n,o,r=null){var s=i,c={flags:t,items:new Map,first:null},g=(t&kt)!==0;if(g){var _=i;s=ue?nt(ta(_)):_.appendChild(ft())}ue&&Dt();var p=null,O=!1,D=new Map,F=aa(()=>{var M=a();return ra(M)?M:M==null?[]:$t(M)}),u,E;function S(){xa(E,u,c,D,s,o,t,n,a),r!==null&&(u.length===0?p?Rt(p):p=Ze(()=>r(s)):p!==null&&Mt(p,()=>{p=null}))}Ot(()=>{E??=ha,u=e(F);var M=u.length;if(O&&M===0)return;O=M===0;let G=!1;if(ue){var d=na(s)===ia;d!==(M===0)&&(s=yt(),nt(s),it(!1),G=!0)}if(ue){for(var L=null,C,f=0;f<M;f++){if(Re.nodeType===oa&&Re.data===sa){s=Re,G=!0,it(!1);break}var A=u[f],R=n(A,f);C=vt(Re,c,L,null,A,R,f,o,t,a),c.items.set(R,C),L=C}M>0&&nt(yt())}if(ue)M===0&&r&&(p=Ze(()=>r(s)));else if(xt()){var X=new Set,m=Me;for(f=0;f<M;f+=1){A=u[f],R=n(A,f);var P=c.items.get(R)??D.get(R);P?(t&(Je|je))!==0&&Ft(P,A,f,t):(C=vt(null,c,null,null,A,R,f,o,t,a,!0),D.set(R,C)),X.add(R)}for(const[V,j]of c.items)X.has(V)||m.skipped_effects.add(j.e);m.add_callback(S)}else S();G&&it(!0),e(F)}),ue&&(s=Re)}function xa(i,t,a,n,o,r,s,c,g){var _=(s&da)!==0,p=(s&(Je|je))!==0,O=t.length,D=a.items,F=a.first,u=F,E,S=null,M,G=[],d=[],L,C,f,A;if(_)for(A=0;A<O;A+=1)L=t[A],C=c(L,A),f=D.get(C),f!==void 0&&(f.a?.measure(),(M??=new Set).add(f));for(A=0;A<O;A+=1){if(L=t[A],C=c(L,A),f=D.get(C),f===void 0){var R=n.get(C);if(R!==void 0){n.delete(C),D.set(C,R);var X=S?S.next:u;Ae(a,S,R),Ae(a,R,X),st(R,X,o),S=R}else{var m=u?u.e.nodes_start:o;S=vt(m,a,S,S===null?a.first:S.next,L,C,A,r,s,g)}D.set(C,S),G=[],d=[],u=S.next;continue}if(p&&Ft(f,L,A,s),(f.e.f&ot)!==0&&(Rt(f.e),_&&(f.a?.unfix(),(M??=new Set).delete(f))),f!==u){if(E!==void 0&&E.has(f)){if(G.length<d.length){var P=d[0],V;S=P.prev;var j=G[0],ie=G[G.length-1];for(V=0;V<G.length;V+=1)st(G[V],P,o);for(V=0;V<d.length;V+=1)E.delete(d[V]);Ae(a,j.prev,ie.next),Ae(a,S,j),Ae(a,ie,P),u=P,S=ie,A-=1,G=[],d=[]}else E.delete(f),st(f,u,o),Ae(a,f.prev,f.next),Ae(a,f,S===null?a.first:S.next),Ae(a,S,f),S=f;continue}for(G=[],d=[];u!==null&&u.k!==C;)(u.e.f&ot)===0&&(E??=new Set).add(u),d.push(u),u=u.next;if(u===null)continue;f=u}G.push(f),S=f,u=f.next}if(u!==null||E!==void 0){for(var re=E===void 0?[]:$t(E);u!==null;)(u.e.f&ot)===0&&re.push(u),u=u.next;var x=re.length;if(x>0){var z=(s&kt)!==0&&O===0?o:null;if(_){for(A=0;A<x;A+=1)re[A].a?.measure();for(A=0;A<x;A+=1)re[A].a?.fix()}Oa(a,re,z)}}_&&la(()=>{if(M!==void 0)for(f of M)f.a?.apply()}),i.first=a.first&&a.first.e,i.last=S&&S.e;for(var Q of n.values())Pt(Q.e);n.clear()}function Ft(i,t,a,n){(n&Je)!==0&&bt(i.v,t),(n&je)!==0?bt(i.i,a):i.i=a}function vt(i,t,a,n,o,r,s,c,g,_,p){var O=(g&Je)!==0,D=(g&ca)===0,F=O?D?$(o,!1,!1):wt(o):o,u=(g&je)===0?s:wt(s),E={i:u,v:F,k:r,a:null,e:null,prev:a,next:n};try{if(i===null){var S=document.createDocumentFragment();S.append(i=ft())}return E.e=Ze(()=>c(i,F,u,_),ue),E.e.prev=a&&a.e,E.e.next=n&&n.e,a===null?p||(t.first=E):(a.next=E,a.e.next=E.e),n!==null&&(n.prev=E,n.e.prev=E.e),E}finally{}}function st(i,t,a){for(var n=i.next?i.next.e.nodes_start:a,o=t?t.e.nodes_start:a,r=i.e.nodes_start;r!==null&&r!==n;){var s=va(r);o.before(r),r=s}}function Ae(i,t,a){t===null?i.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}const Lt=[...` 	
\r\f \v\uFEFF`];function Ma(i,t,a){var n=i==null?"":""+i;if(t&&(n=n?n+" "+t:t),a){for(var o in a)if(a[o])n=n?n+" "+o:o;else if(n.length)for(var r=o.length,s=0;(s=n.indexOf(o,s))>=0;){var c=s+r;(s===0||Lt.includes(n[s-1]))&&(c===n.length||Lt.includes(n[c]))?n=(s===0?"":n.substring(0,s))+n.substring(c+1):s=c}}return n===""?null:n}function Ce(i,t,a,n,o,r){var s=i.__className;if(ue||s!==a||s===void 0){var c=Ma(a,n,r);(!ue||c!==i.getAttribute("class"))&&(c==null?i.removeAttribute("class"):i.className=c),i.__className=a}else if(r&&o!==r)for(var g in r){var _=!!r[g];(o==null||_!==!!o[g])&&i.classList.toggle(g,_)}return r}const ka=Symbol("is custom element"),$a=Symbol("is html");function Te(i){if(ue){var t=!1,a=()=>{if(!t){if(t=!0,i.hasAttribute("value")){var n=i.value;ke(i,"value",null),i.value=n}if(i.hasAttribute("checked")){var o=i.checked;ke(i,"checked",null),i.checked=o}}};i.__on_r=a,ya(a),Zt()}}function rt(i,t){var a=Ht(i);a.checked!==(a.checked=t??void 0)&&(i.checked=t)}function ke(i,t,a,n){var o=Ht(i);ue&&(o[t]=i.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&i.nodeName==="LINK")||o[t]!==(o[t]=a)&&(t==="loading"&&(i[wa]=a),a==null?i.removeAttribute(t):typeof a!="string"&&Ra(i).includes(t)?i[t]=a:i.setAttribute(t,a))}function Ht(i){return i.__attributes??={[ka]:i.nodeName.includes("-"),[$a]:i.namespaceURI===ga}}var It=new Map;function Ra(i){var t=It.get(i.nodeName);if(t)return t;It.set(i.nodeName,t=[]);for(var a,n=i,o=Element.prototype;o!==n;){a=_a(n);for(var r in a)a[r].set&&t.push(r);n=ma(n)}return t}function Ne(i,t,a=t){var n=Nt(),o=new WeakSet;Xt(i,"input",r=>{var s=r?i.defaultValue:i.value;if(s=lt(i)?ct(s):s,a(s),Me!==null&&o.add(Me),n&&s!==(s=t())){var c=i.selectionStart,g=i.selectionEnd;i.value=s??"",g!==null&&(i.selectionStart=c,i.selectionEnd=Math.min(g,i.value.length))}}),(ue&&i.defaultValue!==i.value||N(t)==null&&i.value)&&(a(lt(i)?ct(i.value):i.value),Me!==null&&o.add(Me)),ba(()=>{var r=t();i===document.activeElement&&o.has(Me)||lt(i)&&r===ct(i.value)||i.type==="date"&&!r&&!i.value||r!==i.value&&(i.value=r??"")})}function lt(i){var t=i.type;return t==="number"||t==="range"}function ct(i){return i===""?null:+i}function qe(i,t,a){var n=La(i,t);n&&n.set&&(i[t]=a,Ia(()=>{i[t]=null}))}var Pa=Z('<div class="map-container svelte-50y1od"></div>');function qa(i,t){Ve(t,!1);let a=he(t,"initialCenter",24,()=>[53.4076,-2.9921]),n=he(t,"initialZoom",8,13),o=he(t,"locations",24,()=>[]);const r=We();let s=$(),c=$(),g=$(),_=[],p=!1;ut(async()=>{if(!e(s)||(e(s)&&Xe(s,e(s).innerHTML=""),await new Promise(L=>setTimeout(L,10)),!e(s)||!e(s).parentNode))return;v(g,await Da(()=>import("../chunks/r9KgTLRM.js").then(L=>L.l),[],import.meta.url));const d=document.createElement("link");d.rel="stylesheet",d.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(d);try{if(!e(s)||!e(s).parentNode)return;v(c,e(g).map(e(s),{center:a(),zoom:n(),zoomControl:!1,attributionControl:!1})),e(g).tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:""}).addTo(e(c)),e(g).control.zoom({position:"bottomright"}).addTo(e(c)),e(c).on("click",C=>{r("mapClick",{latlng:C.latlng})}),e(c).on("popupopen",()=>{p=!0,r("popupOpen",{open:!0})}),e(c).on("popupclose",()=>{p=!1,r("popupOpen",{open:!1})}),e(g).control.attribution({position:"bottomleft",prefix:!1}).addAttribution("© OpenStreetMap contributors").addTo(e(c)),r("mapReady",{map:e(c)}),u()}catch(L){console.error("Failed to initialize map:",L)}}),_t(()=>{e(c)&&e(c).remove()});function O(){console.log("Updating markers, locations:",o()),_.forEach(d=>e(c).removeLayer(d)),_=[],o().forEach(d=>{const L=e(g).divIcon({className:"custom-location-pin",html:`
					<div class="location-pin-container">
						<div class="location-pin-body"></div>
						<div class="location-pin-point"></div>
						${d.instances.length>0?`<div class="instance-count">${d.instances.length}</div>`:""}
					</div>
				`,iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-40]}),C=[...d.instances].sort((A,R)=>new Date(R.createdAt).getTime()-new Date(A.createdAt).getTime()),f=e(g).marker([d.lat,d.lng],{icon:L}).addTo(e(c)).bindPopup(D(d,C),{maxWidth:350,className:"location-popup"});f.locationId=d.id,_.push(f)})}function D(d,L){return`
			<div class="popup-content" data-location-id="${d.id}">
				<div class="popup-header">
					<h3 class="popup-title">${d.name}</h3>
				</div>
				${d.address?`<p class="popup-address">${d.address}</p>`:""}
				
				${L.length===0?`
					<div class="popup-instances">
						<p class="no-instances">No events yet</p>
						<button class="add-event-btn" onclick="window.addEventToLocation('${d.id}')">
							<svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add First Event
						</button>
					</div>
				`:`
					<div class="popup-instances">
						<div class="instance-header">
							<span class="instance-counter">
								<span class="current-instance">1</span> / ${L.length}
							</span>
							<div class="instance-controls">
								${L.length>1?`
									<button class="nav-btn" onclick="window.navigateInstance('${d.id}', -1)" title="Previous event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
										</svg>
									</button>
									<button class="nav-btn" onclick="window.navigateInstance('${d.id}', 1)" title="Next event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
										</svg>
									</button>
								`:""}
								<button class="add-event-btn small" onclick="window.addEventToLocation('${d.id}')" title="Add event">
									<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
										<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
									</svg>
								</button>
							</div>
						</div>
						<div class="current-instance-display" data-current-index="0">
							${F(L[0])}
						</div>
					</div>
				`}
				
				<div class="popup-footer">
					<div class="popup-date">Location created: ${d.createdAt.toLocaleDateString()}</div>
					<p class="popup-coords">
						${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}
					</p>
				</div>
			</div>
		`}function F(d){return`
			<div class="instance-item current">
				<div class="instance-title">${d.title}</div>
				${d.description?`<div class="instance-description">${d.description}</div>`:""}
				<div class="instance-types">${d.types.join(", ")}</div>
				<div class="instance-date">${d.createdAt.toLocaleDateString()} at ${d.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
			</div>
		`}function u(){window.addEventToLocation=d=>{const L=o().find(C=>C.id===d);L&&(e(c).closePopup(),setTimeout(()=>{r("locationClick",{location:L})},10))},window.navigateInstance=(d,L)=>{const C=o().find(j=>j.id===d);if(!C||C.instances.length<=1)return;const f=document.querySelector(`[data-location-id="${d}"]`);if(!f)return;const A=f.querySelector(".current-instance-display"),R=A?.getAttribute("data-current-index")||"0";let X=parseInt(R,10);const m=C.instances.length;X=(X+L+m)%m;const P=[...C.instances].sort((j,ie)=>new Date(ie.createdAt).getTime()-new Date(j.createdAt).getTime());A.setAttribute("data-current-index",X.toString()),A.innerHTML=F(P[X]);const V=f.querySelector(".current-instance");V&&(V.textContent=(X+1).toString())}}function E(d,L,C){if(e(c)){const f=C||e(c).getZoom();e(c).setView([d,L],f);const R=e(c).getSize().y*.25;e(c).panBy([0,R],{animate:!0,duration:.3})}}function S(){typeof navigator<"u"&&"geolocation"in navigator?navigator.geolocation.getCurrentPosition(d=>{const L=d.coords.latitude,C=d.coords.longitude;E(L,C,16),r("mapClick",{latlng:e(g).latLng(L,C)})},d=>{console.error("Geolocation error:",d),alert("Could not get your location. Please make sure location access is enabled.")}):alert("Geolocation is not supported by this browser.")}function M(d){return _.find(L=>L.locationId===d.id)||null}_t(()=>{if(window.addEventToLocation&&delete window.addEventToLocation,window.navigateInstance&&delete window.navigateInstance,e(c)&&e(c).getContainer())try{const d=e(c).getContainer();d&&d.parentNode&&(e(c).off(),e(c).remove())}catch(d){console.debug("Map cleanup handled (view switch):",d.message)}finally{v(c,null)}if(_=[],e(s)&&e(s).parentNode)try{Xe(s,e(s).innerHTML="")}catch(d){console.debug("Container cleanup handled:",d.message)}}),Pe(()=>(e(c),e(g),W(o())),()=>{e(c)&&e(g)&&o()&&O()}),Qe(),Ge();var G=Pa();return ke(G,"id",`map-${N(()=>Math.random().toString(36).substr(2,9))??""}`),et(G,d=>v(s,d),()=>e(s)),B(i,G),qe(t,"panTo",E),qe(t,"getCurrentLocation",S),qe(t,"getMarkerForLocation",M),Be({panTo:E,getCurrentLocation:S,getMarkerForLocation:M})}const Ee={MAP:{DEFAULT_CENTER:[53.4084,-2.9916],DEFAULT_ZOOM:13,MAX_ZOOM:19},STORAGE:{PIN_STORAGE_KEY:"map-pins",STORAGE_VERSION:1},UI:{PANEL_HEIGHTS:{COLLAPSED:60,PARTIAL:200,EXPANDED_OFFSET:.2},ANIMATION_DURATION:300,SEARCH_DEBOUNCE:300},PINS:{MAX_TITLE_LENGTH:100,MAX_DESCRIPTION_LENGTH:500,ID_LENGTH:16},DATE_FORMAT:{TIME:{hour:"2-digit",minute:"2-digit"},SHORT_DATE:{month:"short",day:"numeric"},FULL_DATE:{weekday:"long",month:"long",day:"numeric",year:"numeric"}}},Ye={SWITCH_TO_DATE_VIEW:"Alt+D",SWITCH_TO_MAP_VIEW:"Alt+M",ESCAPE:"Escape"},At={STORAGE_SAVE_FAILED:"Failed to save pins",STORAGE_LOAD_FAILED:"Failed to load pins"};class Fa{level=1;constructor(){if(typeof window<"u"){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";this.level=t?0:2}}shouldLog(t){return t>=this.level}formatMessage(t,a,n){const r=`[${new Date().toISOString()}] [${t}]`;return n?`${r} ${a}`:`${r} ${a}`}debug(t,a){this.shouldLog(0)&&console.debug(this.formatMessage("DEBUG",t),a||"")}info(t,a){this.shouldLog(1)&&console.info(this.formatMessage("INFO",t),a||"")}warn(t,a){this.shouldLog(2)&&console.warn(this.formatMessage("WARN",t),a||"")}error(t,a){this.shouldLog(3)&&console.error(this.formatMessage("ERROR",t),a||"")}}const Y=new Fa;class ce extends Error{constructor(t,a,n){super(t),this.code=a,this.context=n,this.name="AppError"}}function Tt(i,t,a){try{return i()}catch(n){throw Y.error(`${t}: ${n.message}`,n),new ce(t,a,n)}}var ne=(i=>(i.Shit="shit",i.Cum="cum",i.Piss="piss",i))(ne||{});const{PIN_STORAGE_KEY:En}=Ee.STORAGE,{MAX_TITLE_LENGTH:Sn,MAX_DESCRIPTION_LENGTH:Cn,ID_LENGTH:Dn}=Ee.PINS;var Ha=Z('<div class="location-header svelte-1y96ay7"><h2 class="location-title svelte-1y96ay7"> </h2> <button class="close-button svelte-1y96ay7" aria-label="Close panel">×</button></div> <div class="pin-form svelte-1y96ay7"><div class="form-group svelte-1y96ay7"><span class="form-label svelte-1y96ay7">Instance Types * (select one or more)</span> <div class="checkbox-group svelte-1y96ay7"><label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">💩 Shit</span></label> <label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">🍆 Cum</span></label> <label class="checkbox-option svelte-1y96ay7"><input type="checkbox" class="svelte-1y96ay7"/> <span class="checkbox-label svelte-1y96ay7">💦 Piss</span></label></div></div> <div class="form-group svelte-1y96ay7"><label for="instance-title" class="form-label svelte-1y96ay7">Instance Title *</label> <input id="instance-title" type="text" placeholder="Enter a title for this instance..." class="form-input svelte-1y96ay7" maxlength="100"/></div> <div class="form-group svelte-1y96ay7"><label for="instance-description" class="form-label svelte-1y96ay7">Description (optional)</label> <textarea id="instance-description" placeholder="Add a description or notes..." class="form-textarea svelte-1y96ay7" rows="3" maxlength="500"></textarea></div> <div class="form-actions svelte-1y96ay7"><button class="action-button secondary svelte-1y96ay7">Cancel</button> <button class="action-button primary svelte-1y96ay7">Save Instance</button></div></div>',1),Ga=Z('<div class="coordinates svelte-1y96ay7"> </div>'),Va=Z(`<div class="location-header svelte-1y96ay7"><h2 class="location-title svelte-1y96ay7">Create New Location</h2> <button class="close-button svelte-1y96ay7" aria-label="Close panel">×</button></div> <div class="pin-form svelte-1y96ay7"><div class="form-group svelte-1y96ay7"><label class="form-label svelte-1y96ay7" for="location-name">Location Name *</label> <input id="location-name" type="text" placeholder="e.g., McDonald's Downtown" class="form-input svelte-1y96ay7" maxlength="100"/></div> <div class="form-group svelte-1y96ay7"><label class="form-label svelte-1y96ay7" for="location-address">Address (optional)</label> <input id="location-address" type="text" placeholder="Enter address or description" class="form-input svelte-1y96ay7" maxlength="200"/></div> <!> <div class="form-buttons svelte-1y96ay7"><button class="cancel-btn svelte-1y96ay7">Cancel</button> <button class="create-btn svelte-1y96ay7">Create Location</button></div></div>`,1),Ba=Z('<div class="empty-state svelte-1y96ay7"><h3 class="svelte-1y96ay7">Tap on the map</h3> <p class="svelte-1y96ay7">Click anywhere on the map to create a new location, or click an existing location to add an instance</p></div>'),za=Z('<div><div class="panel-handle svelte-1y96ay7" role="button" tabindex="0" aria-label="Drag to resize panel"><div class="handle-bar svelte-1y96ay7"></div></div> <div class="panel-content svelte-1y96ay7"><!></div></div>');function Ua(i,t){Ve(t,!1);let a=he(t,"panelState",12,"collapsed"),n=he(t,"selectedLocation",8,null),o=he(t,"selectedLocationForInstance",8,null),r=he(t,"isCreatingLocation",8,!1),s=he(t,"isCreatingInstance",8,!1);const c=We();let g=$(),_=!1,p=0,O=0,D=$(""),F=$(""),u=$(new Set([ne.Shit])),E=$(""),S=$("");function M(x){a(x),c("panelStateChange",{state:x})}function G(x){_=!0,p="touches"in x?x.touches[0].clientY:x.clientY;const z=e(g).getBoundingClientRect();O=window.innerHeight-z.top,document.addEventListener("mousemove",d,{passive:!1}),document.addEventListener("mouseup",L),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("touchend",L)}function d(x){if(!_)return;x.preventDefault();const z="touches"in x?x.touches[0].clientY:x.clientY,Q=p-z,le=Math.max(60,Math.min(window.innerHeight*.8,O+Q));Xe(g,e(g).style.transform=`translateY(${window.innerHeight-le}px)`)}function L(){if(!_)return;_=!1;const x=e(g).getBoundingClientRect(),z=window.innerHeight-x.top;z<120?M("collapsed"):z<window.innerHeight*.4?M("partial"):M("expanded"),Xe(g,e(g).style.transform=""),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",L),document.removeEventListener("touchmove",d),document.removeEventListener("touchend",L)}function C(){!o()||!e(D).trim()||e(u).size===0||(c("createInstance",{title:e(D).trim(),description:e(F).trim()||void 0,types:Array.from(e(u))}),v(D,""),v(F,""),v(u,new Set([ne.Shit])))}function f(){v(D,""),v(F,""),v(u,new Set([ne.Shit])),c("cancelInstance")}function A(x){const z=x;e(u).has(z)?e(u).delete(z):e(u).add(z),v(u,new Set(e(u)))}function R(){!n()||!e(E).trim()||(c("createLocation",{name:e(E).trim(),address:e(S).trim()||void 0}),v(E,""),v(S,""))}function X(){v(E,""),v(S,""),c("cancelLocation")}Ge();var m=za(),P=y(m),V=b(P,2),j=y(V);{var ie=x=>{var z=Ha(),Q=He(z),le=y(Q),Se=y(le);h(le);var ee=b(le,2);h(Q);var oe=b(Q,2),ge=y(oe),De=b(y(ge),2),me=y(De),se=y(me);Te(se),Ke(2),h(me);var _e=b(me,2),ye=y(_e);Te(ye),Ke(2),h(_e);var w=b(_e,2),l=y(w);Te(l),Ke(2),h(w),h(De),h(ge);var I=b(ge,2),T=b(y(I),2);Te(T),h(I);var k=b(I,2),q=b(y(k),2);Wt(q),h(k);var H=b(k,2),te=y(H),J=b(te,2);h(H),h(oe),ve((ae,we,be,U)=>{de(Se,`Add Instance to ${W(o()),N(()=>o().name)??""}`),rt(se,ae),rt(ye,we),rt(l,be),J.disabled=U},[()=>(e(u),W(ne),N(()=>e(u).has(ne.Shit))),()=>(e(u),W(ne),N(()=>e(u).has(ne.Cum))),()=>(e(u),W(ne),N(()=>e(u).has(ne.Piss))),()=>(e(D),e(u),N(()=>!e(D).trim()||e(u).size===0))]),K("click",ee,()=>M("collapsed")),K("change",se,()=>A(ne.Shit)),K("change",ye,()=>A(ne.Cum)),K("change",l,()=>A(ne.Piss)),Ne(T,()=>e(D),ae=>v(D,ae)),Ne(q,()=>e(F),ae=>v(F,ae)),K("click",te,f),K("click",J,C),B(x,z)},re=x=>{var z=qt(),Q=He(z);{var le=ee=>{var oe=Va(),ge=He(oe),De=b(y(ge),2);h(ge);var me=b(ge,2),se=y(me),_e=b(y(se),2);Te(_e),h(se);var ye=b(se,2),w=b(y(ye),2);Te(w),h(ye);var l=b(ye,2);{var I=H=>{var te=Ga(),J=y(te);h(te),ve((ae,we)=>de(J,`📍 ${ae??""}, ${we??""}`),[()=>(W(n()),N(()=>n().lat.toFixed(4))),()=>(W(n()),N(()=>n().lng.toFixed(4)))]),B(H,te)};pe(l,H=>{n()&&H(I)})}var T=b(l,2),k=y(T),q=b(k,2);h(T),h(me),ve(H=>q.disabled=H,[()=>(e(E),N(()=>!e(E).trim()))]),K("click",De,()=>M("collapsed")),Ne(_e,()=>e(E),H=>v(E,H)),Ne(w,()=>e(S),H=>v(S,H)),K("click",k,X),K("click",q,R),B(ee,oe)},Se=ee=>{var oe=Ba();B(ee,oe)};pe(Q,ee=>{r()?ee(le):ee(Se,!1)},!0)}B(x,z)};pe(j,x=>{s()&&o()?x(ie):x(re,!1)})}h(V),h(m),et(m,x=>v(g,x),()=>e(g)),ve(()=>Ce(m,1,`bottom-panel ${a()??""}`,"svelte-1y96ay7")),K("mousedown",P,G),K("touchstart",P,G),B(i,m),Be()}const{PIN_STORAGE_KEY:Nn}=Ee.STORAGE,dt="map-locations",{MAX_TITLE_LENGTH:Et,MAX_DESCRIPTION_LENGTH:Ya,ID_LENGTH:Ka}=Ee.PINS;class xe{static saveLocations(t){return Tt(()=>{const a=t.map(n=>({...n,createdAt:n.createdAt.toISOString(),instances:n.instances.map(o=>({...o,createdAt:o.createdAt.toISOString()}))}));localStorage.setItem(dt,JSON.stringify(a)),Y.debug(`Saved ${t.length} locations with ${t.reduce((n,o)=>n+o.instances.length,0)} total instances`)},At.STORAGE_SAVE_FAILED,"LOCATIONS_SAVE_ERROR")||void 0}static loadLocations(){return Tt(()=>{const t=localStorage.getItem(dt);if(!t)return Y.debug("No locations found in localStorage"),[];const n=JSON.parse(t).map(o=>({...o,createdAt:new Date(o.createdAt),instances:o.instances.map(r=>({...r,createdAt:new Date(r.createdAt)}))}));return Y.debug(`Loaded ${n.length} locations with ${n.reduce((o,r)=>o+r.instances.length,0)} total instances`),n},At.STORAGE_LOAD_FAILED,"LOCATIONS_LOAD_ERROR")||[]}static addLocation(t){if(!t.name.trim()||t.name.length>Et)throw new ce("Invalid location name","INVALID_LOCATION_NAME");const a={...t,id:this.generateId(),createdAt:new Date,name:t.name.trim(),address:t.address?.trim()||void 0,instances:[]},n=this.loadLocations();return n.push(a),this.saveLocations(n),Y.info(`Created new location: ${a.name}`,{id:a.id}),a}static updateLocation(t){const a=this.loadLocations(),n=a.findIndex(o=>o.id===t.id);if(n===-1)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.id});if(!t.name.trim()||t.name.length>Et)throw new ce("Invalid location name","INVALID_LOCATION_NAME");a[n]={...t,name:t.name.trim(),address:t.address?.trim()||void 0},this.saveLocations(a),Y.info(`Updated location: ${t.name}`,{id:t.id})}static deleteLocation(t){if(!t)throw new ce("Invalid location ID","INVALID_LOCATION_ID");const a=this.loadLocations(),n=a.length,o=a.filter(r=>r.id!==t);if(o.length===n){Y.warn(`Attempted to delete non-existent location: ${t}`);return}this.saveLocations(o),Y.info(`Deleted location: ${t}`)}static addInstance(t){if(!t.types.length)throw new ce("At least one type must be selected","INVALID_INSTANCE_TYPES");if(t.description&&t.description.length>Ya)throw new ce("Instance description too long","INVALID_INSTANCE_DESCRIPTION");const a={...t,id:this.generateId(),createdAt:new Date,description:t.description?.trim()||void 0},n=this.loadLocations(),o=n.findIndex(r=>r.id===t.locationId);if(o===-1)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});return n[o].instances.push(a),this.saveLocations(n),Y.info(`Created new instance at location: ${n[o].name}`,{instanceId:a.id,locationId:t.locationId,types:t.types}),a}static updateInstance(t){const a=this.loadLocations(),n=a.find(r=>r.id===t.locationId);if(!n)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});const o=n.instances.findIndex(r=>r.id===t.id);if(o===-1)throw new ce("Instance not found","INSTANCE_NOT_FOUND",{instanceId:t.id});if(!t.types.length)throw new ce("At least one type must be selected","INVALID_INSTANCE_TYPES");n.instances[o]={...t,description:t.description?.trim()||void 0},this.saveLocations(a),Y.info(`Updated instance: ${t.id}`,{locationId:t.locationId})}static deleteInstance(t,a){if(!t||!a)throw new ce("Invalid location or instance ID","INVALID_IDS");const n=this.loadLocations(),o=n.find(s=>s.id===t);if(!o)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t});const r=o.instances.length;if(o.instances=o.instances.filter(s=>s.id!==a),o.instances.length===r){Y.warn(`Attempted to delete non-existent instance: ${a}`);return}this.saveLocations(n),Y.info(`Deleted instance: ${a} from location: ${t}`)}static clearAllData(){const t=this.loadLocations(),a=t.reduce((n,o)=>n+o.instances.length,0);localStorage.removeItem(dt),Y.info(`Cleared all data (${t.length} locations, ${a} instances deleted)`)}static exportData(){const t=this.loadLocations();return JSON.stringify(t,null,2)}static importData(t){try{const n=JSON.parse(t).map(o=>({...o,createdAt:new Date(o.createdAt),instances:o.instances.map(r=>({...r,createdAt:new Date(r.createdAt)}))}));return this.saveLocations(n),n}catch(a){throw Y.error("Failed to import locations:",a),new ce("Invalid location data format","INVALID_IMPORT_DATA")}}static getAllInstances(){return this.loadLocations().flatMap(a=>a.instances)}static getInstancesByDate(t=!1){return this.getAllInstances().sort((n,o)=>{const r=n.createdAt.getTime(),s=o.createdAt.getTime();return t?r-s:s-r})}static getLocationById(t){return this.loadLocations().find(n=>n.id===t)||null}static getInstanceById(t){const a=this.loadLocations();for(const n of a){const o=n.instances.find(r=>r.id===t);if(o)return{location:n,instance:o}}return null}static generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,Ka-13)}}var Za=Z('<div class="loading-spinner svelte-11cidy8"></div>'),Xa=Aa('<svg class="search-icon svelte-11cidy8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8" class="svelte-11cidy8"></circle><path d="m21 21-4.35-4.35" class="svelte-11cidy8"></path></svg>'),Wa=Z('<div class="map-wrapper svelte-11cidy8"><!> <div><div class="search-box svelte-11cidy8"><input type="text" placeholder="Search for a place..." class="search-input svelte-11cidy8"/> <button class="search-button svelte-11cidy8" aria-label="Search location"><!></button></div></div> <div><button class="location-button svelte-11cidy8" aria-label="Get my location" title="Get my location"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-11cidy8"><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" class="svelte-11cidy8"></path><path d="M12 1v6M12 17v6M5.6 5.6l4.2 4.2M14.2 14.2l4.2 4.2M1 12h6M17 12h6M5.6 18.4l4.2-4.2M14.2 9.8l4.2-4.2" class="svelte-11cidy8"></path></svg></button></div> <!></div>');function Ja(i,t){Ve(t,!1);const a=$(),n=We();let o=he(t,"initialCenter",24,()=>[53.4076,-2.9921]),r=he(t,"initialZoom",8,13),s=$(),c=$([]),g=$(""),_=$(!1),p=$("collapsed"),O=$(null),D=$(!1),F=$(null),u=$(!1),E=$(!1);ut(()=>{v(c,xe.loadLocations()),console.log("Loaded locations:",e(c))});function S(l){e(D)||e(u)||L(l.detail.latlng)}function M(l){l.detail.map}function G(l){v(E,l.detail.open)}function d(l){v(F,l.detail.location),v(O,{lat:l.detail.location.lat,lng:l.detail.location.lng}),v(u,!0),v(D,!1),v(p,"expanded"),e(s)&&e(s).panTo(l.detail.location.lat,l.detail.location.lng,16)}async function L(l){console.log("Creating pending location at:",l),v(O,{lat:l.lat,lng:l.lng}),v(D,!0),v(u,!1),v(p,"expanded"),console.log("Location creation setup:",{isCreatingLocation:e(D),isCreatingInstance:e(u),panelState:e(p)})}function C(l){v(p,l.detail.state),e(p)==="collapsed"&&(v(O,null),v(F,null),v(D,!1),v(u,!1))}function f(l){if(!e(O))return;const I=xe.addLocation({lat:e(O).lat,lng:e(O).lng,name:l.detail.name,address:l.detail.address});v(c,[...e(c),I]),n("locationCreated",{location:I}),v(D,!1),v(O,null),v(p,"collapsed")}function A(){v(D,!1),v(O,null),v(p,"collapsed")}function R(l){if(!e(F))return;const I=xe.addInstance({locationId:e(F).id,title:l.detail.title,types:l.detail.types,description:l.detail.description});v(c,xe.loadLocations()),n("instanceCreated",{instance:I}),v(u,!1),v(F,null),v(O,null),v(p,"collapsed")}function X(){v(u,!1),v(F,null),v(O,null),v(p,"collapsed")}async function m(){if(!(!e(g).trim()||e(_))){v(_,!0);try{const I=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e(g))}&limit=1`)).json();if(I.length>0){const T=I[0],k=parseFloat(T.lat),q=parseFloat(T.lon);e(s)&&e(s).panTo(k,q,15),v(g,"")}else alert("Location not found. Please try a different search term.")}catch(l){console.error("Search error:",l),alert("Search failed. Please try again.")}finally{v(_,!1)}}}function P(l){l.key==="Enter"&&m()}function V(){e(s)&&e(s).getCurrentLocation()}function j(l,I){const T=e(c).find(k=>k.id===l);T&&e(s)&&(e(s).panTo(T.lat,T.lng,16),I&&console.log(`Navigated to location ${l}, highlighting instance ${I}`))}function ie(l=!1){return xe.loadLocations().sort((T,k)=>{const q=new Date(T.createdAt),H=new Date(k.createdAt);return l?q.getTime()-H.getTime():H.getTime()-q.getTime()})}function re(){const l=xe.loadLocations(),I={};return l.forEach(T=>{T.instances.forEach(k=>{const q=new Date(k.createdAt).toDateString();I[q]||(I[q]=[]),I[q].push({...k,location:T})})}),I}Pe(()=>(e(E),e(p)),()=>{v(a,e(E)||e(p)!=="collapsed")}),Qe(),Ge();var x=Wa(),z=y(x);et(qa(z,{get initialCenter(){return o()},get initialZoom(){return r()},get locations(){return e(c)},$$events:{mapClick:S,mapReady:M,locationClick:d,popupOpen:G},$$legacy:!0}),l=>v(s,l),()=>e(s));var Q=b(z,2);let le;var Se=y(Q),ee=y(Se);Te(ee);var oe=b(ee,2),ge=y(oe);{var De=l=>{var I=Za();B(l,I)},me=l=>{var I=Xa();B(l,I)};pe(ge,l=>{e(_)?l(De):l(me,!1)})}h(oe),h(Se),h(Q);var se=b(Q,2);let _e;var ye=y(se);h(se);var w=b(se,2);return Ua(w,{get panelState(){return e(p)},get selectedLocation(){return e(O)},get selectedLocationForInstance(){return e(F)},get isCreatingLocation(){return e(D)},get isCreatingInstance(){return e(u)},$$events:{panelStateChange:C,createLocation:f,cancelLocation:A,createInstance:R,cancelInstance:X}}),h(x),ve((l,I,T)=>{le=Ce(Q,1,"map-controls svelte-11cidy8",null,le,l),ee.disabled=e(_),oe.disabled=I,_e=Ce(se,1,"location-control svelte-11cidy8",null,_e,T)},[()=>({hidden:e(a)}),()=>(e(_),e(g),N(()=>e(_)||!e(g).trim())),()=>({hidden:e(a)})]),Ne(ee,()=>e(g),l=>v(g,l)),K("keydown",ee,P),K("click",oe,m),K("click",ye,V),B(i,x),qe(t,"navigateToLocation",j),qe(t,"getLocationsByDate",ie),qe(t,"getInstancesByDateGrouped",re),Be({navigateToLocation:j,getLocationsByDate:ie,getInstancesByDateGrouped:re})}function $e(i){switch(i){case ne.Shit:return"Shit";case ne.Cum:return"Cum";case ne.Piss:return"Piss";default:return"Unknown"}}function ja(){return Object.values(ne)}const{TIME:Qa,SHORT_DATE:en,FULL_DATE:tn}=Ee.DATE_FORMAT;function St(i){return i.toLocaleTimeString([],Qa)}function Ct(i){const t=new Date;if(i.toDateString()===t.toDateString())return`Today @ ${St(i)}`;{const n=i.toLocaleDateString([],en),o=St(i);return`${n} @ ${o}`}}function an(i){const t=new Date(i+"T00:00:00"),a=new Date,n=new Date(a);return n.setDate(n.getDate()-1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===n.toDateString()?"Yesterday":t.toLocaleDateString([],tn)}function nn(i){return i.toLocaleDateString()}var on=Z('<button class="clear-search svelte-ywq051" aria-label="Clear search"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button>'),sn=Z("<button> </button>"),rn=Z('<button class="clear-filters svelte-ywq051">Clear Filters</button>'),ln=Z('<span class="source-indicator svelte-ywq051"> </span>'),cn=Z('<div class="pin-description svelte-ywq051"> </div>'),dn=Z("<span> </span>"),vn=Z('<button class="pin-item svelte-ywq051"><div class="pin-info svelte-ywq051"><div class="pin-title svelte-ywq051"> <!></div> <div class="pin-time svelte-ywq051"> </div> <!> <div class="pin-coordinates svelte-ywq051"> </div></div> <div class="pin-types svelte-ywq051"></div></button>'),un=Z('<div class="date-group svelte-ywq051"><h3 class="date-header svelte-ywq051"> <span class="pin-count svelte-ywq051"> </span></h3> <div class="pins-grid svelte-ywq051"></div></div>'),fn=Z('<div class="empty-icon svelte-ywq051">📍</div> <h3 class="svelte-ywq051">No items yet</h3> <p class="svelte-ywq051">Switch to Map View to create your first location or pin!</p>',1),pn=Z('<div class="empty-icon svelte-ywq051">🔍</div> <h3 class="svelte-ywq051">No matching items</h3> <p class="svelte-ywq051">Try adjusting your search or filters</p> <button class="clear-filters svelte-ywq051">Clear All Filters</button>',1),hn=Z('<div class="empty-state svelte-ywq051"><!></div>'),gn=Z('<div class="date-view svelte-ywq051"><div class="header svelte-ywq051"><h2 class="title svelte-ywq051">Pins by Date</h2> <div class="subtitle svelte-ywq051"> </div></div> <div class="controls svelte-ywq051"><div class="search-bar svelte-ywq051"><svg viewBox="0 0 24 24" fill="currentColor" class="search-icon svelte-ywq051"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg> <input type="text" placeholder="Search pins..." class="search-input svelte-ywq051"/> <!></div> <div class="filters svelte-ywq051"><div class="sort-control svelte-ywq051"><button title="Newest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M7 14l5-5 5 5z"></path></svg> Newest</button> <button title="Oldest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M7 10l5 5 5-5z"></path></svg> Oldest</button></div> <div class="type-filters svelte-ywq051"></div> <div class="date-filters svelte-ywq051"><div class="date-filter-group svelte-ywq051"><label for="date-after" class="date-label svelte-ywq051">After:</label> <input id="date-after" type="date" class="date-input svelte-ywq051" title="Show pins created after this date"/></div> <div class="date-filter-group svelte-ywq051"><label for="date-before" class="date-label svelte-ywq051">Before:</label> <input id="date-before" type="date" class="date-input svelte-ywq051" title="Show pins created before this date"/></div></div> <!></div></div> <div class="pin-groups svelte-ywq051"><!> <!></div></div>');function mn(i,t){Ve(t,!1);const a=$(),n=$(),o=$(),r=We();let s=he(t,"pins",24,()=>[]),c=he(t,"locations",24,()=>[]),g=$("desc"),_=$(""),p=$([]),O=$(""),D=$("");const F=ja();function u(w,l){const I=[];return w.forEach(T=>{I.push({id:T.id,title:T.title,description:T.description,types:T.types||[T.type],createdAt:T.createdAt,lat:T.lat,lng:T.lng,source:"pin"})}),l.forEach(T=>{T.instances.forEach(k=>{I.push({id:k.id,title:T.name,description:k.description,types:k.types,createdAt:k.createdAt,lat:T.lat,lng:T.lng,source:"instance",locationId:T.id,locationName:T.name})})}),I}function E(w,l,I,T,k,q){console.log("Filtering items:",{items:w.length,searchTerm:l,selectedTypes:I,sortOrder:T,dateAfter:k,dateBefore:q});let H=w.filter(J=>{const ae=!l||J.title.toLowerCase().includes(l.toLowerCase())||J.description&&J.description.toLowerCase().includes(l.toLowerCase()),we=I.length===0||I.some(Fe=>J.types.includes(Fe)),be=new Date(J.createdAt.getFullYear(),J.createdAt.getMonth(),J.createdAt.getDate()),U=!k||be>=new Date(k),Oe=!q||be<=new Date(q);return ae&&we&&U&&Oe});console.log("After filtering:",H.length),H.sort((J,ae)=>{const we=J.createdAt.getTime(),be=ae.createdAt.getTime();return T==="desc"?be-we:we-be});const te={};return H.forEach(J=>{const ae=nn(J.createdAt);te[ae]||(te[ae]=[]),te[ae].push(J)}),Y.debug(`Grouped items into ${Object.keys(te).length} date groups`),te}function S(w){Y.debug(`Item clicked in date view: ${w.id} (source: ${w.source})`),w.source==="pin"?r("navigateToPin",{pinId:w.id}):w.source==="instance"&&r("navigateToLocation",{locationId:w.locationId,instanceId:w.id})}function M(w){return an(w)}function G(w){e(p).includes(w)?v(p,e(p).filter(l=>l!==w)):v(p,[...e(p),w]),Y.debug(`Type filter toggled: ${w}, active filters:`,e(p))}function d(){v(_,""),v(p,[]),v(O,""),v(D,""),Y.debug("All filters cleared")}Pe(()=>(W(s()),W(c())),()=>{v(a,u(s(),c()))}),Pe(()=>(e(a),e(_),e(p),e(g),e(O),e(D)),()=>{v(n,E(e(a),e(_),e(p),e(g),e(O),e(D)))}),Pe(()=>e(n),()=>{v(o,Object.values(e(n)).flat().length)}),Qe(),Ge();var L=gn(),C=y(L),f=b(y(C),2),A=y(f);h(f),h(C);var R=b(C,2),X=y(R),m=b(y(X),2);Te(m);var P=b(m,2);{var V=w=>{var l=on();K("click",l,()=>v(_,"")),B(w,l)};pe(P,w=>{e(_)&&w(V)})}h(X);var j=b(X,2),ie=y(j),re=y(ie),x=b(re,2);h(ie);var z=b(ie,2);Ue(z,5,()=>F,ze,(w,l)=>{var I=sn(),T=y(I,!0);h(I),ve((k,q,H)=>{Ce(I,1,`type-filter ${k??""} type-${e(l)??""}`,"svelte-ywq051"),ke(I,"title",`Filter by ${q??""}`),de(T,H)},[()=>(e(p),e(l),N(()=>e(p).includes(e(l))?"active":"")),()=>(W($e),e(l),N(()=>$e(e(l)))),()=>(W($e),e(l),N(()=>$e(e(l))))]),K("click",I,()=>G(e(l))),B(w,I)}),h(z);var Q=b(z,2),le=y(Q),Se=b(y(le),2);Te(Se),h(le);var ee=b(le,2),oe=b(y(ee),2);Te(oe),h(ee),h(Q);var ge=b(Q,2);{var De=w=>{var l=rn();K("click",l,d),B(w,l)};pe(ge,w=>{e(_),e(p),e(O),e(D),N(()=>e(_)||e(p).length>0||e(O)||e(D))&&w(De)})}h(j),h(R);var me=b(R,2),se=y(me);Ue(se,1,()=>(e(n),N(()=>Object.entries(e(n)))),ze,(w,l)=>{var I=Ta(()=>Ea(e(l),2));let T=()=>e(I)[0],k=()=>e(I)[1];var q=un(),H=y(q),te=y(H),J=b(te),ae=y(J);h(J),h(H);var we=b(H,2);Ue(we,5,k,ze,(be,U)=>{var Oe=vn(),Fe=y(Oe),tt=y(Fe),pt=y(tt),Gt=b(pt);{var Vt=Le=>{var fe=ln(),Ie=y(fe);h(fe),ve(()=>de(Ie,`@${e(U),N(()=>e(U).locationName)??""}`)),B(Le,fe)};pe(Gt,Le=>{e(U),N(()=>e(U).source==="instance")&&Le(Vt)})}h(tt);var at=b(tt,2),Bt=y(at,!0);h(at);var ht=b(at,2);{var zt=Le=>{var fe=cn(),Ie=y(fe,!0);h(fe),ve(()=>de(Ie,(e(U),N(()=>e(U).description)))),B(Le,fe)};pe(ht,Le=>{e(U),N(()=>e(U).description)&&Le(zt)})}var gt=b(ht,2),Ut=y(gt);h(gt),h(Fe);var mt=b(Fe,2);Ue(mt,5,()=>(e(U),N(()=>e(U).types)),ze,(Le,fe)=>{var Ie=dn(),Yt=y(Ie,!0);h(Ie),ve(Kt=>{Ce(Ie,1,`type-badge type-${e(fe)??""}`,"svelte-ywq051"),de(Yt,Kt)},[()=>(W($e),e(fe),N(()=>$e(e(fe))))]),B(Le,Ie)}),h(mt),h(Oe),ve((Le,fe,Ie)=>{ke(Oe,"title",`Click to navigate to ${e(U),N(()=>e(U).source==="pin"?"pin":"location")??""} on map`),de(pt,`${e(U),N(()=>e(U).title)??""} `),de(Bt,Le),de(Ut,`${fe??""}, ${Ie??""}`)},[()=>(W(Ct),e(U),N(()=>Ct(e(U).createdAt))),()=>(e(U),N(()=>e(U).lat.toFixed(4))),()=>(e(U),N(()=>e(U).lng.toFixed(4)))]),K("click",Oe,()=>S(e(U))),B(be,Oe)}),h(we),h(q),ve(be=>{de(te,`${be??""} `),de(ae,`${k(),N(()=>k().length)??""} item${k(),N(()=>k().length===1?"":"s")??""}`)},[()=>(T(),N(()=>M(T())))]),B(w,q)});var _e=b(se,2);{var ye=w=>{var l=hn(),I=y(l);{var T=q=>{var H=fn();Ke(4),B(q,H)},k=q=>{var H=pn(),te=b(He(H),6);K("click",te,d),B(q,H)};pe(I,q=>{W(s()),W(c()),N(()=>s().length===0&&c().length===0)?q(T):q(k,!1)})}h(l),B(w,l)};pe(_e,w=>{e(n),N(()=>Object.keys(e(n)).length===0)&&w(ye)})}h(me),h(L),ve(w=>{de(A,`${e(o)??""} of ${w??""} items`),Ce(re,1,`sort-btn ${e(g)==="desc"?"active":""}`,"svelte-ywq051"),Ce(x,1,`sort-btn ${e(g)==="asc"?"active":""}`,"svelte-ywq051")},[()=>(W(s()),W(c()),N(()=>s().length+c().reduce((w,l)=>w+l.instances.length,0)))]),Ne(m,()=>e(_),w=>v(_,w)),K("click",re,()=>v(g,"desc")),K("click",x,()=>v(g,"asc")),Ne(Se,()=>e(O),w=>v(O,w)),Ne(oe,()=>e(D),w=>v(D,w)),B(i,L),Be()}var _n=Z('<meta name="description" content="Interactive map to track bodily functions and see date-based views"/>'),yn=Z('<span class="count-breakdown svelte-1n4x2v2"> </span>'),wn=Z('<div class="app-container svelte-1n4x2v2"><div class="view-switcher svelte-1n4x2v2"><div class="view-controls svelte-1n4x2v2"><button><svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg> Map View</button> <button><svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></svg> Date View</button></div> <div class="pin-count svelte-1n4x2v2"> <!></div></div> <div class="content svelte-1n4x2v2"><!></div></div>');function On(i,t){Ve(t,!1);const a=$();let n=$(),o=$([]),r=$("map");ut(()=>{s(),c(),D()});function s(){try{v(o,xe.loadLocations()),Y.debug(`Loaded ${e(o).length} locations in main page`)}catch(m){Y.error("Failed to load data in main page",m),v(o,[])}}function c(){const m=()=>{Y.debug("Storage changed, reloading data"),s()};return window.addEventListener("storage",m),()=>{window.removeEventListener("storage",m)}}function g(m){Y.debug(`Navigating to location: ${m.detail.locationId}, instance: ${m.detail.instanceId}`),v(r,"map"),setTimeout(()=>{e(n)?.navigateToLocation(m.detail.locationId,m.detail.instanceId)},Ee.UI.ANIMATION_DURATION/3)}function _(){s()}function p(m){console.log("switchView called with:",m,"current:",e(r)),e(r)!==m&&(Y.debug(`Switching view from ${e(r)} to ${m}`),v(r,m),m==="date"&&_())}function O(m){const{altKey:P,key:V}=m;if(P&&V==="d"){m.preventDefault(),p("date");return}if(P&&V==="m"){m.preventDefault(),p("map");return}}function D(){Y.debug("Setting up keyboard shortcuts")}Pe(()=>e(o),()=>{v(a,e(o).reduce((m,P)=>m+P.instances.length,0))}),Qe(),Ge();var F=wn();Jt(m=>{var P=_n();Sa.title="Shumpiss",B(m,P)}),K("keydown",Ca,O);var u=y(F),E=y(u),S=y(E),M=b(S,2);h(E);var G=b(E,2),d=y(G),L=b(d);{var C=m=>{var P=yn(),V=y(P);h(P),ve(()=>de(V,`(${e(o),N(()=>e(o).length)??""} location${e(o),N(()=>e(o).length===1?"":"s")??""})`)),B(m,P)};pe(L,m=>{e(o),N(()=>e(o).length>0)&&m(C)})}h(G),h(u);var f=b(u,2),A=y(f);{var R=m=>{var P=qt(),V=He(P);Na(V,()=>e(r),j=>{et(Ja(j,{get initialCenter(){return W(Ee),N(()=>Ee.MAP.DEFAULT_CENTER)},get initialZoom(){return W(Ee),N(()=>Ee.MAP.DEFAULT_ZOOM)},$$events:{locationCreated:_,instanceCreated:_,locationDeleted:_,instanceDeleted:_},$$legacy:!0}),ie=>v(n,ie),()=>e(n))}),B(m,P)},X=m=>{mn(m,{get locations(){return e(o)},$$events:{navigateToLocation:g}})};pe(A,m=>{e(r)==="map"?m(R):m(X,!1)})}h(f),h(F),ve(()=>{Ce(S,1,`view-btn ${e(r)==="map"?"active":""}`,"svelte-1n4x2v2"),ke(S,"title",`Map View (${W(Ye),N(()=>Ye.SWITCH_TO_MAP_VIEW)??""})`),Ce(M,1,`view-btn ${e(r)==="date"?"active":""}`,"svelte-1n4x2v2"),ke(M,"title",`Date View (${W(Ye),N(()=>Ye.SWITCH_TO_DATE_VIEW)??""})`),de(d,`${e(a)??""} item${e(a)===1?"":"s"} `)}),K("click",S,()=>p("map")),K("click",M,()=>p("date")),B(i,F),Be()}export{On as component};
