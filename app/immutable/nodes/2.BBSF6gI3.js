import"../chunks/DsnmJJEf.js";import{i as Ge}from"../chunks/BO1dTzpG.js";import{a as Zt,l as Xt,c as We,o as ut,b as _t,e as K,r as Wt,s as de,d as Jt}from"../chunks/DUgMGJGx.js";import{w as ue,x as xt,aC as Dt,aD as jt,aE as Qt,v as Nt,C as ft,D as Ze,F as Me,G as Ot,K as Re,U as ea,J as Mt,A as nt,aa as ta,g as e,R as aa,y as na,H as oa,z as wt,B as ot,ai as ia,an as sa,aF as Je,aG as je,aH as kt,aq as $t,ag as ra,a5 as $,aI as bt,aJ as Lt,I as Rt,aK as it,N as la,aL as Pt,aM as ca,aN as da,ak as va,aO as ua,ab as fa,aP as pa,X as ha,aQ as ga,aR as ma,aS as _a,aT as wa,aU as ba,b as D,M as La,O as Ia,af as Aa,p as Ve,aV as Xe,V as v,aW as Pe,e as W,aX as Qe,l as Z,k as B,m as Be,n as w,q as L,o as h,t as ve,j as He,aY as Ke,i as qt,aZ as ya,a8 as Ta,a_ as Ea,a$ as Sa,b0 as Ca}from"../chunks/C-cdoq8H.js";import{p as he,_ as xa,b as et,i as pe}from"../chunks/DR0M7r5p.js";function Da(o,t,a){ue&&xt();var n=o,i=ea,r,s,c=null,g=Dt()?jt:Qt;function m(){r&&Mt(r),c!==null&&(c.lastChild.remove(),n.before(c),c=null),r=s}Nt(()=>{if(g(i,i=t())){var p=n,N=Ot();N&&(c=document.createDocumentFragment(),c.append(p=ft())),s=Ze(()=>a(p)),N?Me.add_callback(m):m()}}),ue&&(n=Re)}function ze(o,t){return t}function Na(o,t,a){for(var n=o.items,i=[],r=t.length,s=0;s<r;s++)ua(t[s].e,i,!0);var c=r>0&&i.length===0&&a!==null;if(c){var g=a.parentNode;fa(g),g.append(a),n.clear(),ye(o,t[0].prev,t[r-1].next)}pa(i,()=>{for(var m=0;m<r;m++){var p=t[m];c||(n.delete(p.k),ye(o,p.prev,p.next)),Pt(p.e,!c)}})}function Ue(o,t,a,n,i,r=null){var s=o,c={flags:t,items:new Map,first:null},g=(t&kt)!==0;if(g){var m=o;s=ue?nt(ta(m)):m.appendChild(ft())}ue&&xt();var p=null,N=!1,x=new Map,F=aa(()=>{var O=a();return ra(O)?O:O==null?[]:$t(O)}),u,E;function S(){Oa(E,u,c,x,s,i,t,n,a),r!==null&&(u.length===0?p?Rt(p):p=Ze(()=>r(s)):p!==null&&Mt(p,()=>{p=null}))}Nt(()=>{E??=ha,u=e(F);var O=u.length;if(N&&O===0)return;N=O===0;let G=!1;if(ue){var d=na(s)===oa;d!==(O===0)&&(s=wt(),nt(s),ot(!1),G=!0)}if(ue){for(var I=null,C,f=0;f<O;f++){if(Re.nodeType===ia&&Re.data===sa){s=Re,G=!0,ot(!1);break}var y=u[f],R=n(y,f);C=vt(Re,c,I,null,y,R,f,i,t,a),c.items.set(R,C),I=C}O>0&&nt(wt())}if(ue)O===0&&r&&(p=Ze(()=>r(s)));else if(Ot()){var X=new Set,_=Me;for(f=0;f<O;f+=1){y=u[f],R=n(y,f);var P=c.items.get(R)??x.get(R);P?(t&(Je|je))!==0&&Ft(P,y,f,t):(C=vt(null,c,null,null,y,R,f,i,t,a,!0),x.set(R,C)),X.add(R)}for(const[V,j]of c.items)X.has(V)||_.skipped_effects.add(j.e);_.add_callback(S)}else S();G&&ot(!0),e(F)}),ue&&(s=Re)}function Oa(o,t,a,n,i,r,s,c,g){var m=(s&da)!==0,p=(s&(Je|je))!==0,N=t.length,x=a.items,F=a.first,u=F,E,S=null,O,G=[],d=[],I,C,f,y;if(m)for(y=0;y<N;y+=1)I=t[y],C=c(I,y),f=x.get(C),f!==void 0&&(f.a?.measure(),(O??=new Set).add(f));for(y=0;y<N;y+=1){if(I=t[y],C=c(I,y),f=x.get(C),f===void 0){var R=n.get(C);if(R!==void 0){n.delete(C),x.set(C,R);var X=S?S.next:u;ye(a,S,R),ye(a,R,X),st(R,X,i),S=R}else{var _=u?u.e.nodes_start:i;S=vt(_,a,S,S===null?a.first:S.next,I,C,y,r,s,g)}x.set(C,S),G=[],d=[],u=S.next;continue}if(p&&Ft(f,I,y,s),(f.e.f&it)!==0&&(Rt(f.e),m&&(f.a?.unfix(),(O??=new Set).delete(f))),f!==u){if(E!==void 0&&E.has(f)){if(G.length<d.length){var P=d[0],V;S=P.prev;var j=G[0],oe=G[G.length-1];for(V=0;V<G.length;V+=1)st(G[V],P,i);for(V=0;V<d.length;V+=1)E.delete(d[V]);ye(a,j.prev,oe.next),ye(a,S,j),ye(a,oe,P),u=P,S=oe,y-=1,G=[],d=[]}else E.delete(f),st(f,u,i),ye(a,f.prev,f.next),ye(a,f,S===null?a.first:S.next),ye(a,S,f),S=f;continue}for(G=[],d=[];u!==null&&u.k!==C;)(u.e.f&it)===0&&(E??=new Set).add(u),d.push(u),u=u.next;if(u===null)continue;f=u}G.push(f),S=f,u=f.next}if(u!==null||E!==void 0){for(var re=E===void 0?[]:$t(E);u!==null;)(u.e.f&it)===0&&re.push(u),u=u.next;var M=re.length;if(M>0){var z=(s&kt)!==0&&N===0?i:null;if(m){for(y=0;y<M;y+=1)re[y].a?.measure();for(y=0;y<M;y+=1)re[y].a?.fix()}Na(a,re,z)}}m&&la(()=>{if(O!==void 0)for(f of O)f.a?.apply()}),o.first=a.first&&a.first.e,o.last=S&&S.e;for(var Q of n.values())Pt(Q.e);n.clear()}function Ft(o,t,a,n){(n&Je)!==0&&Lt(o.v,t),(n&je)!==0?Lt(o.i,a):o.i=a}function vt(o,t,a,n,i,r,s,c,g,m,p){var N=(g&Je)!==0,x=(g&ca)===0,F=N?x?$(i,!1,!1):bt(i):i,u=(g&je)===0?s:bt(s),E={i:u,v:F,k:r,a:null,e:null,prev:a,next:n};try{if(o===null){var S=document.createDocumentFragment();S.append(o=ft())}return E.e=Ze(()=>c(o,F,u,m),ue),E.e.prev=a&&a.e,E.e.next=n&&n.e,a===null?p||(t.first=E):(a.next=E,a.e.next=E.e),n!==null&&(n.prev=E,n.e.prev=E.e),E}finally{}}function st(o,t,a){for(var n=o.next?o.next.e.nodes_start:a,i=t?t.e.nodes_start:a,r=o.e.nodes_start;r!==null&&r!==n;){var s=va(r);i.before(r),r=s}}function ye(o,t,a){t===null?o.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}const It=[...` 	
\r\f \v\uFEFF`];function Ma(o,t,a){var n=o==null?"":""+o;if(t&&(n=n?n+" "+t:t),a){for(var i in a)if(a[i])n=n?n+" "+i:i;else if(n.length)for(var r=i.length,s=0;(s=n.indexOf(i,s))>=0;){var c=s+r;(s===0||It.includes(n[s-1]))&&(c===n.length||It.includes(n[c]))?n=(s===0?"":n.substring(0,s))+n.substring(c+1):s=c}}return n===""?null:n}function Ce(o,t,a,n,i,r){var s=o.__className;if(ue||s!==a||s===void 0){var c=Ma(a,n,r);(!ue||c!==o.getAttribute("class"))&&(c==null?o.removeAttribute("class"):o.className=c),o.__className=a}else if(r&&i!==r)for(var g in r){var m=!!r[g];(i==null||m!==!!i[g])&&o.classList.toggle(g,m)}return r}const ka=Symbol("is custom element"),$a=Symbol("is html");function Te(o){if(ue){var t=!1,a=()=>{if(!t){if(t=!0,o.hasAttribute("value")){var n=o.value;ke(o,"value",null),o.value=n}if(o.hasAttribute("checked")){var i=o.checked;ke(o,"checked",null),o.checked=i}}};o.__on_r=a,wa(a),Zt()}}function rt(o,t){var a=Ht(o);a.checked!==(a.checked=t??void 0)&&(o.checked=t)}function ke(o,t,a,n){var i=Ht(o);ue&&(i[t]=o.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&o.nodeName==="LINK")||i[t]!==(i[t]=a)&&(t==="loading"&&(o[ba]=a),a==null?o.removeAttribute(t):typeof a!="string"&&Ra(o).includes(t)?o[t]=a:o.setAttribute(t,a))}function Ht(o){return o.__attributes??={[ka]:o.nodeName.includes("-"),[$a]:o.namespaceURI===ga}}var At=new Map;function Ra(o){var t=At.get(o.nodeName);if(t)return t;At.set(o.nodeName,t=[]);for(var a,n=o,i=Element.prototype;i!==n;){a=_a(n);for(var r in a)a[r].set&&t.push(r);n=ma(n)}return t}function De(o,t,a=t){var n=Dt(),i=new WeakSet;Xt(o,"input",r=>{var s=r?o.defaultValue:o.value;if(s=lt(o)?ct(s):s,a(s),Me!==null&&i.add(Me),n&&s!==(s=t())){var c=o.selectionStart,g=o.selectionEnd;o.value=s??"",g!==null&&(o.selectionStart=c,o.selectionEnd=Math.min(g,o.value.length))}}),(ue&&o.defaultValue!==o.value||D(t)==null&&o.value)&&(a(lt(o)?ct(o.value):o.value),Me!==null&&i.add(Me)),La(()=>{var r=t();o===document.activeElement&&i.has(Me)||lt(o)&&r===ct(o.value)||o.type==="date"&&!r&&!o.value||r!==o.value&&(o.value=r??"")})}function lt(o){var t=o.type;return t==="number"||t==="range"}function ct(o){return o===""?null:+o}function qe(o,t,a){var n=Ia(o,t);n&&n.set&&(o[t]=a,Aa(()=>{o[t]=null}))}var Pa=Z('<div class="map-container svelte-50y1od"></div>');function qa(o,t){Ve(t,!1);let a=he(t,"initialCenter",24,()=>[53.4076,-2.9921]),n=he(t,"initialZoom",8,13),i=he(t,"locations",24,()=>[]);const r=We();let s=$(),c=$(),g=$(),m=[],p=!1;ut(async()=>{if(!e(s)||(e(s)&&Xe(s,e(s).innerHTML=""),await new Promise(I=>setTimeout(I,10)),!e(s)||!e(s).parentNode))return;v(g,await xa(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url));const d=document.createElement("link");d.rel="stylesheet",d.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(d);try{if(!e(s)||!e(s).parentNode)return;v(c,e(g).map(e(s),{center:a(),zoom:n(),zoomControl:!1,attributionControl:!1})),e(g).tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:""}).addTo(e(c)),e(g).control.zoom({position:"bottomright"}).addTo(e(c)),e(c).on("click",C=>{r("mapClick",{latlng:C.latlng})}),e(c).on("popupopen",()=>{p=!0,r("popupOpen",{open:!0})}),e(c).on("popupclose",()=>{p=!1,r("popupOpen",{open:!1})}),e(g).control.attribution({position:"bottomleft",prefix:!1}).addAttribution("© OpenStreetMap contributors").addTo(e(c)),r("mapReady",{map:e(c)}),u()}catch(I){console.error("Failed to initialize map:",I)}}),_t(()=>{e(c)&&e(c).remove()});function N(){console.log("Updating markers, locations:",i()),m.forEach(d=>e(c).removeLayer(d)),m=[],i().forEach(d=>{const I=e(g).divIcon({className:"custom-location-pin",html:`
					<div class="location-pin-container">
						<div class="location-pin-body"></div>
						<div class="location-pin-point"></div>
						${d.instances.length>0?`<div class="instance-count">${d.instances.length}</div>`:""}
					</div>
				`,iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-40]}),C=[...d.instances].sort((y,R)=>new Date(R.createdAt).getTime()-new Date(y.createdAt).getTime()),f=e(g).marker([d.lat,d.lng],{icon:I}).addTo(e(c)).bindPopup(x(d,C),{maxWidth:350,className:"location-popup"});f.locationId=d.id,m.push(f)})}function x(d,I){return`
			<div class="popup-content" data-location-id="${d.id}">
				<div class="popup-header">
					<h3 class="popup-title">${d.name}</h3>
				</div>
				${d.address?`<p class="popup-address">${d.address}</p>`:""}
				
				${I.length===0?`
					<div class="popup-instances">
						<p class="no-instances">No events yet</p>
						<button class="add-event-btn" onclick="window.addEventToLocation('${d.id}')">
							<svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add First Event
						</button>
					</div>
				`:`
					<div class="popup-instances">
						<div class="instance-header">
							<span class="instance-counter">
								<span class="current-instance">1</span> / ${I.length}
							</span>
							<div class="instance-controls">
								${I.length>1?`
									<button class="nav-btn" onclick="window.navigateInstance('${d.id}', -1)" title="Previous event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
										</svg>
									</button>
									<button class="nav-btn" onclick="window.navigateInstance('${d.id}', 1)" title="Next event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
										</svg>
									</button>
								`:""}
								<button class="add-event-btn small" onclick="window.addEventToLocation('${d.id}')" title="Add event">
									<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
										<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
									</svg>
								</button>
							</div>
						</div>
						<div class="current-instance-display" data-current-index="0">
							${F(I[0])}
						</div>
					</div>
				`}
				
				<div class="popup-footer">
					<div class="popup-date">Location created: ${d.createdAt.toLocaleDateString()}</div>
					<p class="popup-coords">
						${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}
					</p>
				</div>
			</div>
		`}function F(d){return`
			<div class="instance-item current">
				<div class="instance-title">${d.title}</div>
				${d.description?`<div class="instance-description">${d.description}</div>`:""}
				<div class="instance-types">${d.types.join(", ")}</div>
				<div class="instance-date">${d.createdAt.toLocaleDateString()} at ${d.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
			</div>
		`}function u(){window.addEventToLocation=d=>{const I=i().find(C=>C.id===d);I&&(e(c).closePopup(),setTimeout(()=>{r("locationClick",{location:I})},10))},window.navigateInstance=(d,I)=>{const C=i().find(j=>j.id===d);if(!C||C.instances.length<=1)return;const f=document.querySelector(`[data-location-id="${d}"]`);if(!f)return;const y=f.querySelector(".current-instance-display"),R=y?.getAttribute("data-current-index")||"0";let X=parseInt(R,10);const _=C.instances.length;X=(X+I+_)%_;const P=[...C.instances].sort((j,oe)=>new Date(oe.createdAt).getTime()-new Date(j.createdAt).getTime());y.setAttribute("data-current-index",X.toString()),y.innerHTML=F(P[X]);const V=f.querySelector(".current-instance");V&&(V.textContent=(X+1).toString())}}function E(d,I,C){if(e(c)){const f=C||e(c).getZoom();e(c).setView([d,I],f);const R=e(c).getSize().y*.25;e(c).panBy([0,R],{animate:!0,duration:.3})}}function S(){typeof navigator<"u"&&"geolocation"in navigator?navigator.geolocation.getCurrentPosition(d=>{const I=d.coords.latitude,C=d.coords.longitude;E(I,C,16),r("mapClick",{latlng:e(g).latLng(I,C)})},d=>{console.error("Geolocation error:",d),alert("Could not get your location. Please make sure location access is enabled.")}):alert("Geolocation is not supported by this browser.")}function O(d){return m.find(I=>I.locationId===d.id)||null}_t(()=>{if(window.addEventToLocation&&delete window.addEventToLocation,window.navigateInstance&&delete window.navigateInstance,e(c)&&e(c).getContainer())try{const d=e(c).getContainer();d&&d.parentNode&&(e(c).off(),e(c).remove())}catch(d){console.debug("Map cleanup handled (view switch):",d.message)}finally{v(c,null)}if(m=[],e(s)&&e(s).parentNode)try{Xe(s,e(s).innerHTML="")}catch(d){console.debug("Container cleanup handled:",d.message)}}),Pe(()=>(e(c),e(g),W(i())),()=>{e(c)&&e(g)&&i()&&N()}),Qe(),Ge();var G=Pa();return ke(G,"id",`map-${D(()=>Math.random().toString(36).substr(2,9))??""}`),et(G,d=>v(s,d),()=>e(s)),B(o,G),qe(t,"panTo",E),qe(t,"getCurrentLocation",S),qe(t,"getMarkerForLocation",O),Be({panTo:E,getCurrentLocation:S,getMarkerForLocation:O})}const Ee={MAP:{DEFAULT_CENTER:[53.4084,-2.9916],DEFAULT_ZOOM:13,MAX_ZOOM:19},STORAGE:{PIN_STORAGE_KEY:"map-pins",STORAGE_VERSION:1},UI:{PANEL_HEIGHTS:{COLLAPSED:60,PARTIAL:200,EXPANDED_OFFSET:.2},ANIMATION_DURATION:300,SEARCH_DEBOUNCE:300},PINS:{MAX_TITLE_LENGTH:100,MAX_DESCRIPTION_LENGTH:500,ID_LENGTH:16},DATE_FORMAT:{TIME:{hour:"2-digit",minute:"2-digit"},SHORT_DATE:{month:"short",day:"numeric"},FULL_DATE:{weekday:"long",month:"long",day:"numeric",year:"numeric"}}},Ye={SWITCH_TO_DATE_VIEW:"Alt+D",SWITCH_TO_MAP_VIEW:"Alt+M",ESCAPE:"Escape"},yt={STORAGE_SAVE_FAILED:"Failed to save pins",STORAGE_LOAD_FAILED:"Failed to load pins"};class Fa{level=1;constructor(){if(typeof window<"u"){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";this.level=t?0:2}}shouldLog(t){return t>=this.level}formatMessage(t,a,n){const r=`[${new Date().toISOString()}] [${t}]`;return n?`${r} ${a}`:`${r} ${a}`}debug(t,a){this.shouldLog(0)&&console.debug(this.formatMessage("DEBUG",t),a||"")}info(t,a){this.shouldLog(1)&&console.info(this.formatMessage("INFO",t),a||"")}warn(t,a){this.shouldLog(2)&&console.warn(this.formatMessage("WARN",t),a||"")}error(t,a){this.shouldLog(3)&&console.error(this.formatMessage("ERROR",t),a||"")}}const Y=new Fa;class ce extends Error{constructor(t,a,n){super(t),this.code=a,this.context=n,this.name="AppError"}}function Tt(o,t,a){try{return o()}catch(n){throw Y.error(`${t}: ${n.message}`,n),new ce(t,a,n)}}var ne=(o=>(o.Shit="shit",o.Cum="cum",o.Piss="piss",o))(ne||{});const{PIN_STORAGE_KEY:En}=Ee.STORAGE,{MAX_TITLE_LENGTH:Sn,MAX_DESCRIPTION_LENGTH:Cn,ID_LENGTH:xn}=Ee.PINS;var Ha=Z('<div class="location-header svelte-1x7a3co"><h2 class="location-title svelte-1x7a3co"> </h2> <button class="close-button svelte-1x7a3co" aria-label="Close panel">×</button></div> <div class="pin-form svelte-1x7a3co"><div class="form-group svelte-1x7a3co"><span class="form-label svelte-1x7a3co">Instance Types * (select one or more)</span> <div class="checkbox-group svelte-1x7a3co"><label class="checkbox-option svelte-1x7a3co"><input type="checkbox" class="svelte-1x7a3co"/> <span class="checkbox-label svelte-1x7a3co">💩 Shit</span></label> <label class="checkbox-option svelte-1x7a3co"><input type="checkbox" class="svelte-1x7a3co"/> <span class="checkbox-label svelte-1x7a3co">🍆 Cum</span></label> <label class="checkbox-option svelte-1x7a3co"><input type="checkbox" class="svelte-1x7a3co"/> <span class="checkbox-label svelte-1x7a3co">💦 Piss</span></label></div></div> <div class="form-group svelte-1x7a3co"><label for="instance-title" class="form-label svelte-1x7a3co">Instance Title *</label> <input id="instance-title" type="text" placeholder="Enter a title for this instance..." class="form-input svelte-1x7a3co" maxlength="100"/></div> <div class="form-group svelte-1x7a3co"><label for="instance-description" class="form-label svelte-1x7a3co">Description (optional)</label> <textarea id="instance-description" placeholder="Add a description or notes..." class="form-textarea svelte-1x7a3co" rows="3" maxlength="500"></textarea></div> <div class="form-actions svelte-1x7a3co"><button class="action-button secondary svelte-1x7a3co">Cancel</button> <button class="action-button primary svelte-1x7a3co">Save Instance</button></div></div>',1),Ga=Z('<div class="coordinates svelte-1x7a3co"> </div>'),Va=Z(`<div class="location-header svelte-1x7a3co"><h2 class="location-title svelte-1x7a3co">Create New Location</h2> <button class="close-button svelte-1x7a3co" aria-label="Close panel">×</button></div> <div class="pin-form svelte-1x7a3co"><div class="form-group svelte-1x7a3co"><label class="form-label svelte-1x7a3co" for="location-name">Location Name *</label> <input id="location-name" type="text" placeholder="e.g., McDonald's Downtown" class="form-input svelte-1x7a3co" maxlength="100"/></div> <div class="form-group svelte-1x7a3co"><label class="form-label svelte-1x7a3co" for="location-address">Address (optional)</label> <input id="location-address" type="text" placeholder="Enter address or description" class="form-input svelte-1x7a3co" maxlength="200"/></div> <!> <div class="form-buttons svelte-1x7a3co"><button class="cancel-btn svelte-1x7a3co">Cancel</button> <button class="create-btn svelte-1x7a3co">Create Location</button></div></div>`,1),Ba=Z('<div class="empty-state svelte-1x7a3co"><h3 class="svelte-1x7a3co">Tap on the map</h3> <p class="svelte-1x7a3co">Click anywhere on the map to create a new location, or click an existing location to add an instance</p></div>'),za=Z('<div><div class="panel-handle svelte-1x7a3co" role="button" tabindex="0" aria-label="Drag to resize panel"><div class="handle-bar svelte-1x7a3co"></div></div> <div class="panel-content svelte-1x7a3co"><!></div></div>');function Ua(o,t){Ve(t,!1);let a=he(t,"panelState",12,"collapsed"),n=he(t,"selectedLocation",8,null),i=he(t,"selectedLocationForInstance",8,null),r=he(t,"isCreatingLocation",8,!1),s=he(t,"isCreatingInstance",8,!1);const c=We();let g=$(),m=!1,p=0,N=0,x=$(""),F=$(""),u=$(new Set([ne.Shit])),E=$(""),S=$("");function O(M){a(M),c("panelStateChange",{state:M})}function G(M){m=!0,p="touches"in M?M.touches[0].clientY:M.clientY;const z=e(g).getBoundingClientRect();N=window.innerHeight-z.top,document.addEventListener("mousemove",d),document.addEventListener("mouseup",I),document.addEventListener("touchmove",d),document.addEventListener("touchend",I)}function d(M){if(!m)return;const z="touches"in M?M.touches[0].clientY:M.clientY,Q=p-z,le=Math.max(60,Math.min(window.innerHeight*.8,N+Q));Xe(g,e(g).style.transform=`translateY(${window.innerHeight-le}px)`)}function I(){if(!m)return;m=!1;const M=e(g).getBoundingClientRect(),z=window.innerHeight-M.top;z<120?O("collapsed"):z<window.innerHeight*.4?O("partial"):O("expanded"),Xe(g,e(g).style.transform=""),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",I),document.removeEventListener("touchmove",d),document.removeEventListener("touchend",I)}function C(){!i()||!e(x).trim()||e(u).size===0||(c("createInstance",{title:e(x).trim(),description:e(F).trim()||void 0,types:Array.from(e(u))}),v(x,""),v(F,""),v(u,new Set([ne.Shit])))}function f(){v(x,""),v(F,""),v(u,new Set([ne.Shit])),c("cancelInstance")}function y(M){const z=M;e(u).has(z)?e(u).delete(z):e(u).add(z),v(u,new Set(e(u)))}function R(){!n()||!e(E).trim()||(c("createLocation",{name:e(E).trim(),address:e(S).trim()||void 0}),v(E,""),v(S,""))}function X(){v(E,""),v(S,""),c("cancelLocation")}Ge();var _=za(),P=w(_),V=L(P,2),j=w(V);{var oe=M=>{var z=Ha(),Q=He(z),le=w(Q),Se=w(le);h(le);var ee=L(le,2);h(Q);var ie=L(Q,2),ge=w(ie),xe=L(w(ge),2),me=w(xe),se=w(me);Te(se),Ke(2),h(me);var _e=L(me,2),we=w(_e);Te(we),Ke(2),h(_e);var b=L(_e,2),l=w(b);Te(l),Ke(2),h(b),h(xe),h(ge);var A=L(ge,2),T=L(w(A),2);Te(T),h(A);var k=L(A,2),q=L(w(k),2);Wt(q),h(k);var H=L(k,2),te=w(H),J=L(te,2);h(H),h(ie),ve((ae,be,Le,U)=>{de(Se,`Add Instance to ${W(i()),D(()=>i().name)??""}`),rt(se,ae),rt(we,be),rt(l,Le),J.disabled=U},[()=>(e(u),W(ne),D(()=>e(u).has(ne.Shit))),()=>(e(u),W(ne),D(()=>e(u).has(ne.Cum))),()=>(e(u),W(ne),D(()=>e(u).has(ne.Piss))),()=>(e(x),e(u),D(()=>!e(x).trim()||e(u).size===0))]),K("click",ee,()=>O("collapsed")),K("change",se,()=>y(ne.Shit)),K("change",we,()=>y(ne.Cum)),K("change",l,()=>y(ne.Piss)),De(T,()=>e(x),ae=>v(x,ae)),De(q,()=>e(F),ae=>v(F,ae)),K("click",te,f),K("click",J,C),B(M,z)},re=M=>{var z=qt(),Q=He(z);{var le=ee=>{var ie=Va(),ge=He(ie),xe=L(w(ge),2);h(ge);var me=L(ge,2),se=w(me),_e=L(w(se),2);Te(_e),h(se);var we=L(se,2),b=L(w(we),2);Te(b),h(we);var l=L(we,2);{var A=H=>{var te=Ga(),J=w(te);h(te),ve((ae,be)=>de(J,`📍 ${ae??""}, ${be??""}`),[()=>(W(n()),D(()=>n().lat.toFixed(4))),()=>(W(n()),D(()=>n().lng.toFixed(4)))]),B(H,te)};pe(l,H=>{n()&&H(A)})}var T=L(l,2),k=w(T),q=L(k,2);h(T),h(me),ve(H=>q.disabled=H,[()=>(e(E),D(()=>!e(E).trim()))]),K("click",xe,()=>O("collapsed")),De(_e,()=>e(E),H=>v(E,H)),De(b,()=>e(S),H=>v(S,H)),K("click",k,X),K("click",q,R),B(ee,ie)},Se=ee=>{var ie=Ba();B(ee,ie)};pe(Q,ee=>{r()?ee(le):ee(Se,!1)},!0)}B(M,z)};pe(j,M=>{s()&&i()?M(oe):M(re,!1)})}h(V),h(_),et(_,M=>v(g,M),()=>e(g)),ve(()=>Ce(_,1,`bottom-panel ${a()??""}`,"svelte-1x7a3co")),K("mousedown",P,G),K("touchstart",P,G),B(o,_),Be()}const{PIN_STORAGE_KEY:Dn}=Ee.STORAGE,dt="map-locations",{MAX_TITLE_LENGTH:Et,MAX_DESCRIPTION_LENGTH:Ya,ID_LENGTH:Ka}=Ee.PINS;class Oe{static saveLocations(t){return Tt(()=>{const a=t.map(n=>({...n,createdAt:n.createdAt.toISOString(),instances:n.instances.map(i=>({...i,createdAt:i.createdAt.toISOString()}))}));localStorage.setItem(dt,JSON.stringify(a)),Y.debug(`Saved ${t.length} locations with ${t.reduce((n,i)=>n+i.instances.length,0)} total instances`)},yt.STORAGE_SAVE_FAILED,"LOCATIONS_SAVE_ERROR")||void 0}static loadLocations(){return Tt(()=>{const t=localStorage.getItem(dt);if(!t)return Y.debug("No locations found in localStorage"),[];const n=JSON.parse(t).map(i=>({...i,createdAt:new Date(i.createdAt),instances:i.instances.map(r=>({...r,createdAt:new Date(r.createdAt)}))}));return Y.debug(`Loaded ${n.length} locations with ${n.reduce((i,r)=>i+r.instances.length,0)} total instances`),n},yt.STORAGE_LOAD_FAILED,"LOCATIONS_LOAD_ERROR")||[]}static addLocation(t){if(!t.name.trim()||t.name.length>Et)throw new ce("Invalid location name","INVALID_LOCATION_NAME");const a={...t,id:this.generateId(),createdAt:new Date,name:t.name.trim(),address:t.address?.trim()||void 0,instances:[]},n=this.loadLocations();return n.push(a),this.saveLocations(n),Y.info(`Created new location: ${a.name}`,{id:a.id}),a}static updateLocation(t){const a=this.loadLocations(),n=a.findIndex(i=>i.id===t.id);if(n===-1)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.id});if(!t.name.trim()||t.name.length>Et)throw new ce("Invalid location name","INVALID_LOCATION_NAME");a[n]={...t,name:t.name.trim(),address:t.address?.trim()||void 0},this.saveLocations(a),Y.info(`Updated location: ${t.name}`,{id:t.id})}static deleteLocation(t){if(!t)throw new ce("Invalid location ID","INVALID_LOCATION_ID");const a=this.loadLocations(),n=a.length,i=a.filter(r=>r.id!==t);if(i.length===n){Y.warn(`Attempted to delete non-existent location: ${t}`);return}this.saveLocations(i),Y.info(`Deleted location: ${t}`)}static addInstance(t){if(!t.types.length)throw new ce("At least one type must be selected","INVALID_INSTANCE_TYPES");if(t.description&&t.description.length>Ya)throw new ce("Instance description too long","INVALID_INSTANCE_DESCRIPTION");const a={...t,id:this.generateId(),createdAt:new Date,description:t.description?.trim()||void 0},n=this.loadLocations(),i=n.findIndex(r=>r.id===t.locationId);if(i===-1)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});return n[i].instances.push(a),this.saveLocations(n),Y.info(`Created new instance at location: ${n[i].name}`,{instanceId:a.id,locationId:t.locationId,types:t.types}),a}static updateInstance(t){const a=this.loadLocations(),n=a.find(r=>r.id===t.locationId);if(!n)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});const i=n.instances.findIndex(r=>r.id===t.id);if(i===-1)throw new ce("Instance not found","INSTANCE_NOT_FOUND",{instanceId:t.id});if(!t.types.length)throw new ce("At least one type must be selected","INVALID_INSTANCE_TYPES");n.instances[i]={...t,description:t.description?.trim()||void 0},this.saveLocations(a),Y.info(`Updated instance: ${t.id}`,{locationId:t.locationId})}static deleteInstance(t,a){if(!t||!a)throw new ce("Invalid location or instance ID","INVALID_IDS");const n=this.loadLocations(),i=n.find(s=>s.id===t);if(!i)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t});const r=i.instances.length;if(i.instances=i.instances.filter(s=>s.id!==a),i.instances.length===r){Y.warn(`Attempted to delete non-existent instance: ${a}`);return}this.saveLocations(n),Y.info(`Deleted instance: ${a} from location: ${t}`)}static clearAllData(){const t=this.loadLocations(),a=t.reduce((n,i)=>n+i.instances.length,0);localStorage.removeItem(dt),Y.info(`Cleared all data (${t.length} locations, ${a} instances deleted)`)}static exportData(){const t=this.loadLocations();return JSON.stringify(t,null,2)}static importData(t){try{const n=JSON.parse(t).map(i=>({...i,createdAt:new Date(i.createdAt),instances:i.instances.map(r=>({...r,createdAt:new Date(r.createdAt)}))}));return this.saveLocations(n),n}catch(a){throw Y.error("Failed to import locations:",a),new ce("Invalid location data format","INVALID_IMPORT_DATA")}}static getAllInstances(){return this.loadLocations().flatMap(a=>a.instances)}static getInstancesByDate(t=!1){return this.getAllInstances().sort((n,i)=>{const r=n.createdAt.getTime(),s=i.createdAt.getTime();return t?r-s:s-r})}static getLocationById(t){return this.loadLocations().find(n=>n.id===t)||null}static getInstanceById(t){const a=this.loadLocations();for(const n of a){const i=n.instances.find(r=>r.id===t);if(i)return{location:n,instance:i}}return null}static generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,Ka-13)}}var Za=Z('<div class="loading-spinner svelte-150ovmd"></div>'),Xa=ya('<svg class="search-icon svelte-150ovmd" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8" class="svelte-150ovmd"></circle><path d="m21 21-4.35-4.35" class="svelte-150ovmd"></path></svg>'),Wa=Z('<div class="map-wrapper svelte-150ovmd"><!> <div><div class="search-box svelte-150ovmd"><input type="text" placeholder="Search for a place..." class="search-input svelte-150ovmd"/> <button class="search-button svelte-150ovmd" aria-label="Search location"><!></button></div></div> <div><button class="location-button svelte-150ovmd" aria-label="Get my location" title="Get my location"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-150ovmd"><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" class="svelte-150ovmd"></path><path d="M12 1v6M12 17v6M5.6 5.6l4.2 4.2M14.2 14.2l4.2 4.2M1 12h6M17 12h6M5.6 18.4l4.2-4.2M14.2 9.8l4.2-4.2" class="svelte-150ovmd"></path></svg></button></div> <!></div>');function Ja(o,t){Ve(t,!1);const a=$(),n=We();let i=he(t,"initialCenter",24,()=>[53.4076,-2.9921]),r=he(t,"initialZoom",8,13),s=$(),c=$([]),g=$(""),m=$(!1),p=$("collapsed"),N=$(null),x=$(!1),F=$(null),u=$(!1),E=$(!1);ut(()=>{v(c,Oe.loadLocations()),console.log("Loaded locations:",e(c))});function S(l){e(x)||e(u)||I(l.detail.latlng)}function O(l){l.detail.map}function G(l){v(E,l.detail.open)}function d(l){v(F,l.detail.location),v(N,{lat:l.detail.location.lat,lng:l.detail.location.lng}),v(u,!0),v(x,!1),v(p,"expanded"),e(s)&&e(s).panTo(l.detail.location.lat,l.detail.location.lng,16)}async function I(l){console.log("Creating pending location at:",l),v(N,{lat:l.lat,lng:l.lng}),v(x,!0),v(u,!1),v(p,"expanded"),console.log("Location creation setup:",{isCreatingLocation:e(x),isCreatingInstance:e(u),panelState:e(p)})}function C(l){v(p,l.detail.state),e(p)==="collapsed"&&(v(N,null),v(F,null),v(x,!1),v(u,!1))}function f(l){if(!e(N))return;const A=Oe.addLocation({lat:e(N).lat,lng:e(N).lng,name:l.detail.name,address:l.detail.address});v(c,[...e(c),A]),n("locationCreated",{location:A}),v(x,!1),v(N,null),v(p,"collapsed")}function y(){v(x,!1),v(N,null),v(p,"collapsed")}function R(l){if(!e(F))return;const A=Oe.addInstance({locationId:e(F).id,title:l.detail.title,types:l.detail.types,description:l.detail.description});v(c,Oe.loadLocations()),n("instanceCreated",{instance:A}),v(u,!1),v(F,null),v(N,null),v(p,"collapsed")}function X(){v(u,!1),v(F,null),v(N,null),v(p,"collapsed")}async function _(){if(!(!e(g).trim()||e(m))){v(m,!0);try{const A=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e(g))}&limit=1`)).json();if(A.length>0){const T=A[0],k=parseFloat(T.lat),q=parseFloat(T.lon);e(s)&&e(s).panTo(k,q,15),v(g,"")}else alert("Location not found. Please try a different search term.")}catch(l){console.error("Search error:",l),alert("Search failed. Please try again.")}finally{v(m,!1)}}}function P(l){l.key==="Enter"&&_()}function V(){e(s)&&e(s).getCurrentLocation()}function j(l,A){const T=e(c).find(k=>k.id===l);T&&e(s)&&(e(s).panTo(T.lat,T.lng,16),A&&console.log(`Navigated to location ${l}, highlighting instance ${A}`))}function oe(l=!1){return Oe.loadLocations().sort((T,k)=>{const q=new Date(T.createdAt),H=new Date(k.createdAt);return l?q.getTime()-H.getTime():H.getTime()-q.getTime()})}function re(){const l=Oe.loadLocations(),A={};return l.forEach(T=>{T.instances.forEach(k=>{const q=new Date(k.createdAt).toDateString();A[q]||(A[q]=[]),A[q].push({...k,location:T})})}),A}Pe(()=>(e(E),e(p)),()=>{v(a,e(E)||e(p)!=="collapsed")}),Qe(),Ge();var M=Wa(),z=w(M);et(qa(z,{get initialCenter(){return i()},get initialZoom(){return r()},get locations(){return e(c)},$$events:{mapClick:S,mapReady:O,locationClick:d,popupOpen:G},$$legacy:!0}),l=>v(s,l),()=>e(s));var Q=L(z,2);let le;var Se=w(Q),ee=w(Se);Te(ee);var ie=L(ee,2),ge=w(ie);{var xe=l=>{var A=Za();B(l,A)},me=l=>{var A=Xa();B(l,A)};pe(ge,l=>{e(m)?l(xe):l(me,!1)})}h(ie),h(Se),h(Q);var se=L(Q,2);let _e;var we=w(se);h(se);var b=L(se,2);return Ua(b,{get panelState(){return e(p)},get selectedLocation(){return e(N)},get selectedLocationForInstance(){return e(F)},get isCreatingLocation(){return e(x)},get isCreatingInstance(){return e(u)},$$events:{panelStateChange:C,createLocation:f,cancelLocation:y,createInstance:R,cancelInstance:X}}),h(M),ve((l,A,T)=>{le=Ce(Q,1,"map-controls svelte-150ovmd",null,le,l),ee.disabled=e(m),ie.disabled=A,_e=Ce(se,1,"location-control svelte-150ovmd",null,_e,T)},[()=>({hidden:e(a)}),()=>(e(m),e(g),D(()=>e(m)||!e(g).trim())),()=>({hidden:e(a)})]),De(ee,()=>e(g),l=>v(g,l)),K("keydown",ee,P),K("click",ie,_),K("click",we,V),B(o,M),qe(t,"navigateToLocation",j),qe(t,"getLocationsByDate",oe),qe(t,"getInstancesByDateGrouped",re),Be({navigateToLocation:j,getLocationsByDate:oe,getInstancesByDateGrouped:re})}function $e(o){switch(o){case ne.Shit:return"Shit";case ne.Cum:return"Cum";case ne.Piss:return"Piss";default:return"Unknown"}}function ja(){return Object.values(ne)}const{TIME:Qa,SHORT_DATE:en,FULL_DATE:tn}=Ee.DATE_FORMAT;function St(o){return o.toLocaleTimeString([],Qa)}function Ct(o){const t=new Date;if(o.toDateString()===t.toDateString())return`Today @ ${St(o)}`;{const n=o.toLocaleDateString([],en),i=St(o);return`${n} @ ${i}`}}function an(o){const t=new Date(o+"T00:00:00"),a=new Date,n=new Date(a);return n.setDate(n.getDate()-1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===n.toDateString()?"Yesterday":t.toLocaleDateString([],tn)}function nn(o){return o.toLocaleDateString()}var on=Z('<button class="clear-search svelte-ywq051" aria-label="Clear search"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button>'),sn=Z("<button> </button>"),rn=Z('<button class="clear-filters svelte-ywq051">Clear Filters</button>'),ln=Z('<span class="source-indicator svelte-ywq051"> </span>'),cn=Z('<div class="pin-description svelte-ywq051"> </div>'),dn=Z("<span> </span>"),vn=Z('<button class="pin-item svelte-ywq051"><div class="pin-info svelte-ywq051"><div class="pin-title svelte-ywq051"> <!></div> <div class="pin-time svelte-ywq051"> </div> <!> <div class="pin-coordinates svelte-ywq051"> </div></div> <div class="pin-types svelte-ywq051"></div></button>'),un=Z('<div class="date-group svelte-ywq051"><h3 class="date-header svelte-ywq051"> <span class="pin-count svelte-ywq051"> </span></h3> <div class="pins-grid svelte-ywq051"></div></div>'),fn=Z('<div class="empty-icon svelte-ywq051">📍</div> <h3 class="svelte-ywq051">No items yet</h3> <p class="svelte-ywq051">Switch to Map View to create your first location or pin!</p>',1),pn=Z('<div class="empty-icon svelte-ywq051">🔍</div> <h3 class="svelte-ywq051">No matching items</h3> <p class="svelte-ywq051">Try adjusting your search or filters</p> <button class="clear-filters svelte-ywq051">Clear All Filters</button>',1),hn=Z('<div class="empty-state svelte-ywq051"><!></div>'),gn=Z('<div class="date-view svelte-ywq051"><div class="header svelte-ywq051"><h2 class="title svelte-ywq051">Pins by Date</h2> <div class="subtitle svelte-ywq051"> </div></div> <div class="controls svelte-ywq051"><div class="search-bar svelte-ywq051"><svg viewBox="0 0 24 24" fill="currentColor" class="search-icon svelte-ywq051"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg> <input type="text" placeholder="Search pins..." class="search-input svelte-ywq051"/> <!></div> <div class="filters svelte-ywq051"><div class="sort-control svelte-ywq051"><button title="Newest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M7 14l5-5 5 5z"></path></svg> Newest</button> <button title="Oldest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M7 10l5 5 5-5z"></path></svg> Oldest</button></div> <div class="type-filters svelte-ywq051"></div> <div class="date-filters svelte-ywq051"><div class="date-filter-group svelte-ywq051"><label for="date-after" class="date-label svelte-ywq051">After:</label> <input id="date-after" type="date" class="date-input svelte-ywq051" title="Show pins created after this date"/></div> <div class="date-filter-group svelte-ywq051"><label for="date-before" class="date-label svelte-ywq051">Before:</label> <input id="date-before" type="date" class="date-input svelte-ywq051" title="Show pins created before this date"/></div></div> <!></div></div> <div class="pin-groups svelte-ywq051"><!> <!></div></div>');function mn(o,t){Ve(t,!1);const a=$(),n=$(),i=$(),r=We();let s=he(t,"pins",24,()=>[]),c=he(t,"locations",24,()=>[]),g=$("desc"),m=$(""),p=$([]),N=$(""),x=$("");const F=ja();function u(b,l){const A=[];return b.forEach(T=>{A.push({id:T.id,title:T.title,description:T.description,types:T.types||[T.type],createdAt:T.createdAt,lat:T.lat,lng:T.lng,source:"pin"})}),l.forEach(T=>{T.instances.forEach(k=>{A.push({id:k.id,title:T.name,description:k.description,types:k.types,createdAt:k.createdAt,lat:T.lat,lng:T.lng,source:"instance",locationId:T.id,locationName:T.name})})}),A}function E(b,l,A,T,k,q){console.log("Filtering items:",{items:b.length,searchTerm:l,selectedTypes:A,sortOrder:T,dateAfter:k,dateBefore:q});let H=b.filter(J=>{const ae=!l||J.title.toLowerCase().includes(l.toLowerCase())||J.description&&J.description.toLowerCase().includes(l.toLowerCase()),be=A.length===0||A.some(Fe=>J.types.includes(Fe)),Le=new Date(J.createdAt.getFullYear(),J.createdAt.getMonth(),J.createdAt.getDate()),U=!k||Le>=new Date(k),Ne=!q||Le<=new Date(q);return ae&&be&&U&&Ne});console.log("After filtering:",H.length),H.sort((J,ae)=>{const be=J.createdAt.getTime(),Le=ae.createdAt.getTime();return T==="desc"?Le-be:be-Le});const te={};return H.forEach(J=>{const ae=nn(J.createdAt);te[ae]||(te[ae]=[]),te[ae].push(J)}),Y.debug(`Grouped items into ${Object.keys(te).length} date groups`),te}function S(b){Y.debug(`Item clicked in date view: ${b.id} (source: ${b.source})`),b.source==="pin"?r("navigateToPin",{pinId:b.id}):b.source==="instance"&&r("navigateToLocation",{locationId:b.locationId,instanceId:b.id})}function O(b){return an(b)}function G(b){e(p).includes(b)?v(p,e(p).filter(l=>l!==b)):v(p,[...e(p),b]),Y.debug(`Type filter toggled: ${b}, active filters:`,e(p))}function d(){v(m,""),v(p,[]),v(N,""),v(x,""),Y.debug("All filters cleared")}Pe(()=>(W(s()),W(c())),()=>{v(a,u(s(),c()))}),Pe(()=>(e(a),e(m),e(p),e(g),e(N),e(x)),()=>{v(n,E(e(a),e(m),e(p),e(g),e(N),e(x)))}),Pe(()=>e(n),()=>{v(i,Object.values(e(n)).flat().length)}),Qe(),Ge();var I=gn(),C=w(I),f=L(w(C),2),y=w(f);h(f),h(C);var R=L(C,2),X=w(R),_=L(w(X),2);Te(_);var P=L(_,2);{var V=b=>{var l=on();K("click",l,()=>v(m,"")),B(b,l)};pe(P,b=>{e(m)&&b(V)})}h(X);var j=L(X,2),oe=w(j),re=w(oe),M=L(re,2);h(oe);var z=L(oe,2);Ue(z,5,()=>F,ze,(b,l)=>{var A=sn(),T=w(A,!0);h(A),ve((k,q,H)=>{Ce(A,1,`type-filter ${k??""} type-${e(l)??""}`,"svelte-ywq051"),ke(A,"title",`Filter by ${q??""}`),de(T,H)},[()=>(e(p),e(l),D(()=>e(p).includes(e(l))?"active":"")),()=>(W($e),e(l),D(()=>$e(e(l)))),()=>(W($e),e(l),D(()=>$e(e(l))))]),K("click",A,()=>G(e(l))),B(b,A)}),h(z);var Q=L(z,2),le=w(Q),Se=L(w(le),2);Te(Se),h(le);var ee=L(le,2),ie=L(w(ee),2);Te(ie),h(ee),h(Q);var ge=L(Q,2);{var xe=b=>{var l=rn();K("click",l,d),B(b,l)};pe(ge,b=>{e(m),e(p),e(N),e(x),D(()=>e(m)||e(p).length>0||e(N)||e(x))&&b(xe)})}h(j),h(R);var me=L(R,2),se=w(me);Ue(se,1,()=>(e(n),D(()=>Object.entries(e(n)))),ze,(b,l)=>{var A=Ta(()=>Ea(e(l),2));let T=()=>e(A)[0],k=()=>e(A)[1];var q=un(),H=w(q),te=w(H),J=L(te),ae=w(J);h(J),h(H);var be=L(H,2);Ue(be,5,k,ze,(Le,U)=>{var Ne=vn(),Fe=w(Ne),tt=w(Fe),pt=w(tt),Gt=L(pt);{var Vt=Ie=>{var fe=ln(),Ae=w(fe);h(fe),ve(()=>de(Ae,`@${e(U),D(()=>e(U).locationName)??""}`)),B(Ie,fe)};pe(Gt,Ie=>{e(U),D(()=>e(U).source==="instance")&&Ie(Vt)})}h(tt);var at=L(tt,2),Bt=w(at,!0);h(at);var ht=L(at,2);{var zt=Ie=>{var fe=cn(),Ae=w(fe,!0);h(fe),ve(()=>de(Ae,(e(U),D(()=>e(U).description)))),B(Ie,fe)};pe(ht,Ie=>{e(U),D(()=>e(U).description)&&Ie(zt)})}var gt=L(ht,2),Ut=w(gt);h(gt),h(Fe);var mt=L(Fe,2);Ue(mt,5,()=>(e(U),D(()=>e(U).types)),ze,(Ie,fe)=>{var Ae=dn(),Yt=w(Ae,!0);h(Ae),ve(Kt=>{Ce(Ae,1,`type-badge type-${e(fe)??""}`,"svelte-ywq051"),de(Yt,Kt)},[()=>(W($e),e(fe),D(()=>$e(e(fe))))]),B(Ie,Ae)}),h(mt),h(Ne),ve((Ie,fe,Ae)=>{ke(Ne,"title",`Click to navigate to ${e(U),D(()=>e(U).source==="pin"?"pin":"location")??""} on map`),de(pt,`${e(U),D(()=>e(U).title)??""} `),de(Bt,Ie),de(Ut,`${fe??""}, ${Ae??""}`)},[()=>(W(Ct),e(U),D(()=>Ct(e(U).createdAt))),()=>(e(U),D(()=>e(U).lat.toFixed(4))),()=>(e(U),D(()=>e(U).lng.toFixed(4)))]),K("click",Ne,()=>S(e(U))),B(Le,Ne)}),h(be),h(q),ve(Le=>{de(te,`${Le??""} `),de(ae,`${k(),D(()=>k().length)??""} item${k(),D(()=>k().length===1?"":"s")??""}`)},[()=>(T(),D(()=>O(T())))]),B(b,q)});var _e=L(se,2);{var we=b=>{var l=hn(),A=w(l);{var T=q=>{var H=fn();Ke(4),B(q,H)},k=q=>{var H=pn(),te=L(He(H),6);K("click",te,d),B(q,H)};pe(A,q=>{W(s()),W(c()),D(()=>s().length===0&&c().length===0)?q(T):q(k,!1)})}h(l),B(b,l)};pe(_e,b=>{e(n),D(()=>Object.keys(e(n)).length===0)&&b(we)})}h(me),h(I),ve(b=>{de(y,`${e(i)??""} of ${b??""} items`),Ce(re,1,`sort-btn ${e(g)==="desc"?"active":""}`,"svelte-ywq051"),Ce(M,1,`sort-btn ${e(g)==="asc"?"active":""}`,"svelte-ywq051")},[()=>(W(s()),W(c()),D(()=>s().length+c().reduce((b,l)=>b+l.instances.length,0)))]),De(_,()=>e(m),b=>v(m,b)),K("click",re,()=>v(g,"desc")),K("click",M,()=>v(g,"asc")),De(Se,()=>e(N),b=>v(N,b)),De(ie,()=>e(x),b=>v(x,b)),B(o,I),Be()}var _n=Z('<meta name="description" content="Interactive map to track bodily functions and see date-based views"/>'),wn=Z('<span class="count-breakdown svelte-2eimgu"> </span>'),bn=Z('<div class="app-container svelte-2eimgu"><div class="view-switcher svelte-2eimgu"><div class="view-controls svelte-2eimgu"><button><svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg> Map View</button> <button><svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></svg> Date View</button></div> <div class="pin-count svelte-2eimgu"> <!></div></div> <div class="content svelte-2eimgu"><!></div></div>');function Nn(o,t){Ve(t,!1);const a=$();let n=$(),i=$([]),r=$("map");ut(()=>{s(),c(),x()});function s(){try{v(i,Oe.loadLocations()),Y.debug(`Loaded ${e(i).length} locations in main page`)}catch(_){Y.error("Failed to load data in main page",_),v(i,[])}}function c(){const _=()=>{Y.debug("Storage changed, reloading data"),s()};return window.addEventListener("storage",_),()=>{window.removeEventListener("storage",_)}}function g(_){Y.debug(`Navigating to location: ${_.detail.locationId}, instance: ${_.detail.instanceId}`),v(r,"map"),setTimeout(()=>{e(n)?.navigateToLocation(_.detail.locationId,_.detail.instanceId)},Ee.UI.ANIMATION_DURATION/3)}function m(){s()}function p(_){e(r)!==_&&(Y.debug(`Switching view from ${e(r)} to ${_}`),v(r,_),_==="date"&&m())}function N(_){const{altKey:P,key:V}=_;if(P&&V==="d"){_.preventDefault(),p("date");return}if(P&&V==="m"){_.preventDefault(),p("map");return}}function x(){Y.debug("Setting up keyboard shortcuts")}Pe(()=>e(i),()=>{v(a,e(i).reduce((_,P)=>_+P.instances.length,0))}),Qe(),Ge();var F=bn();Jt(_=>{var P=_n();Sa.title="Shumpiss",B(_,P)}),K("keydown",Ca,N);var u=w(F),E=w(u),S=w(E),O=L(S,2);h(E);var G=L(E,2),d=w(G),I=L(d);{var C=_=>{var P=wn(),V=w(P);h(P),ve(()=>de(V,`(${e(i),D(()=>e(i).length)??""} location${e(i),D(()=>e(i).length===1?"":"s")??""})`)),B(_,P)};pe(I,_=>{e(i),D(()=>e(i).length>0)&&_(C)})}h(G),h(u);var f=L(u,2),y=w(f);{var R=_=>{var P=qt(),V=He(P);Da(V,()=>e(r),j=>{et(Ja(j,{get initialCenter(){return W(Ee),D(()=>Ee.MAP.DEFAULT_CENTER)},get initialZoom(){return W(Ee),D(()=>Ee.MAP.DEFAULT_ZOOM)},$$events:{locationCreated:m,instanceCreated:m,locationDeleted:m,instanceDeleted:m},$$legacy:!0}),oe=>v(n,oe),()=>e(n))}),B(_,P)},X=_=>{mn(_,{get locations(){return e(i)},$$events:{navigateToLocation:g}})};pe(y,_=>{e(r)==="map"?_(R):_(X,!1)})}h(f),h(F),ve(()=>{Ce(S,1,`view-btn ${e(r)==="map"?"active":""}`,"svelte-2eimgu"),ke(S,"title",`Map View (${W(Ye),D(()=>Ye.SWITCH_TO_MAP_VIEW)??""})`),Ce(O,1,`view-btn ${e(r)==="date"?"active":""}`,"svelte-2eimgu"),ke(O,"title",`Date View (${W(Ye),D(()=>Ye.SWITCH_TO_DATE_VIEW)??""})`),de(d,`${e(a)??""} item${e(a)===1?"":"s"} `)}),K("click",S,()=>p("map")),K("click",O,()=>p("date")),B(o,F),Be()}export{Nn as component};
