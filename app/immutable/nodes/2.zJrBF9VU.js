import"../chunks/DsnmJJEf.js";import{i as He}from"../chunks/BO1dTzpG.js";import{a as Zt,l as Xt,c as We,o as ut,b as _t,e as K,r as Wt,s as de,d as Jt}from"../chunks/DUgMGJGx.js";import{w as ue,x as Dt,aC as Nt,aD as jt,aE as Qt,v as Ot,C as ft,D as Ze,F as xe,G as Mt,K as ze,U as ea,J as xt,A as nt,aa as ta,g as e,R as aa,y as na,H as ia,z as wt,B as it,ai as oa,an as sa,aF as Je,aG as je,aH as kt,aq as $t,ag as ra,a5 as $,aI as bt,aJ as Lt,I as zt,aK as ot,N as la,aL as Rt,aM as ca,aN as da,ak as va,aO as ua,ab as fa,aP as ha,X as pa,aQ as ga,aR as ma,aS as _a,aT as wa,aU as ba,b as N,M as La,O as Ia,af as Aa,p as Ge,aV as Xe,V as v,aW as Re,e as W,aX as Qe,l as Z,k as V,m as Ve,n as w,q as L,o as p,t as ve,j as Fe,aY as Ke,i as Pt,aZ as ya,a8 as Ta,a_ as Ea,a$ as Sa,b0 as Ca}from"../chunks/C-cdoq8H.js";import{p as pe,_ as Da,b as et,i as he}from"../chunks/DR0M7r5p.js";function Na(i,t,a){ue&&Dt();var n=i,o=ea,r,s,c=null,g=Nt()?jt:Qt;function _(){r&&xt(r),c!==null&&(c.lastChild.remove(),n.before(c),c=null),r=s}Ot(()=>{if(g(o,o=t())){var h=n,O=Mt();O&&(c=document.createDocumentFragment(),c.append(h=ft())),s=Ze(()=>a(h)),O?xe.add_callback(_):_()}}),ue&&(n=ze)}function Be(i,t){return t}function Oa(i,t,a){for(var n=i.items,o=[],r=t.length,s=0;s<r;s++)ua(t[s].e,o,!0);var c=r>0&&o.length===0&&a!==null;if(c){var g=a.parentNode;fa(g),g.append(a),n.clear(),ye(i,t[0].prev,t[r-1].next)}ha(o,()=>{for(var _=0;_<r;_++){var h=t[_];c||(n.delete(h.k),ye(i,h.prev,h.next)),Rt(h.e,!c)}})}function Ue(i,t,a,n,o,r=null){var s=i,c={flags:t,items:new Map,first:null},g=(t&kt)!==0;if(g){var _=i;s=ue?nt(ta(_)):_.appendChild(ft())}ue&&Dt();var h=null,O=!1,D=new Map,q=aa(()=>{var x=a();return ra(x)?x:x==null?[]:$t(x)}),u,E;function S(){Ma(E,u,c,D,s,o,t,n,a),r!==null&&(u.length===0?h?zt(h):h=Ze(()=>r(s)):h!==null&&xt(h,()=>{h=null}))}Ot(()=>{E??=pa,u=e(q);var x=u.length;if(O&&x===0)return;O=x===0;let H=!1;if(ue){var d=na(s)===ia;d!==(x===0)&&(s=wt(),nt(s),it(!1),H=!0)}if(ue){for(var I=null,C,f=0;f<x;f++){if(ze.nodeType===oa&&ze.data===sa){s=ze,H=!0,it(!1);break}var y=u[f],z=n(y,f);C=vt(ze,c,I,null,y,z,f,o,t,a),c.items.set(z,C),I=C}x>0&&nt(wt())}if(ue)x===0&&r&&(h=Ze(()=>r(s)));else if(Mt()){var X=new Set,m=xe;for(f=0;f<x;f+=1){y=u[f],z=n(y,f);var R=c.items.get(z)??D.get(z);R?(t&(Je|je))!==0&&qt(R,y,f,t):(C=vt(null,c,null,null,y,z,f,o,t,a,!0),D.set(z,C)),X.add(z)}for(const[G,j]of c.items)X.has(G)||m.skipped_effects.add(j.e);m.add_callback(S)}else S();H&&it(!0),e(q)}),ue&&(s=ze)}function Ma(i,t,a,n,o,r,s,c,g){var _=(s&da)!==0,h=(s&(Je|je))!==0,O=t.length,D=a.items,q=a.first,u=q,E,S=null,x,H=[],d=[],I,C,f,y;if(_)for(y=0;y<O;y+=1)I=t[y],C=c(I,y),f=D.get(C),f!==void 0&&(f.a?.measure(),(x??=new Set).add(f));for(y=0;y<O;y+=1){if(I=t[y],C=c(I,y),f=D.get(C),f===void 0){var z=n.get(C);if(z!==void 0){n.delete(C),D.set(C,z);var X=S?S.next:u;ye(a,S,z),ye(a,z,X),st(z,X,o),S=z}else{var m=u?u.e.nodes_start:o;S=vt(m,a,S,S===null?a.first:S.next,I,C,y,r,s,g)}D.set(C,S),H=[],d=[],u=S.next;continue}if(h&&qt(f,I,y,s),(f.e.f&ot)!==0&&(zt(f.e),_&&(f.a?.unfix(),(x??=new Set).delete(f))),f!==u){if(E!==void 0&&E.has(f)){if(H.length<d.length){var R=d[0],G;S=R.prev;var j=H[0],ie=H[H.length-1];for(G=0;G<H.length;G+=1)st(H[G],R,o);for(G=0;G<d.length;G+=1)E.delete(d[G]);ye(a,j.prev,ie.next),ye(a,S,j),ye(a,ie,R),u=R,S=ie,y-=1,H=[],d=[]}else E.delete(f),st(f,u,o),ye(a,f.prev,f.next),ye(a,f,S===null?a.first:S.next),ye(a,S,f),S=f;continue}for(H=[],d=[];u!==null&&u.k!==C;)(u.e.f&ot)===0&&(E??=new Set).add(u),d.push(u),u=u.next;if(u===null)continue;f=u}H.push(f),S=f,u=f.next}if(u!==null||E!==void 0){for(var re=E===void 0?[]:$t(E);u!==null;)(u.e.f&ot)===0&&re.push(u),u=u.next;var M=re.length;if(M>0){var B=(s&kt)!==0&&O===0?o:null;if(_){for(y=0;y<M;y+=1)re[y].a?.measure();for(y=0;y<M;y+=1)re[y].a?.fix()}Oa(a,re,B)}}_&&la(()=>{if(x!==void 0)for(f of x)f.a?.apply()}),i.first=a.first&&a.first.e,i.last=S&&S.e;for(var Q of n.values())Rt(Q.e);n.clear()}function qt(i,t,a,n){(n&Je)!==0&&Lt(i.v,t),(n&je)!==0?Lt(i.i,a):i.i=a}function vt(i,t,a,n,o,r,s,c,g,_,h){var O=(g&Je)!==0,D=(g&ca)===0,q=O?D?$(o,!1,!1):bt(o):o,u=(g&je)===0?s:bt(s),E={i:u,v:q,k:r,a:null,e:null,prev:a,next:n};try{if(i===null){var S=document.createDocumentFragment();S.append(i=ft())}return E.e=Ze(()=>c(i,q,u,_),ue),E.e.prev=a&&a.e,E.e.next=n&&n.e,a===null?h||(t.first=E):(a.next=E,a.e.next=E.e),n!==null&&(n.prev=E,n.e.prev=E.e),E}finally{}}function st(i,t,a){for(var n=i.next?i.next.e.nodes_start:a,o=t?t.e.nodes_start:a,r=i.e.nodes_start;r!==null&&r!==n;){var s=va(r);o.before(r),r=s}}function ye(i,t,a){t===null?i.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}const It=[...` 	
\r\f \v\uFEFF`];function xa(i,t,a){var n=i==null?"":""+i;if(t&&(n=n?n+" "+t:t),a){for(var o in a)if(a[o])n=n?n+" "+o:o;else if(n.length)for(var r=o.length,s=0;(s=n.indexOf(o,s))>=0;){var c=s+r;(s===0||It.includes(n[s-1]))&&(c===n.length||It.includes(n[c]))?n=(s===0?"":n.substring(0,s))+n.substring(c+1):s=c}}return n===""?null:n}function Ce(i,t,a,n,o,r){var s=i.__className;if(ue||s!==a||s===void 0){var c=xa(a,n,r);(!ue||c!==i.getAttribute("class"))&&(c==null?i.removeAttribute("class"):i.className=c),i.__className=a}else if(r&&o!==r)for(var g in r){var _=!!r[g];(o==null||_!==!!o[g])&&i.classList.toggle(g,_)}return r}const ka=Symbol("is custom element"),$a=Symbol("is html");function Te(i){if(ue){var t=!1,a=()=>{if(!t){if(t=!0,i.hasAttribute("value")){var n=i.value;ke(i,"value",null),i.value=n}if(i.hasAttribute("checked")){var o=i.checked;ke(i,"checked",null),i.checked=o}}};i.__on_r=a,wa(a),Zt()}}function rt(i,t){var a=Ft(i);a.checked!==(a.checked=t??void 0)&&(i.checked=t)}function ke(i,t,a,n){var o=Ft(i);ue&&(o[t]=i.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&i.nodeName==="LINK")||o[t]!==(o[t]=a)&&(t==="loading"&&(i[ba]=a),a==null?i.removeAttribute(t):typeof a!="string"&&za(i).includes(t)?i[t]=a:i.setAttribute(t,a))}function Ft(i){return i.__attributes??={[ka]:i.nodeName.includes("-"),[$a]:i.namespaceURI===ga}}var At=new Map;function za(i){var t=At.get(i.nodeName);if(t)return t;At.set(i.nodeName,t=[]);for(var a,n=i,o=Element.prototype;o!==n;){a=_a(n);for(var r in a)a[r].set&&t.push(r);n=ma(n)}return t}function Ne(i,t,a=t){var n=Nt(),o=new WeakSet;Xt(i,"input",r=>{var s=r?i.defaultValue:i.value;if(s=lt(i)?ct(s):s,a(s),xe!==null&&o.add(xe),n&&s!==(s=t())){var c=i.selectionStart,g=i.selectionEnd;i.value=s??"",g!==null&&(i.selectionStart=c,i.selectionEnd=Math.min(g,i.value.length))}}),(ue&&i.defaultValue!==i.value||N(t)==null&&i.value)&&(a(lt(i)?ct(i.value):i.value),xe!==null&&o.add(xe)),La(()=>{var r=t();i===document.activeElement&&o.has(xe)||lt(i)&&r===ct(i.value)||i.type==="date"&&!r&&!i.value||r!==i.value&&(i.value=r??"")})}function lt(i){var t=i.type;return t==="number"||t==="range"}function ct(i){return i===""?null:+i}function Pe(i,t,a){var n=Ia(i,t);n&&n.set&&(i[t]=a,Aa(()=>{i[t]=null}))}var Ra=Z('<div class="map-container svelte-50y1od"></div>');function Pa(i,t){Ge(t,!1);let a=pe(t,"initialCenter",24,()=>[53.4076,-2.9921]),n=pe(t,"initialZoom",8,13),o=pe(t,"locations",24,()=>[]);const r=We();let s=$(),c=$(),g=$(),_=[],h=!1;ut(async()=>{if(!e(s)||(e(s)&&Xe(s,e(s).innerHTML=""),await new Promise(I=>setTimeout(I,10)),!e(s)||!e(s).parentNode))return;v(g,await Da(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url));const d=document.createElement("link");d.rel="stylesheet",d.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(d);try{if(!e(s)||!e(s).parentNode)return;v(c,e(g).map(e(s),{center:a(),zoom:n(),zoomControl:!1,attributionControl:!1})),e(g).tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:""}).addTo(e(c)),e(g).control.zoom({position:"bottomright"}).addTo(e(c)),e(c).on("click",C=>{r("mapClick",{latlng:C.latlng})}),e(c).on("popupopen",()=>{h=!0,r("popupOpen",{open:!0})}),e(c).on("popupclose",()=>{h=!1,r("popupOpen",{open:!1})}),e(g).control.attribution({position:"bottomleft",prefix:!1}).addAttribution("© OpenStreetMap contributors").addTo(e(c)),r("mapReady",{map:e(c)}),u()}catch(I){console.error("Failed to initialize map:",I)}}),_t(()=>{e(c)&&e(c).remove()});function O(){console.log("Updating markers, locations:",o()),_.forEach(d=>e(c).removeLayer(d)),_=[],o().forEach(d=>{const I=e(g).divIcon({className:"custom-location-pin",html:`
					<div class="location-pin-container">
						<div class="location-pin-body"></div>
						<div class="location-pin-point"></div>
						${d.instances.length>0?`<div class="instance-count">${d.instances.length}</div>`:""}
					</div>
				`,iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-40]}),C=[...d.instances].sort((y,z)=>new Date(z.createdAt).getTime()-new Date(y.createdAt).getTime()),f=e(g).marker([d.lat,d.lng],{icon:I}).addTo(e(c)).bindPopup(D(d,C),{maxWidth:350,className:"location-popup"});f.locationId=d.id,_.push(f)})}function D(d,I){return`
			<div class="popup-content" data-location-id="${d.id}">
				<div class="popup-header">
					<h3 class="popup-title">${d.name}</h3>
				</div>
				${d.address?`<p class="popup-address">${d.address}</p>`:""}
				
				${I.length===0?`
					<div class="popup-instances">
						<p class="no-instances">No events yet</p>
						<button class="add-event-btn" onclick="window.addEventToLocation('${d.id}')">
							<svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add First Event
						</button>
					</div>
				`:`
					<div class="popup-instances">
						<div class="instance-header">
							<span class="instance-counter">
								<span class="current-instance">1</span> / ${I.length}
							</span>
							<div class="instance-controls">
								${I.length>1?`
									<button class="nav-btn" onclick="window.navigateInstance('${d.id}', -1)" title="Previous event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
										</svg>
									</button>
									<button class="nav-btn" onclick="window.navigateInstance('${d.id}', 1)" title="Next event">
										<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
											<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
										</svg>
									</button>
								`:""}
								<button class="add-event-btn small" onclick="window.addEventToLocation('${d.id}')" title="Add event">
									<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
										<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
									</svg>
								</button>
							</div>
						</div>
						<div class="current-instance-display" data-current-index="0">
							${q(I[0])}
						</div>
					</div>
				`}
				
				<div class="popup-footer">
					<div class="popup-date">Location created: ${d.createdAt.toLocaleDateString()}</div>
					<p class="popup-coords">
						${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}
					</p>
				</div>
			</div>
		`}function q(d){return`
			<div class="instance-item current">
				<div class="instance-title">${d.title}</div>
				${d.description?`<div class="instance-description">${d.description}</div>`:""}
				<div class="instance-types">${d.types.join(", ")}</div>
				<div class="instance-date">${d.createdAt.toLocaleDateString()} at ${d.createdAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
			</div>
		`}function u(){window.addEventToLocation=d=>{const I=o().find(C=>C.id===d);I&&(e(c).closePopup(),setTimeout(()=>{r("locationClick",{location:I})},10))},window.navigateInstance=(d,I)=>{const C=o().find(j=>j.id===d);if(!C||C.instances.length<=1)return;const f=document.querySelector(`[data-location-id="${d}"]`);if(!f)return;const y=f.querySelector(".current-instance-display"),z=y?.getAttribute("data-current-index")||"0";let X=parseInt(z,10);const m=C.instances.length;X=(X+I+m)%m;const R=[...C.instances].sort((j,ie)=>new Date(ie.createdAt).getTime()-new Date(j.createdAt).getTime());y.setAttribute("data-current-index",X.toString()),y.innerHTML=q(R[X]);const G=f.querySelector(".current-instance");G&&(G.textContent=(X+1).toString())}}function E(d,I,C){if(e(c)){const f=C||e(c).getZoom();e(c).setView([d,I],f);const z=e(c).getSize().y*.25;e(c).panBy([0,z],{animate:!0,duration:.3})}}function S(){typeof navigator<"u"&&"geolocation"in navigator?navigator.geolocation.getCurrentPosition(d=>{const I=d.coords.latitude,C=d.coords.longitude;E(I,C,16),r("mapClick",{latlng:e(g).latLng(I,C)})},d=>{console.error("Geolocation error:",d),alert("Could not get your location. Please make sure location access is enabled.")}):alert("Geolocation is not supported by this browser.")}function x(d){return _.find(I=>I.locationId===d.id)||null}_t(()=>{if(window.addEventToLocation&&delete window.addEventToLocation,window.navigateInstance&&delete window.navigateInstance,e(c)&&e(c).getContainer())try{const d=e(c).getContainer();d&&d.parentNode&&(e(c).off(),e(c).remove())}catch(d){console.debug("Map cleanup handled (view switch):",d.message)}finally{v(c,null)}if(_=[],e(s)&&e(s).parentNode)try{Xe(s,e(s).innerHTML="")}catch(d){console.debug("Container cleanup handled:",d.message)}}),Re(()=>(e(c),e(g),W(o())),()=>{e(c)&&e(g)&&o()&&O()}),Qe(),He();var H=Ra();return ke(H,"id",`map-${N(()=>Math.random().toString(36).substr(2,9))??""}`),et(H,d=>v(s,d),()=>e(s)),V(i,H),Pe(t,"panTo",E),Pe(t,"getCurrentLocation",S),Pe(t,"getMarkerForLocation",x),Ve({panTo:E,getCurrentLocation:S,getMarkerForLocation:x})}const Ee={MAP:{DEFAULT_CENTER:[53.4084,-2.9916],DEFAULT_ZOOM:13,MAX_ZOOM:19},STORAGE:{PIN_STORAGE_KEY:"map-pins",STORAGE_VERSION:1},UI:{PANEL_HEIGHTS:{COLLAPSED:60,PARTIAL:200,EXPANDED_OFFSET:.2},ANIMATION_DURATION:300,SEARCH_DEBOUNCE:300},PINS:{MAX_TITLE_LENGTH:100,MAX_DESCRIPTION_LENGTH:500,ID_LENGTH:16},DATE_FORMAT:{TIME:{hour:"2-digit",minute:"2-digit"},SHORT_DATE:{month:"short",day:"numeric"},FULL_DATE:{weekday:"long",month:"long",day:"numeric",year:"numeric"}}},Ye={SWITCH_TO_DATE_VIEW:"Alt+D",SWITCH_TO_MAP_VIEW:"Alt+M",ESCAPE:"Escape"},yt={STORAGE_SAVE_FAILED:"Failed to save pins",STORAGE_LOAD_FAILED:"Failed to load pins"};class qa{level=1;constructor(){if(typeof window<"u"){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";this.level=t?0:2}}shouldLog(t){return t>=this.level}formatMessage(t,a,n){const r=`[${new Date().toISOString()}] [${t}]`;return n?`${r} ${a}`:`${r} ${a}`}debug(t,a){this.shouldLog(0)&&console.debug(this.formatMessage("DEBUG",t),a||"")}info(t,a){this.shouldLog(1)&&console.info(this.formatMessage("INFO",t),a||"")}warn(t,a){this.shouldLog(2)&&console.warn(this.formatMessage("WARN",t),a||"")}error(t,a){this.shouldLog(3)&&console.error(this.formatMessage("ERROR",t),a||"")}}const Y=new qa;class ce extends Error{constructor(t,a,n){super(t),this.code=a,this.context=n,this.name="AppError"}}function Tt(i,t,a){try{return i()}catch(n){throw Y.error(`${t}: ${n.message}`,n),new ce(t,a,n)}}var ne=(i=>(i.Shit="shit",i.Cum="cum",i.Piss="piss",i))(ne||{});const{PIN_STORAGE_KEY:En}=Ee.STORAGE,{MAX_TITLE_LENGTH:Sn,MAX_DESCRIPTION_LENGTH:Cn,ID_LENGTH:Dn}=Ee.PINS;var Fa=Z('<div class="location-header svelte-13tihzo"><h2 class="location-title svelte-13tihzo"> </h2> <button class="close-button svelte-13tihzo" aria-label="Close panel">×</button></div> <div class="pin-form svelte-13tihzo"><div class="form-group svelte-13tihzo"><span class="form-label svelte-13tihzo">Instance Types * (select one or more)</span> <div class="checkbox-group svelte-13tihzo"><label class="checkbox-option svelte-13tihzo"><input type="checkbox" class="svelte-13tihzo"/> <span class="checkbox-label svelte-13tihzo">💩 Shit</span></label> <label class="checkbox-option svelte-13tihzo"><input type="checkbox" class="svelte-13tihzo"/> <span class="checkbox-label svelte-13tihzo">🍆 Cum</span></label> <label class="checkbox-option svelte-13tihzo"><input type="checkbox" class="svelte-13tihzo"/> <span class="checkbox-label svelte-13tihzo">💦 Piss</span></label></div></div> <div class="form-group svelte-13tihzo"><label for="instance-title" class="form-label svelte-13tihzo">Instance Title *</label> <input id="instance-title" type="text" placeholder="Enter a title for this instance..." class="form-input svelte-13tihzo" maxlength="100"/></div> <div class="form-group svelte-13tihzo"><label for="instance-description" class="form-label svelte-13tihzo">Description (optional)</label> <textarea id="instance-description" placeholder="Add a description or notes..." class="form-textarea svelte-13tihzo" rows="3" maxlength="500"></textarea></div> <div class="form-actions svelte-13tihzo"><button class="action-button secondary svelte-13tihzo">Cancel</button> <button class="action-button primary svelte-13tihzo">Save Instance</button></div></div>',1),Ha=Z('<div class="coordinates svelte-13tihzo"> </div>'),Ga=Z(`<div class="location-header svelte-13tihzo"><h2 class="location-title svelte-13tihzo">Create New Location</h2> <button class="close-button svelte-13tihzo" aria-label="Close panel">×</button></div> <div class="pin-form svelte-13tihzo"><div class="form-group svelte-13tihzo"><label class="form-label svelte-13tihzo" for="location-name">Location Name *</label> <input id="location-name" type="text" placeholder="e.g., McDonald's Downtown" class="form-input svelte-13tihzo" maxlength="100"/></div> <div class="form-group svelte-13tihzo"><label class="form-label svelte-13tihzo" for="location-address">Address (optional)</label> <input id="location-address" type="text" placeholder="Enter address or description" class="form-input svelte-13tihzo" maxlength="200"/></div> <!> <div class="form-buttons svelte-13tihzo"><button class="cancel-btn svelte-13tihzo">Cancel</button> <button class="create-btn svelte-13tihzo">Create Location</button></div></div>`,1),Va=Z('<div class="empty-state svelte-13tihzo"><h3 class="svelte-13tihzo">Tap on the map</h3> <p class="svelte-13tihzo">Click anywhere on the map to create a new location, or click an existing location to add an instance</p></div>'),Ba=Z('<div><div class="panel-handle svelte-13tihzo" role="button" tabindex="0" aria-label="Drag to resize panel"><div class="handle-bar svelte-13tihzo"></div></div> <div class="panel-content svelte-13tihzo"><!></div></div>');function Ua(i,t){Ge(t,!1);let a=pe(t,"panelState",12,"collapsed"),n=pe(t,"selectedLocation",8,null),o=pe(t,"selectedLocationForInstance",8,null),r=pe(t,"isCreatingLocation",8,!1),s=pe(t,"isCreatingInstance",8,!1);const c=We();let g=$(),_=!1,h=0,O=0,D=$(""),q=$(""),u=$(new Set([ne.Shit])),E=$(""),S=$("");function x(M){a(M),c("panelStateChange",{state:M})}function H(M){_=!0,h="touches"in M?M.touches[0].clientY:M.clientY;const B=e(g).getBoundingClientRect();O=window.innerHeight-B.top,document.addEventListener("mousemove",d,{passive:!1}),document.addEventListener("mouseup",I),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("touchend",I)}function d(M){if(!_)return;M.preventDefault();const B="touches"in M?M.touches[0].clientY:M.clientY,Q=h-B,le=Math.max(60,Math.min(window.innerHeight*.8,O+Q));Xe(g,e(g).style.transform=`translateY(${window.innerHeight-le}px)`)}function I(){if(!_)return;_=!1;const M=e(g).getBoundingClientRect(),B=window.innerHeight-M.top;B<120?x("collapsed"):B<window.innerHeight*.4?x("partial"):x("expanded"),Xe(g,e(g).style.transform=""),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",I),document.removeEventListener("touchmove",d),document.removeEventListener("touchend",I)}function C(){!o()||!e(D).trim()||e(u).size===0||(c("createInstance",{title:e(D).trim(),description:e(q).trim()||void 0,types:Array.from(e(u))}),v(D,""),v(q,""),v(u,new Set([ne.Shit])))}function f(){v(D,""),v(q,""),v(u,new Set([ne.Shit])),c("cancelInstance")}function y(M){const B=M;e(u).has(B)?e(u).delete(B):e(u).add(B),v(u,new Set(e(u)))}function z(){!n()||!e(E).trim()||(c("createLocation",{name:e(E).trim(),address:e(S).trim()||void 0}),v(E,""),v(S,""))}function X(){v(E,""),v(S,""),c("cancelLocation")}He();var m=Ba(),R=w(m),G=L(R,2),j=w(G);{var ie=M=>{var B=Fa(),Q=Fe(B),le=w(Q),Se=w(le);p(le);var ee=L(le,2);p(Q);var oe=L(Q,2),ge=w(oe),De=L(w(ge),2),me=w(De),se=w(me);Te(se),Ke(2),p(me);var _e=L(me,2),we=w(_e);Te(we),Ke(2),p(_e);var b=L(_e,2),l=w(b);Te(l),Ke(2),p(b),p(De),p(ge);var A=L(ge,2),T=L(w(A),2);Te(T),p(A);var k=L(A,2),P=L(w(k),2);Wt(P),p(k);var F=L(k,2),te=w(F),J=L(te,2);p(F),p(oe),ve((ae,be,Le,U)=>{de(Se,`Add Instance to ${W(o()),N(()=>o().name)??""}`),rt(se,ae),rt(we,be),rt(l,Le),J.disabled=U},[()=>(e(u),W(ne),N(()=>e(u).has(ne.Shit))),()=>(e(u),W(ne),N(()=>e(u).has(ne.Cum))),()=>(e(u),W(ne),N(()=>e(u).has(ne.Piss))),()=>(e(D),e(u),N(()=>!e(D).trim()||e(u).size===0))]),K("click",ee,()=>x("collapsed")),K("change",se,()=>y(ne.Shit)),K("change",we,()=>y(ne.Cum)),K("change",l,()=>y(ne.Piss)),Ne(T,()=>e(D),ae=>v(D,ae)),Ne(P,()=>e(q),ae=>v(q,ae)),K("click",te,f),K("click",J,C),V(M,B)},re=M=>{var B=Pt(),Q=Fe(B);{var le=ee=>{var oe=Ga(),ge=Fe(oe),De=L(w(ge),2);p(ge);var me=L(ge,2),se=w(me),_e=L(w(se),2);Te(_e),p(se);var we=L(se,2),b=L(w(we),2);Te(b),p(we);var l=L(we,2);{var A=F=>{var te=Ha(),J=w(te);p(te),ve((ae,be)=>de(J,`📍 ${ae??""}, ${be??""}`),[()=>(W(n()),N(()=>n().lat.toFixed(4))),()=>(W(n()),N(()=>n().lng.toFixed(4)))]),V(F,te)};he(l,F=>{n()&&F(A)})}var T=L(l,2),k=w(T),P=L(k,2);p(T),p(me),ve(F=>P.disabled=F,[()=>(e(E),N(()=>!e(E).trim()))]),K("click",De,()=>x("collapsed")),Ne(_e,()=>e(E),F=>v(E,F)),Ne(b,()=>e(S),F=>v(S,F)),K("click",k,X),K("click",P,z),V(ee,oe)},Se=ee=>{var oe=Va();V(ee,oe)};he(Q,ee=>{r()?ee(le):ee(Se,!1)},!0)}V(M,B)};he(j,M=>{s()&&o()?M(ie):M(re,!1)})}p(G),p(m),et(m,M=>v(g,M),()=>e(g)),ve(()=>Ce(m,1,`bottom-panel ${a()??""}`,"svelte-13tihzo")),K("mousedown",R,H),K("touchstart",R,H),V(i,m),Ve()}const{PIN_STORAGE_KEY:Nn}=Ee.STORAGE,dt="map-locations",{MAX_TITLE_LENGTH:Et,MAX_DESCRIPTION_LENGTH:Ya,ID_LENGTH:Ka}=Ee.PINS;class Me{static saveLocations(t){return Tt(()=>{const a=t.map(n=>({...n,createdAt:n.createdAt.toISOString(),instances:n.instances.map(o=>({...o,createdAt:o.createdAt.toISOString()}))}));localStorage.setItem(dt,JSON.stringify(a)),Y.debug(`Saved ${t.length} locations with ${t.reduce((n,o)=>n+o.instances.length,0)} total instances`)},yt.STORAGE_SAVE_FAILED,"LOCATIONS_SAVE_ERROR")||void 0}static loadLocations(){return Tt(()=>{const t=localStorage.getItem(dt);if(!t)return Y.debug("No locations found in localStorage"),[];const n=JSON.parse(t).map(o=>({...o,createdAt:new Date(o.createdAt),instances:o.instances.map(r=>({...r,createdAt:new Date(r.createdAt)}))}));return Y.debug(`Loaded ${n.length} locations with ${n.reduce((o,r)=>o+r.instances.length,0)} total instances`),n},yt.STORAGE_LOAD_FAILED,"LOCATIONS_LOAD_ERROR")||[]}static addLocation(t){if(!t.name.trim()||t.name.length>Et)throw new ce("Invalid location name","INVALID_LOCATION_NAME");const a={...t,id:this.generateId(),createdAt:new Date,name:t.name.trim(),address:t.address?.trim()||void 0,instances:[]},n=this.loadLocations();return n.push(a),this.saveLocations(n),Y.info(`Created new location: ${a.name}`,{id:a.id}),a}static updateLocation(t){const a=this.loadLocations(),n=a.findIndex(o=>o.id===t.id);if(n===-1)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.id});if(!t.name.trim()||t.name.length>Et)throw new ce("Invalid location name","INVALID_LOCATION_NAME");a[n]={...t,name:t.name.trim(),address:t.address?.trim()||void 0},this.saveLocations(a),Y.info(`Updated location: ${t.name}`,{id:t.id})}static deleteLocation(t){if(!t)throw new ce("Invalid location ID","INVALID_LOCATION_ID");const a=this.loadLocations(),n=a.length,o=a.filter(r=>r.id!==t);if(o.length===n){Y.warn(`Attempted to delete non-existent location: ${t}`);return}this.saveLocations(o),Y.info(`Deleted location: ${t}`)}static addInstance(t){if(!t.types.length)throw new ce("At least one type must be selected","INVALID_INSTANCE_TYPES");if(t.description&&t.description.length>Ya)throw new ce("Instance description too long","INVALID_INSTANCE_DESCRIPTION");const a={...t,id:this.generateId(),createdAt:new Date,description:t.description?.trim()||void 0},n=this.loadLocations(),o=n.findIndex(r=>r.id===t.locationId);if(o===-1)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});return n[o].instances.push(a),this.saveLocations(n),Y.info(`Created new instance at location: ${n[o].name}`,{instanceId:a.id,locationId:t.locationId,types:t.types}),a}static updateInstance(t){const a=this.loadLocations(),n=a.find(r=>r.id===t.locationId);if(!n)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t.locationId});const o=n.instances.findIndex(r=>r.id===t.id);if(o===-1)throw new ce("Instance not found","INSTANCE_NOT_FOUND",{instanceId:t.id});if(!t.types.length)throw new ce("At least one type must be selected","INVALID_INSTANCE_TYPES");n.instances[o]={...t,description:t.description?.trim()||void 0},this.saveLocations(a),Y.info(`Updated instance: ${t.id}`,{locationId:t.locationId})}static deleteInstance(t,a){if(!t||!a)throw new ce("Invalid location or instance ID","INVALID_IDS");const n=this.loadLocations(),o=n.find(s=>s.id===t);if(!o)throw new ce("Location not found","LOCATION_NOT_FOUND",{locationId:t});const r=o.instances.length;if(o.instances=o.instances.filter(s=>s.id!==a),o.instances.length===r){Y.warn(`Attempted to delete non-existent instance: ${a}`);return}this.saveLocations(n),Y.info(`Deleted instance: ${a} from location: ${t}`)}static clearAllData(){const t=this.loadLocations(),a=t.reduce((n,o)=>n+o.instances.length,0);localStorage.removeItem(dt),Y.info(`Cleared all data (${t.length} locations, ${a} instances deleted)`)}static exportData(){const t=this.loadLocations();return JSON.stringify(t,null,2)}static importData(t){try{const n=JSON.parse(t).map(o=>({...o,createdAt:new Date(o.createdAt),instances:o.instances.map(r=>({...r,createdAt:new Date(r.createdAt)}))}));return this.saveLocations(n),n}catch(a){throw Y.error("Failed to import locations:",a),new ce("Invalid location data format","INVALID_IMPORT_DATA")}}static getAllInstances(){return this.loadLocations().flatMap(a=>a.instances)}static getInstancesByDate(t=!1){return this.getAllInstances().sort((n,o)=>{const r=n.createdAt.getTime(),s=o.createdAt.getTime();return t?r-s:s-r})}static getLocationById(t){return this.loadLocations().find(n=>n.id===t)||null}static getInstanceById(t){const a=this.loadLocations();for(const n of a){const o=n.instances.find(r=>r.id===t);if(o)return{location:n,instance:o}}return null}static generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,Ka-13)}}var Za=Z('<div class="loading-spinner svelte-150ovmd"></div>'),Xa=ya('<svg class="search-icon svelte-150ovmd" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8" class="svelte-150ovmd"></circle><path d="m21 21-4.35-4.35" class="svelte-150ovmd"></path></svg>'),Wa=Z('<div class="map-wrapper svelte-150ovmd"><!> <div><div class="search-box svelte-150ovmd"><input type="text" placeholder="Search for a place..." class="search-input svelte-150ovmd"/> <button class="search-button svelte-150ovmd" aria-label="Search location"><!></button></div></div> <div><button class="location-button svelte-150ovmd" aria-label="Get my location" title="Get my location"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-150ovmd"><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" class="svelte-150ovmd"></path><path d="M12 1v6M12 17v6M5.6 5.6l4.2 4.2M14.2 14.2l4.2 4.2M1 12h6M17 12h6M5.6 18.4l4.2-4.2M14.2 9.8l4.2-4.2" class="svelte-150ovmd"></path></svg></button></div> <!></div>');function Ja(i,t){Ge(t,!1);const a=$(),n=We();let o=pe(t,"initialCenter",24,()=>[53.4076,-2.9921]),r=pe(t,"initialZoom",8,13),s=$(),c=$([]),g=$(""),_=$(!1),h=$("collapsed"),O=$(null),D=$(!1),q=$(null),u=$(!1),E=$(!1);ut(()=>{v(c,Me.loadLocations()),console.log("Loaded locations:",e(c))});function S(l){e(D)||e(u)||I(l.detail.latlng)}function x(l){l.detail.map}function H(l){v(E,l.detail.open)}function d(l){v(q,l.detail.location),v(O,{lat:l.detail.location.lat,lng:l.detail.location.lng}),v(u,!0),v(D,!1),v(h,"expanded"),e(s)&&e(s).panTo(l.detail.location.lat,l.detail.location.lng,16)}async function I(l){console.log("Creating pending location at:",l),v(O,{lat:l.lat,lng:l.lng}),v(D,!0),v(u,!1),v(h,"expanded"),console.log("Location creation setup:",{isCreatingLocation:e(D),isCreatingInstance:e(u),panelState:e(h)})}function C(l){v(h,l.detail.state),e(h)==="collapsed"&&(v(O,null),v(q,null),v(D,!1),v(u,!1))}function f(l){if(!e(O))return;const A=Me.addLocation({lat:e(O).lat,lng:e(O).lng,name:l.detail.name,address:l.detail.address});v(c,[...e(c),A]),n("locationCreated",{location:A}),v(D,!1),v(O,null),v(h,"collapsed")}function y(){v(D,!1),v(O,null),v(h,"collapsed")}function z(l){if(!e(q))return;const A=Me.addInstance({locationId:e(q).id,title:l.detail.title,types:l.detail.types,description:l.detail.description});v(c,Me.loadLocations()),n("instanceCreated",{instance:A}),v(u,!1),v(q,null),v(O,null),v(h,"collapsed")}function X(){v(u,!1),v(q,null),v(O,null),v(h,"collapsed")}async function m(){if(!(!e(g).trim()||e(_))){v(_,!0);try{const A=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e(g))}&limit=1`)).json();if(A.length>0){const T=A[0],k=parseFloat(T.lat),P=parseFloat(T.lon);e(s)&&e(s).panTo(k,P,15),v(g,"")}else alert("Location not found. Please try a different search term.")}catch(l){console.error("Search error:",l),alert("Search failed. Please try again.")}finally{v(_,!1)}}}function R(l){l.key==="Enter"&&m()}function G(){e(s)&&e(s).getCurrentLocation()}function j(l,A){const T=e(c).find(k=>k.id===l);T&&e(s)&&(e(s).panTo(T.lat,T.lng,16),A&&console.log(`Navigated to location ${l}, highlighting instance ${A}`))}function ie(l=!1){return Me.loadLocations().sort((T,k)=>{const P=new Date(T.createdAt),F=new Date(k.createdAt);return l?P.getTime()-F.getTime():F.getTime()-P.getTime()})}function re(){const l=Me.loadLocations(),A={};return l.forEach(T=>{T.instances.forEach(k=>{const P=new Date(k.createdAt).toDateString();A[P]||(A[P]=[]),A[P].push({...k,location:T})})}),A}Re(()=>(e(E),e(h)),()=>{v(a,e(E)||e(h)!=="collapsed")}),Qe(),He();var M=Wa(),B=w(M);et(Pa(B,{get initialCenter(){return o()},get initialZoom(){return r()},get locations(){return e(c)},$$events:{mapClick:S,mapReady:x,locationClick:d,popupOpen:H},$$legacy:!0}),l=>v(s,l),()=>e(s));var Q=L(B,2);let le;var Se=w(Q),ee=w(Se);Te(ee);var oe=L(ee,2),ge=w(oe);{var De=l=>{var A=Za();V(l,A)},me=l=>{var A=Xa();V(l,A)};he(ge,l=>{e(_)?l(De):l(me,!1)})}p(oe),p(Se),p(Q);var se=L(Q,2);let _e;var we=w(se);p(se);var b=L(se,2);return Ua(b,{get panelState(){return e(h)},get selectedLocation(){return e(O)},get selectedLocationForInstance(){return e(q)},get isCreatingLocation(){return e(D)},get isCreatingInstance(){return e(u)},$$events:{panelStateChange:C,createLocation:f,cancelLocation:y,createInstance:z,cancelInstance:X}}),p(M),ve((l,A,T)=>{le=Ce(Q,1,"map-controls svelte-150ovmd",null,le,l),ee.disabled=e(_),oe.disabled=A,_e=Ce(se,1,"location-control svelte-150ovmd",null,_e,T)},[()=>({hidden:e(a)}),()=>(e(_),e(g),N(()=>e(_)||!e(g).trim())),()=>({hidden:e(a)})]),Ne(ee,()=>e(g),l=>v(g,l)),K("keydown",ee,R),K("click",oe,m),K("click",we,G),V(i,M),Pe(t,"navigateToLocation",j),Pe(t,"getLocationsByDate",ie),Pe(t,"getInstancesByDateGrouped",re),Ve({navigateToLocation:j,getLocationsByDate:ie,getInstancesByDateGrouped:re})}function $e(i){switch(i){case ne.Shit:return"Shit";case ne.Cum:return"Cum";case ne.Piss:return"Piss";default:return"Unknown"}}function ja(){return Object.values(ne)}const{TIME:Qa,SHORT_DATE:en,FULL_DATE:tn}=Ee.DATE_FORMAT;function St(i){return i.toLocaleTimeString([],Qa)}function Ct(i){const t=new Date;if(i.toDateString()===t.toDateString())return`Today @ ${St(i)}`;{const n=i.toLocaleDateString([],en),o=St(i);return`${n} @ ${o}`}}function an(i){const t=new Date(i+"T00:00:00"),a=new Date,n=new Date(a);return n.setDate(n.getDate()-1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===n.toDateString()?"Yesterday":t.toLocaleDateString([],tn)}function nn(i){return i.toLocaleDateString()}var on=Z('<button class="clear-search svelte-ywq051" aria-label="Clear search"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button>'),sn=Z("<button> </button>"),rn=Z('<button class="clear-filters svelte-ywq051">Clear Filters</button>'),ln=Z('<span class="source-indicator svelte-ywq051"> </span>'),cn=Z('<div class="pin-description svelte-ywq051"> </div>'),dn=Z("<span> </span>"),vn=Z('<button class="pin-item svelte-ywq051"><div class="pin-info svelte-ywq051"><div class="pin-title svelte-ywq051"> <!></div> <div class="pin-time svelte-ywq051"> </div> <!> <div class="pin-coordinates svelte-ywq051"> </div></div> <div class="pin-types svelte-ywq051"></div></button>'),un=Z('<div class="date-group svelte-ywq051"><h3 class="date-header svelte-ywq051"> <span class="pin-count svelte-ywq051"> </span></h3> <div class="pins-grid svelte-ywq051"></div></div>'),fn=Z('<div class="empty-icon svelte-ywq051">📍</div> <h3 class="svelte-ywq051">No items yet</h3> <p class="svelte-ywq051">Switch to Map View to create your first location or pin!</p>',1),hn=Z('<div class="empty-icon svelte-ywq051">🔍</div> <h3 class="svelte-ywq051">No matching items</h3> <p class="svelte-ywq051">Try adjusting your search or filters</p> <button class="clear-filters svelte-ywq051">Clear All Filters</button>',1),pn=Z('<div class="empty-state svelte-ywq051"><!></div>'),gn=Z('<div class="date-view svelte-ywq051"><div class="header svelte-ywq051"><h2 class="title svelte-ywq051">Pins by Date</h2> <div class="subtitle svelte-ywq051"> </div></div> <div class="controls svelte-ywq051"><div class="search-bar svelte-ywq051"><svg viewBox="0 0 24 24" fill="currentColor" class="search-icon svelte-ywq051"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg> <input type="text" placeholder="Search pins..." class="search-input svelte-ywq051"/> <!></div> <div class="filters svelte-ywq051"><div class="sort-control svelte-ywq051"><button title="Newest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M7 14l5-5 5 5z"></path></svg> Newest</button> <button title="Oldest first"><svg viewBox="0 0 24 24" fill="currentColor" class="svelte-ywq051"><path d="M7 10l5 5 5-5z"></path></svg> Oldest</button></div> <div class="type-filters svelte-ywq051"></div> <div class="date-filters svelte-ywq051"><div class="date-filter-group svelte-ywq051"><label for="date-after" class="date-label svelte-ywq051">After:</label> <input id="date-after" type="date" class="date-input svelte-ywq051" title="Show pins created after this date"/></div> <div class="date-filter-group svelte-ywq051"><label for="date-before" class="date-label svelte-ywq051">Before:</label> <input id="date-before" type="date" class="date-input svelte-ywq051" title="Show pins created before this date"/></div></div> <!></div></div> <div class="pin-groups svelte-ywq051"><!> <!></div></div>');function mn(i,t){Ge(t,!1);const a=$(),n=$(),o=$(),r=We();let s=pe(t,"pins",24,()=>[]),c=pe(t,"locations",24,()=>[]),g=$("desc"),_=$(""),h=$([]),O=$(""),D=$("");const q=ja();function u(b,l){const A=[];return b.forEach(T=>{A.push({id:T.id,title:T.title,description:T.description,types:T.types||[T.type],createdAt:T.createdAt,lat:T.lat,lng:T.lng,source:"pin"})}),l.forEach(T=>{T.instances.forEach(k=>{A.push({id:k.id,title:T.name,description:k.description,types:k.types,createdAt:k.createdAt,lat:T.lat,lng:T.lng,source:"instance",locationId:T.id,locationName:T.name})})}),A}function E(b,l,A,T,k,P){console.log("Filtering items:",{items:b.length,searchTerm:l,selectedTypes:A,sortOrder:T,dateAfter:k,dateBefore:P});let F=b.filter(J=>{const ae=!l||J.title.toLowerCase().includes(l.toLowerCase())||J.description&&J.description.toLowerCase().includes(l.toLowerCase()),be=A.length===0||A.some(qe=>J.types.includes(qe)),Le=new Date(J.createdAt.getFullYear(),J.createdAt.getMonth(),J.createdAt.getDate()),U=!k||Le>=new Date(k),Oe=!P||Le<=new Date(P);return ae&&be&&U&&Oe});console.log("After filtering:",F.length),F.sort((J,ae)=>{const be=J.createdAt.getTime(),Le=ae.createdAt.getTime();return T==="desc"?Le-be:be-Le});const te={};return F.forEach(J=>{const ae=nn(J.createdAt);te[ae]||(te[ae]=[]),te[ae].push(J)}),Y.debug(`Grouped items into ${Object.keys(te).length} date groups`),te}function S(b){Y.debug(`Item clicked in date view: ${b.id} (source: ${b.source})`),b.source==="pin"?r("navigateToPin",{pinId:b.id}):b.source==="instance"&&r("navigateToLocation",{locationId:b.locationId,instanceId:b.id})}function x(b){return an(b)}function H(b){e(h).includes(b)?v(h,e(h).filter(l=>l!==b)):v(h,[...e(h),b]),Y.debug(`Type filter toggled: ${b}, active filters:`,e(h))}function d(){v(_,""),v(h,[]),v(O,""),v(D,""),Y.debug("All filters cleared")}Re(()=>(W(s()),W(c())),()=>{v(a,u(s(),c()))}),Re(()=>(e(a),e(_),e(h),e(g),e(O),e(D)),()=>{v(n,E(e(a),e(_),e(h),e(g),e(O),e(D)))}),Re(()=>e(n),()=>{v(o,Object.values(e(n)).flat().length)}),Qe(),He();var I=gn(),C=w(I),f=L(w(C),2),y=w(f);p(f),p(C);var z=L(C,2),X=w(z),m=L(w(X),2);Te(m);var R=L(m,2);{var G=b=>{var l=on();K("click",l,()=>v(_,"")),V(b,l)};he(R,b=>{e(_)&&b(G)})}p(X);var j=L(X,2),ie=w(j),re=w(ie),M=L(re,2);p(ie);var B=L(ie,2);Ue(B,5,()=>q,Be,(b,l)=>{var A=sn(),T=w(A,!0);p(A),ve((k,P,F)=>{Ce(A,1,`type-filter ${k??""} type-${e(l)??""}`,"svelte-ywq051"),ke(A,"title",`Filter by ${P??""}`),de(T,F)},[()=>(e(h),e(l),N(()=>e(h).includes(e(l))?"active":"")),()=>(W($e),e(l),N(()=>$e(e(l)))),()=>(W($e),e(l),N(()=>$e(e(l))))]),K("click",A,()=>H(e(l))),V(b,A)}),p(B);var Q=L(B,2),le=w(Q),Se=L(w(le),2);Te(Se),p(le);var ee=L(le,2),oe=L(w(ee),2);Te(oe),p(ee),p(Q);var ge=L(Q,2);{var De=b=>{var l=rn();K("click",l,d),V(b,l)};he(ge,b=>{e(_),e(h),e(O),e(D),N(()=>e(_)||e(h).length>0||e(O)||e(D))&&b(De)})}p(j),p(z);var me=L(z,2),se=w(me);Ue(se,1,()=>(e(n),N(()=>Object.entries(e(n)))),Be,(b,l)=>{var A=Ta(()=>Ea(e(l),2));let T=()=>e(A)[0],k=()=>e(A)[1];var P=un(),F=w(P),te=w(F),J=L(te),ae=w(J);p(J),p(F);var be=L(F,2);Ue(be,5,k,Be,(Le,U)=>{var Oe=vn(),qe=w(Oe),tt=w(qe),ht=w(tt),Ht=L(ht);{var Gt=Ie=>{var fe=ln(),Ae=w(fe);p(fe),ve(()=>de(Ae,`@${e(U),N(()=>e(U).locationName)??""}`)),V(Ie,fe)};he(Ht,Ie=>{e(U),N(()=>e(U).source==="instance")&&Ie(Gt)})}p(tt);var at=L(tt,2),Vt=w(at,!0);p(at);var pt=L(at,2);{var Bt=Ie=>{var fe=cn(),Ae=w(fe,!0);p(fe),ve(()=>de(Ae,(e(U),N(()=>e(U).description)))),V(Ie,fe)};he(pt,Ie=>{e(U),N(()=>e(U).description)&&Ie(Bt)})}var gt=L(pt,2),Ut=w(gt);p(gt),p(qe);var mt=L(qe,2);Ue(mt,5,()=>(e(U),N(()=>e(U).types)),Be,(Ie,fe)=>{var Ae=dn(),Yt=w(Ae,!0);p(Ae),ve(Kt=>{Ce(Ae,1,`type-badge type-${e(fe)??""}`,"svelte-ywq051"),de(Yt,Kt)},[()=>(W($e),e(fe),N(()=>$e(e(fe))))]),V(Ie,Ae)}),p(mt),p(Oe),ve((Ie,fe,Ae)=>{ke(Oe,"title",`Click to navigate to ${e(U),N(()=>e(U).source==="pin"?"pin":"location")??""} on map`),de(ht,`${e(U),N(()=>e(U).title)??""} `),de(Vt,Ie),de(Ut,`${fe??""}, ${Ae??""}`)},[()=>(W(Ct),e(U),N(()=>Ct(e(U).createdAt))),()=>(e(U),N(()=>e(U).lat.toFixed(4))),()=>(e(U),N(()=>e(U).lng.toFixed(4)))]),K("click",Oe,()=>S(e(U))),V(Le,Oe)}),p(be),p(P),ve(Le=>{de(te,`${Le??""} `),de(ae,`${k(),N(()=>k().length)??""} item${k(),N(()=>k().length===1?"":"s")??""}`)},[()=>(T(),N(()=>x(T())))]),V(b,P)});var _e=L(se,2);{var we=b=>{var l=pn(),A=w(l);{var T=P=>{var F=fn();Ke(4),V(P,F)},k=P=>{var F=hn(),te=L(Fe(F),6);K("click",te,d),V(P,F)};he(A,P=>{W(s()),W(c()),N(()=>s().length===0&&c().length===0)?P(T):P(k,!1)})}p(l),V(b,l)};he(_e,b=>{e(n),N(()=>Object.keys(e(n)).length===0)&&b(we)})}p(me),p(I),ve(b=>{de(y,`${e(o)??""} of ${b??""} items`),Ce(re,1,`sort-btn ${e(g)==="desc"?"active":""}`,"svelte-ywq051"),Ce(M,1,`sort-btn ${e(g)==="asc"?"active":""}`,"svelte-ywq051")},[()=>(W(s()),W(c()),N(()=>s().length+c().reduce((b,l)=>b+l.instances.length,0)))]),Ne(m,()=>e(_),b=>v(_,b)),K("click",re,()=>v(g,"desc")),K("click",M,()=>v(g,"asc")),Ne(Se,()=>e(O),b=>v(O,b)),Ne(oe,()=>e(D),b=>v(D,b)),V(i,I),Ve()}var _n=Z('<meta name="description" content="Interactive map to track bodily functions and see date-based views"/>'),wn=Z('<span class="count-breakdown svelte-ih4f9n"> </span>'),bn=Z('<div class="app-container svelte-ih4f9n"><div class="view-switcher svelte-ih4f9n"><div class="view-controls svelte-ih4f9n"><button><svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg> Map View</button> <button><svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></svg> Date View</button></div> <div class="pin-count svelte-ih4f9n"> <!></div></div> <div class="content svelte-ih4f9n"><!></div></div>');function On(i,t){Ge(t,!1);const a=$();let n=$(),o=$([]),r=$("map");ut(()=>{s(),c(),D()});function s(){try{v(o,Me.loadLocations()),Y.debug(`Loaded ${e(o).length} locations in main page`)}catch(m){Y.error("Failed to load data in main page",m),v(o,[])}}function c(){const m=()=>{Y.debug("Storage changed, reloading data"),s()};return window.addEventListener("storage",m),()=>{window.removeEventListener("storage",m)}}function g(m){Y.debug(`Navigating to location: ${m.detail.locationId}, instance: ${m.detail.instanceId}`),v(r,"map"),setTimeout(()=>{e(n)?.navigateToLocation(m.detail.locationId,m.detail.instanceId)},Ee.UI.ANIMATION_DURATION/3)}function _(){s()}function h(m){console.log("switchView called with:",m,"current:",e(r)),e(r)!==m&&(Y.debug(`Switching view from ${e(r)} to ${m}`),v(r,m),m==="date"&&_())}function O(m){const{altKey:R,key:G}=m;if(R&&G==="d"){m.preventDefault(),h("date");return}if(R&&G==="m"){m.preventDefault(),h("map");return}}function D(){Y.debug("Setting up keyboard shortcuts")}Re(()=>e(o),()=>{v(a,e(o).reduce((m,R)=>m+R.instances.length,0))}),Qe(),He();var q=bn();Jt(m=>{var R=_n();Sa.title="Shumpiss",V(m,R)}),K("keydown",Ca,O);var u=w(q),E=w(u),S=w(E),x=L(S,2);p(E);var H=L(E,2),d=w(H),I=L(d);{var C=m=>{var R=wn(),G=w(R);p(R),ve(()=>de(G,`(${e(o),N(()=>e(o).length)??""} location${e(o),N(()=>e(o).length===1?"":"s")??""})`)),V(m,R)};he(I,m=>{e(o),N(()=>e(o).length>0)&&m(C)})}p(H),p(u);var f=L(u,2),y=w(f);{var z=m=>{var R=Pt(),G=Fe(R);Na(G,()=>e(r),j=>{et(Ja(j,{get initialCenter(){return W(Ee),N(()=>Ee.MAP.DEFAULT_CENTER)},get initialZoom(){return W(Ee),N(()=>Ee.MAP.DEFAULT_ZOOM)},$$events:{locationCreated:_,instanceCreated:_,locationDeleted:_,instanceDeleted:_},$$legacy:!0}),ie=>v(n,ie),()=>e(n))}),V(m,R)},X=m=>{mn(m,{get locations(){return e(o)},$$events:{navigateToLocation:g}})};he(y,m=>{e(r)==="map"?m(z):m(X,!1)})}p(f),p(q),ve(()=>{Ce(S,1,`view-btn ${e(r)==="map"?"active":""}`,"svelte-ih4f9n"),ke(S,"title",`Map View (${W(Ye),N(()=>Ye.SWITCH_TO_MAP_VIEW)??""})`),Ce(x,1,`view-btn ${e(r)==="date"?"active":""}`,"svelte-ih4f9n"),ke(x,"title",`Date View (${W(Ye),N(()=>Ye.SWITCH_TO_DATE_VIEW)??""})`),de(d,`${e(a)??""} item${e(a)===1?"":"s"} `)}),K("click",S,()=>h("map")),K("click",x,()=>h("date")),V(i,q),Ve()}export{On as component};
